<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 1 Building an R Package | Using R Packages for Reproducible Workflows</title>
  <meta name="description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="generator" content="bookdown 0.23 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 1 Building an R Package | Using R Packages for Reproducible Workflows" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="github-repo" content="michaeldumelle/R-Packages-Reproducible-Workflows-Book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 1 Building an R Package | Using R Packages for Reproducible Workflows" />
  
  <meta name="twitter:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  

<meta name="author" content="Michael Dumelle" />


<meta name="date" content="2021-09-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="a-research-compendia.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Using R Packages for Reproducible Workflows</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="r-package.html"><a href="r-package.html"><i class="fa fa-check"></i><b>1</b> Building an R Package</a><ul>
<li class="chapter" data-level="1.1" data-path="r-package.html"><a href="r-package.html#what-is-an-r-package"><i class="fa fa-check"></i><b>1.1</b> What is an R Package?</a><ul>
<li class="chapter" data-level="1.1.1" data-path="r-package.html"><a href="r-package.html#exercises"><i class="fa fa-check"></i><b>1.1.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="r-package.html"><a href="r-package.html#creating-an-r-package"><i class="fa fa-check"></i><b>1.2</b> Creating an R Package</a><ul>
<li class="chapter" data-level="1.2.1" data-path="r-package.html"><a href="r-package.html#the-motivating-dataset"><i class="fa fa-check"></i><b>1.2.1</b> The Motivating Dataset</a></li>
<li class="chapter" data-level="1.2.2" data-path="r-package.html"><a href="r-package.html#the-first-step"><i class="fa fa-check"></i><b>1.2.2</b> The First Step</a></li>
<li class="chapter" data-level="1.2.3" data-path="r-package.html"><a href="r-package.html#the-first-function"><i class="fa fa-check"></i><b>1.2.3</b> The First Function</a></li>
<li class="chapter" data-level="1.2.4" data-path="r-package.html"><a href="r-package.html#load_all"><i class="fa fa-check"></i><b>1.2.4</b> <code>load_all()</code></a></li>
<li class="chapter" data-level="1.2.5" data-path="r-package.html"><a href="r-package.html#creating-package-data"><i class="fa fa-check"></i><b>1.2.5</b> Creating Package Data</a></li>
<li class="chapter" data-level="1.2.6" data-path="r-package.html"><a href="r-package.html#roxygen-comments"><i class="fa fa-check"></i><b>1.2.6</b> roxygen Comments</a></li>
<li class="chapter" data-level="1.2.7" data-path="r-package.html"><a href="r-package.html#the-second-function"><i class="fa fa-check"></i><b>1.2.7</b> The Second Function</a></li>
<li class="chapter" data-level="1.2.8" data-path="r-package.html"><a href="r-package.html#description"><i class="fa fa-check"></i><b>1.2.8</b> DESCRIPTION</a></li>
<li class="chapter" data-level="1.2.9" data-path="r-package.html"><a href="r-package.html#namespace"><i class="fa fa-check"></i><b>1.2.9</b> NAMESPACE</a></li>
<li class="chapter" data-level="1.2.10" data-path="r-package.html"><a href="r-package.html#testthat"><i class="fa fa-check"></i><b>1.2.10</b> testthat</a></li>
<li class="chapter" data-level="1.2.11" data-path="r-package.html"><a href="r-package.html#license"><i class="fa fa-check"></i><b>1.2.11</b> License</a></li>
<li class="chapter" data-level="1.2.12" data-path="r-package.html"><a href="r-package.html#vignettes"><i class="fa fa-check"></i><b>1.2.12</b> Vignettes</a></li>
<li class="chapter" data-level="1.2.13" data-path="r-package.html"><a href="r-package.html#check"><i class="fa fa-check"></i><b>1.2.13</b> <code>check()</code></a></li>
<li class="chapter" data-level="1.2.14" data-path="r-package.html"><a href="r-package.html#install"><i class="fa fa-check"></i><b>1.2.14</b> <code>install()</code></a></li>
<li class="chapter" data-level="1.2.15" data-path="r-package.html"><a href="r-package.html#congratulations"><i class="fa fa-check"></i><b>1.2.15</b> Congratulations</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="r-package.html"><a href="r-package.html#debugging"><i class="fa fa-check"></i><b>1.3</b> Debugging</a><ul>
<li class="chapter" data-level="1.3.1" data-path="r-package.html"><a href="r-package.html#a-mysterious-error-message"><i class="fa fa-check"></i><b>1.3.1</b> A Mysterious Error Message</a></li>
<li class="chapter" data-level="1.3.2" data-path="r-package.html"><a href="r-package.html#traceback"><i class="fa fa-check"></i><b>1.3.2</b> <code>traceback()</code></a></li>
<li class="chapter" data-level="1.3.3" data-path="r-package.html"><a href="r-package.html#browser"><i class="fa fa-check"></i><b>1.3.3</b> <code>browser()</code></a></li>
<li class="chapter" data-level="1.3.4" data-path="r-package.html"><a href="r-package.html#another-error-no-mysterious-message"><i class="fa fa-check"></i><b>1.3.4</b> Another Error – No Mysterious Message</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="r-package.html"><a href="r-package.html#additional-resources"><i class="fa fa-check"></i><b>1.4</b> Additional Resources</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="a-research-compendia.html"><a href="a-research-compendia.html"><i class="fa fa-check"></i><b>2</b> A Research Compendia</a></li>
<li class="chapter" data-level="3" data-path="your-compendia.html"><a href="your-compendia.html"><i class="fa fa-check"></i><b>3</b> Turning An R Package into a Reproducible Research Compendia</a></li>
<li class="chapter" data-level="4" data-path="extensions.html"><a href="extensions.html"><i class="fa fa-check"></i><b>4</b> Extensions</a><ul>
<li class="chapter" data-level="4.1" data-path="extensions.html"><a href="extensions.html#rmarkdown"><i class="fa fa-check"></i><b>4.1</b> RMarkdown</a></li>
<li class="chapter" data-level="4.2" data-path="extensions.html"><a href="extensions.html#github"><i class="fa fa-check"></i><b>4.2</b> GitHub</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="exercise-solutions.html"><a href="exercise-solutions.html"><i class="fa fa-check"></i><b>5</b> Exercise Solutions</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Using R Packages for Reproducible Workflows</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="r-package" class="section level1">
<h1><span class="header-section-number">Chapter 1</span> Building an R Package</h1>
<div id="what-is-an-r-package" class="section level2">
<h2><span class="header-section-number">1.1</span> What is an R Package?</h2>
<p>An R package is a collection of code, data, documentation, and tests with a particular structure that can be shared with others. R packages are commonly downloaded from the Comprehensive R Archive Network (<a href="https://cran.r-project.org/">CRAN</a>). You can install them from CRAN with <code>install.packages("package_name")</code>, load them in your workspace with <code>library("package_name")</code>, and get help by running (<code>help(package = "package_name")</code>).</p>
<p>One of the reasons R packages are so useful is because they are the fundamental way to share code in R. If your code is in a package, others can easily download and use it. If they are familiar with R packages, they likely will be familiar with how to use yours! But sharing R code is not the only benefit of creating R packages. Learning how to build an R package will provide several other benefits to future you!</p>
<p>Future you will benefit from creating your own R packages because they enforce a particular structure. This structure</p>
<ol style="list-style-type: decimal">
<li>Saves you time – you don’t need to think about how to organize your files, R packages have a template!
<ul>
<li>This was especially helpful for me because before learning how to create R packages, I would save my R files in all sorts of locations on my computer with all sorts of names. This made it <em>very challenging</em> to come back to my work later and find a particular file.</li>
</ul></li>
<li>Gives you standardized tools – people have created extremely useful tools that work with R packages, so take advantage of them!
<ul>
<li>The R package devtools, which we downloaded earlier, contains many of these standarized tools.</li>
</ul></li>
<li>Requires documentation – This is especially helpful for future you.
<ul>
<li>Before I started using R packages, when I would come back my old code, I was convinced someone else wrote it – I basically had to rewrite it all to understand it. R packages help prevent this.</li>
</ul></li>
<li>Is reproducible – R packages are built from R projects (see <a href="https://r4ds.had.co.nz/workflow-projects.html">here</a> and <a href="https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects">here</a>), so file paths are relative, not absolute!
<ul>
<li><code>read_csv("a_fun_csv_file.csv")</code> works on my machine – and yours!</li>
<li>While R projects are not the fundamental focus on today, I highly, highly recommend you use them for every data analysis project that you are not using an R package for.</li>
</ul></li>
<li>Guides your data analysis – We will talk about this today
<ul>
<li>See <span class="citation">Marwick, Boettiger, and Mullen (<a href="#ref-marwick2018packaging" role="doc-biblioref">2018</a>)</span> for more!</li>
</ul></li>
</ol>
<div id="exercises" class="section level3">
<h3><span class="header-section-number">1.1.1</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>What are some of your favorite R packages?</p></li>
<li><p>Of those we have talked about so far, what benefits of R packages are most appealing to you?</p></li>
</ol>
</div>
</div>
<div id="creating-an-r-package" class="section level2">
<h2><span class="header-section-number">1.2</span> Creating an R Package</h2>
<p>Together, we will create the companion package for this workshop! If this is your first R package, then an extra special congratulations to you – this is a big milestone! The name of the package is</p>
<div id="the-motivating-dataset" class="section level3">
<h3><span class="header-section-number">1.2.1</span> The Motivating Dataset</h3>
<p>Suppose we want to build an R package that summarizes length (in kilometers) and discharge (meters per second cubed) of North American rivers based on the names of the rivers. Below is our data of interest</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="r-package.html#cb3-1"></a>rivers &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb3-2"><a href="r-package.html#cb3-2"></a>  <span class="dt">Missouri =</span> <span class="kw">c</span>(<span class="dv">3768</span>, <span class="dv">1956</span>),</span>
<span id="cb3-3"><a href="r-package.html#cb3-3"></a>  <span class="dt">Mississippi =</span> <span class="kw">c</span>(<span class="dv">3544</span>, <span class="dv">18400</span>),</span>
<span id="cb3-4"><a href="r-package.html#cb3-4"></a>  <span class="dt">Yukon =</span> <span class="kw">c</span>(<span class="dv">3190</span>, <span class="dv">6340</span>),</span>
<span id="cb3-5"><a href="r-package.html#cb3-5"></a>  <span class="dt">Colorado =</span> <span class="kw">c</span>(<span class="dv">2330</span>, <span class="dv">40</span>),</span>
<span id="cb3-6"><a href="r-package.html#cb3-6"></a>  <span class="dt">Arkansas =</span> <span class="kw">c</span>(<span class="dv">2322</span>, <span class="dv">1004</span>),</span>
<span id="cb3-7"><a href="r-package.html#cb3-7"></a>  <span class="dt">Columbia =</span> <span class="kw">c</span>(<span class="dv">2000</span>, <span class="dv">7730</span>),</span>
<span id="cb3-8"><a href="r-package.html#cb3-8"></a>  <span class="dt">Red =</span> <span class="kw">c</span>(<span class="dv">1811</span>, <span class="dv">852</span>),</span>
<span id="cb3-9"><a href="r-package.html#cb3-9"></a>  <span class="dt">Canadian =</span> <span class="kw">c</span>(<span class="dv">1458</span>, <span class="dv">174</span>)</span>
<span id="cb3-10"><a href="r-package.html#cb3-10"></a>) </span>
<span id="cb3-11"><a href="r-package.html#cb3-11"></a><span class="kw">rownames</span>(rivers) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;length&quot;</span>, <span class="st">&quot;discharge&quot;</span>)</span>
<span id="cb3-12"><a href="r-package.html#cb3-12"></a>rivers</span></code></pre></div>
<pre><code>#&gt;           Missouri Mississippi Yukon Colorado Arkansas Columbia  Red Canadian
#&gt; length        3768        3544  3190     2330     2322     2000 1811     1458
#&gt; discharge     1956       18400  6340       40     1004     7730  852      174</code></pre>
</div>
<div id="the-first-step" class="section level3">
<h3><span class="header-section-number">1.2.2</span> The First Step</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="r-package.html#cb5-1"></a>devtools<span class="op">::</span><span class="kw">create_package</span>(<span class="st">&quot;path_to_RPRW_package/RPRW&quot;</span>)</span></code></pre></div>
<pre><code>√ Creating &#39;path_to_RPRW_package/RPRW/&#39;
√ Setting active project to &#39;path_to_RPRW_package/RPRW&#39;
√ Creating &#39;R/&#39;
√ Writing &#39;DESCRIPTION&#39;
Package: RPRW
Title: What the Package Does (One Line, Title Case)
Version: 0.0.0.9000
Authors@R (parsed):
    * First Last &lt;first.last@example.com&gt; [aut, cre] (YOUR-ORCID-ID)
Description: What the package does (one paragraph).
License: `use_mit_license()`, `use_gpl3_license()` or friends to
    pick a license
Encoding: UTF-8
LazyData: true
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.1.1
√ Writing &#39;NAMESPACE&#39;
√ Writing &#39;RPRW.Rproj&#39;
√ Adding &#39;^RPRW\\.Rproj$&#39; to &#39;.Rbuildignore&#39;
√ Adding &#39;.Rproj.user&#39; to &#39;.gitignore&#39;
√ Adding &#39;^\\.Rproj\\.user$&#39; to &#39;.Rbuildignore&#39;
√ Opening &#39;path_to_RPRW_package/RPRW/&#39; in new RStudio session
√ Setting active project to &#39;&lt;no active project&gt;&#39;
√ Setting active project to &#39;path_to_RPRW_package/RPRW&#39;</code></pre>
<p>In the “Files” pane of RStudio (bottom right corner), you will see that your folder has been populated with a few new files and a new folder.
<img src="images/newrpack_files.PNG" width="100%" />
We will focus on some of these next.</p>
<p>You will also notice that the “Environment” pane of RStudio (top right corner) now has a “Build” tab – this tab contains some useful tools for your R package.</p>
<ul>
<li>R (folder): Where functions in your R package are stored</li>
<li>Description: This contains metadata for your package</li>
<li>Namespace: Information about 1) functions from other packages your package uses and 2) what functions in your package you make available to others</li>
</ul>
</div>
<div id="the-first-function" class="section level3">
<h3><span class="header-section-number">1.2.3</span> The First Function</h3>
<p>The R folder is where functions in your R package are stored. Let’s create our first function, called <code>river_medians()</code>, which finds the median of river length and discharge of desired rivers. Generally, the name of your file should match the name of the function, and you should use separate files for separate functions. More experienced users, it is okay to break this rule every once in a while in certain contexts. To create an R file in the R folder, run</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="r-package.html#cb7-1"></a><span class="kw">use_r</span>(<span class="st">&quot;river_means&quot;</span>)</span></code></pre></div>
<p>You will see some output in the console</p>
<pre><code>* Modify &#39;R/river_means.R&#39;
* Call `use_test()` to create a matching test file </code></pre>
<p>and the appropriate file now in your R folder.
<img src="images/newrpack_function.PNG" width="100%" /></p>
<p>Now let’s write our function. We want this function to take the mean length and discharge of all rivers whose names have a common pattern.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="r-package.html#cb9-1"></a>river_means &lt;-<span class="st"> </span><span class="cf">function</span>(data, pattern) {</span>
<span id="cb9-2"><a href="r-package.html#cb9-2"></a>  desired_rivers &lt;-<span class="st"> </span><span class="kw">grep</span>(pattern, <span class="kw">names</span>(data))</span>
<span id="cb9-3"><a href="r-package.html#cb9-3"></a>  new_data &lt;-<span class="st"> </span>data[, desired_rivers]</span>
<span id="cb9-4"><a href="r-package.html#cb9-4"></a>  <span class="kw">rowMeans</span>(new_data)</span>
<span id="cb9-5"><a href="r-package.html#cb9-5"></a>}</span></code></pre></div>
<p>The first line of code finds the variables in the data whose names match the pattern. The second line of code subsets the data to include only the desired variables. The third line of code finds and returns the mean length and mean discharge of the desired variables. If you would like, you can leave comments in the code (using <code>#</code>) to remind yourself what each line of code does. This is usually good practice, as it can help others (and future you) understand the intent of your code line-by-line.</p>
</div>
<div id="load_all" class="section level3">
<h3><span class="header-section-number">1.2.4</span> <code>load_all()</code></h3>
<p>So we have written this function, how should we try it out? Well you <em>could</em>
run the function or source it (<code>source("R/river_means.R")</code>), but this puts it in our global workspace, and if you are not careful, global workspaces can get messy. The devtools
function <code>load_all()</code> emulates the process of building, installing, and loading our R package, making all of your functions available via a single line of code. As your package becomes more complicated, it is much easier to try our your functions using <code>load_all()</code> than navigating the global workspace.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="r-package.html#cb10-1"></a><span class="kw">load_all</span>()</span></code></pre></div>
<p>Now let’s try out our function! What if we want our summary for the rivers starting with “Mi” (Missiouri and Mississippi)?</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="r-package.html#cb11-1"></a><span class="kw">river_means</span>(rivers, <span class="st">&quot;Mi&quot;</span>)</span></code></pre></div>
<pre><code>#&gt;    length discharge 
#&gt;      3656     10178</code></pre>
<p>Or what if we want our summary for rivers starting with “Y” (Yukon) or “R” (Red)?</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="r-package.html#cb13-1"></a><span class="kw">river_means</span>(rivers, <span class="st">&quot;Y|R&quot;</span>)</span></code></pre></div>
<pre><code>#&gt;    length discharge 
#&gt;    2500.5    3596.0</code></pre>
<p>Hooray – our function works! Give yourself a congratulations :)!</p>
<div id="exercises-1" class="section level4">
<h4><span class="header-section-number">1.2.4.1</span> Exercises</h4>
<ol style="list-style-type: decimal">
<li>How many functions does <code>river_means()</code> call within the body of the function? What package are these functions in?</li>
</ol>
</div>
</div>
<div id="creating-package-data" class="section level3">
<h3><span class="header-section-number">1.2.5</span> Creating Package Data</h3>
<p>So far we have used the <code>rivers</code> data from our global workspace. But what if we want this to be data that is included as part of the R packages so that others (or future you) have easy access to it? This is the place for <code>use_data()</code></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="r-package.html#cb15-1"></a><span class="kw">use_data</span>(rivers)</span></code></pre></div>
<pre><code>√ Creating &#39;data/&#39;
√ Saving &#39;rivers&#39; to &#39;data/rivers.rda&#39;</code></pre>
<p>You will see that at the root of your R package, there is a folder called “data”, and in that folder is a file called rivers.rda, which contains the rivers data. For illustration, let’s remove rivers from our global workspace and then load it like we would data from any other package</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="r-package.html#cb17-1"></a><span class="kw">rm</span>(rivers) <span class="co"># remove the rivers data from our global workspace</span></span>
<span id="cb17-2"><a href="r-package.html#cb17-2"></a><span class="kw">load_all</span>() <span class="co"># emulate package building process</span></span>
<span id="cb17-3"><a href="r-package.html#cb17-3"></a><span class="kw">data</span>(<span class="st">&quot;rivers&quot;</span>) <span class="co"># load the rivers data</span></span>
<span id="cb17-4"><a href="r-package.html#cb17-4"></a>rivers</span></code></pre></div>
</div>
<div id="roxygen-comments" class="section level3">
<h3><span class="header-section-number">1.2.6</span> roxygen Comments</h3>
<p>Now that you have written your function, it is time to thoroughly document your function so that others (or future you) can understand how to use it. The documentation for R functions uses special types of comments called <em>roxygen</em> comments. The comments use <code>#'</code> and have special “tags” associated with them. To insert a template of roxygen comments into <code>river_means()</code>, put your cursor somewhere in the <code>river_means()</code> function and either</p>
<ol style="list-style-type: decimal">
<li>In the upper-left toolbar, go to Code -&gt; Insert Roxygen Skeleton</li>
<li>Press Ctrl/Cmd + Alt + Shift + R</li>
</ol>
<p>You will see <code>river_means()</code> now looks like</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="r-package.html#cb18-1"></a><span class="co">#&#39; Title</span></span>
<span id="cb18-2"><a href="r-package.html#cb18-2"></a><span class="co">#&#39;</span></span>
<span id="cb18-3"><a href="r-package.html#cb18-3"></a><span class="co">#&#39; @param data </span></span>
<span id="cb18-4"><a href="r-package.html#cb18-4"></a><span class="co">#&#39; @param pattern </span></span>
<span id="cb18-5"><a href="r-package.html#cb18-5"></a><span class="co">#&#39;</span></span>
<span id="cb18-6"><a href="r-package.html#cb18-6"></a><span class="co">#&#39; @return</span></span>
<span id="cb18-7"><a href="r-package.html#cb18-7"></a><span class="co">#&#39; @export</span></span>
<span id="cb18-8"><a href="r-package.html#cb18-8"></a><span class="co">#&#39;</span></span>
<span id="cb18-9"><a href="r-package.html#cb18-9"></a><span class="co">#&#39; @examples</span></span>
<span id="cb18-10"><a href="r-package.html#cb18-10"></a>river_means &lt;-<span class="st"> </span><span class="cf">function</span>(data, pattern) {</span>
<span id="cb18-11"><a href="r-package.html#cb18-11"></a>  desired_rivers &lt;-<span class="st"> </span><span class="kw">grep</span>(pattern, <span class="kw">names</span>(data))</span>
<span id="cb18-12"><a href="r-package.html#cb18-12"></a>  new_data &lt;-<span class="st"> </span>data[, desired_rivers]</span>
<span id="cb18-13"><a href="r-package.html#cb18-13"></a>  <span class="kw">rowMeans</span>(new_data)</span>
<span id="cb18-14"><a href="r-package.html#cb18-14"></a>}</span></code></pre></div>
<p>The <code>@</code> indicates a particular “tag” that controls how functions are documented.</p>
<ul>
<li><code>@param</code>: for documenting arguments to a function</li>
<li><code>@return</code>: for documenting the function output</li>
<li><code>@export</code>: for making this function available to others downloading your package</li>
<li><code>@examples</code>: to give examples for how to use the package</li>
</ul>
<p>Let’s fill these in.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="r-package.html#cb19-1"></a><span class="co">#&#39; Means of river lengths and discharges</span></span>
<span id="cb19-2"><a href="r-package.html#cb19-2"></a><span class="co">#&#39;</span></span>
<span id="cb19-3"><a href="r-package.html#cb19-3"></a><span class="co">#&#39; @param data A data frame with two rows. The first row indicates river length and</span></span>
<span id="cb19-4"><a href="r-package.html#cb19-4"></a><span class="co">#&#39;   second row indicates river discharge. The columns of data indicate river names.</span></span>
<span id="cb19-5"><a href="r-package.html#cb19-5"></a><span class="co">#&#39; @param pattern A pattern by which to include only particular rivers</span></span>
<span id="cb19-6"><a href="r-package.html#cb19-6"></a><span class="co">#&#39;</span></span>
<span id="cb19-7"><a href="r-package.html#cb19-7"></a><span class="co">#&#39; @return The mean river length and mean river discharge for the desired rivers</span></span>
<span id="cb19-8"><a href="r-package.html#cb19-8"></a><span class="co">#&#39; @export</span></span>
<span id="cb19-9"><a href="r-package.html#cb19-9"></a><span class="co">#&#39;</span></span>
<span id="cb19-10"><a href="r-package.html#cb19-10"></a><span class="co">#&#39; @examples</span></span>
<span id="cb19-11"><a href="r-package.html#cb19-11"></a><span class="co">#&#39; data(&quot;rivers&quot;)</span></span>
<span id="cb19-12"><a href="r-package.html#cb19-12"></a><span class="co">#&#39; river_means(rivers, pattern = &quot;Mi&quot;)</span></span>
<span id="cb19-13"><a href="r-package.html#cb19-13"></a>river_means &lt;-<span class="st"> </span><span class="cf">function</span>(data, pattern) {</span>
<span id="cb19-14"><a href="r-package.html#cb19-14"></a>  desired_rivers &lt;-<span class="st"> </span><span class="kw">grep</span>(pattern, <span class="kw">names</span>(data))</span>
<span id="cb19-15"><a href="r-package.html#cb19-15"></a>  new_data &lt;-<span class="st"> </span>data[, desired_rivers]</span>
<span id="cb19-16"><a href="r-package.html#cb19-16"></a>  <span class="kw">rowMeans</span>(new_data)</span>
<span id="cb19-17"><a href="r-package.html#cb19-17"></a>}</span></code></pre></div>
<p>To view this documentation as you would any other package’s function documentation, first run</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="r-package.html#cb20-1"></a><span class="kw">document</span>()</span></code></pre></div>
<pre><code>i Updating RPRW documentation
i Loading RPRW
Writing NAMESPACE
Writing river_means.Rd</code></pre>
<p>You will notice that there is a new folder at the root of the package, called “man”, which contains a file called <code>river_means.Rd</code>.
<img src="images/newrpack_files2.PNG" width="100%" /></p>
<p>The contents of the file here are not too important, as this file is automatically created using <code>document()</code>. The important point is that after running <code>document()</code>, you can view the documentation of your function!</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="r-package.html#cb22-1"></a>?river_means</span></code></pre></div>
<p><img src="images/newrpack_example.PNG" width="100%" /></p>
<p>There are several other tags available to customize your documentation – for more information about these tags and documenting data (which is different than documentation function; the rivers data is documented in the RPRW package hosted on GitHub), see <a href="https://r-pkgs.org/man.html#man">here</a>. Though we skip it here, the RPRW package source does document the rivers data and can be viewed using <code>?rivers</code> after loading <code>RPRW</code>.</p>
</div>
<div id="the-second-function" class="section level3">
<h3><span class="header-section-number">1.2.7</span> The Second Function</h3>
<p>In <code>river_means()</code>, we used a few functions: <code>&lt;-</code>, <code>grep()</code>, <code>names()</code>, <code>[</code>, and <code>rowMeans()</code>. These functions are all from the base package, which is a special package in the way that it operates with R packages. If you use functions from the base package in your package, you don’t have to give R any warning. If you use a function from another package, however, you do need to let R know where that function is coming from. Next we explore this.</p>
<p>Suppose we want to create a function in our package that computes the mean instead of a mean. First we run</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="r-package.html#cb23-1"></a><span class="kw">use_r</span>(<span class="st">&quot;river_medians&quot;</span>)</span></code></pre></div>
<p>Then we write the function. Note that there is no <code>rowMedians()</code> function, so we use <code>apply()</code> to summarize across rows (see <code>?apply</code> for more detail).</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="r-package.html#cb24-1"></a>river_medians &lt;-<span class="st"> </span><span class="cf">function</span>(data, pattern) {</span>
<span id="cb24-2"><a href="r-package.html#cb24-2"></a>  desired_rivers &lt;-<span class="st"> </span><span class="kw">grep</span>(pattern, <span class="kw">names</span>(data))</span>
<span id="cb24-3"><a href="r-package.html#cb24-3"></a>  new_data &lt;-<span class="st"> </span>data[, desired_rivers]</span>
<span id="cb24-4"><a href="r-package.html#cb24-4"></a>  <span class="kw">apply</span>(new_data, <span class="dv">1</span>, median)</span>
<span id="cb24-5"><a href="r-package.html#cb24-5"></a>}</span></code></pre></div>
<p>But wait! You’ll notice that the function <code>median()</code> is in the stats package, not the base package (run <code>?median</code> to check). So we need to let R know that we will be using a function from a package that is not the base package. To accomplish this, there are two steps to take. First, you need to tell R that you are using another package</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="r-package.html#cb25-1"></a><span class="kw">use_package</span>(<span class="st">&quot;stats&quot;</span>)</span></code></pre></div>
<pre><code>√ Adding &#39;stats&#39; to Imports field in DESCRIPTION
* Refer to functions with `stats::fun()`</code></pre>
<p>You will notice that the package stats was added to the Imports field in the DESCRIPTION file – we will get to DESCRIPTION later, but for now just remember that it contains metadata about your package. You only need to run <code>use_package("stats")</code> once per package. That is, if you are using a different function from stats, you don’t need to run <code>use_package("stats")</code> again. Second, you need to tell the <code>river_median()</code> function to use the <code>median()</code> function from the stats package. The best practice is to preface any function from outside the base package with <code>packagename::</code>. This adjustment to <code>river_median()</code> yields</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="r-package.html#cb27-1"></a>river_medians &lt;-<span class="st"> </span><span class="cf">function</span>(data, pattern) {</span>
<span id="cb27-2"><a href="r-package.html#cb27-2"></a>  desired_rivers &lt;-<span class="st"> </span><span class="kw">grep</span>(pattern, <span class="kw">names</span>(data))</span>
<span id="cb27-3"><a href="r-package.html#cb27-3"></a>  new_data &lt;-<span class="st"> </span>data[, desired_rivers]</span>
<span id="cb27-4"><a href="r-package.html#cb27-4"></a>  <span class="kw">apply</span>(new_data, <span class="dv">1</span>, stats<span class="op">::</span>median)</span>
<span id="cb27-5"><a href="r-package.html#cb27-5"></a>}</span></code></pre></div>
<p>Though this is the best practice, it does add some extra typing and can be cumbersome if you are using outside functions often. The <code>packagename::</code> prefix can be avoided if you import <code>median()</code> to <code>river_median()</code> using the roxygen tag <code>@importFrom</code></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="r-package.html#cb28-1"></a><span class="co">#&#39; Medians of river lengths and discharges</span></span>
<span id="cb28-2"><a href="r-package.html#cb28-2"></a><span class="co">#&#39;</span></span>
<span id="cb28-3"><a href="r-package.html#cb28-3"></a><span class="co">#&#39; @param data A data frame with two rows. The first row indicates river length and</span></span>
<span id="cb28-4"><a href="r-package.html#cb28-4"></a><span class="co">#&#39;   second row indicates river discharge. The columns of data indicate river names.</span></span>
<span id="cb28-5"><a href="r-package.html#cb28-5"></a><span class="co">#&#39; @param pattern A pattern by which to include only particular rivers</span></span>
<span id="cb28-6"><a href="r-package.html#cb28-6"></a><span class="co">#&#39;</span></span>
<span id="cb28-7"><a href="r-package.html#cb28-7"></a><span class="co">#&#39; @return The median river length and mean river discharge for the desired rivers</span></span>
<span id="cb28-8"><a href="r-package.html#cb28-8"></a><span class="co">#&#39; @importFrom stats median</span></span>
<span id="cb28-9"><a href="r-package.html#cb28-9"></a><span class="co">#&#39; @export</span></span>
<span id="cb28-10"><a href="r-package.html#cb28-10"></a><span class="co">#&#39;</span></span>
<span id="cb28-11"><a href="r-package.html#cb28-11"></a><span class="co">#&#39; @examples</span></span>
<span id="cb28-12"><a href="r-package.html#cb28-12"></a><span class="co">#&#39; data(&quot;rivers&quot;)</span></span>
<span id="cb28-13"><a href="r-package.html#cb28-13"></a><span class="co">#&#39; river_medians(rivers, pattern = &quot;Mi&quot;)</span></span>
<span id="cb28-14"><a href="r-package.html#cb28-14"></a>river_medians &lt;-<span class="st"> </span><span class="cf">function</span>(data, pattern) {</span>
<span id="cb28-15"><a href="r-package.html#cb28-15"></a>  desired_rivers &lt;-<span class="st"> </span><span class="kw">grep</span>(pattern, <span class="kw">names</span>(data))</span>
<span id="cb28-16"><a href="r-package.html#cb28-16"></a>  new_data &lt;-<span class="st"> </span>data[, desired_rivers]</span>
<span id="cb28-17"><a href="r-package.html#cb28-17"></a>  <span class="kw">apply</span>(new_data, <span class="dv">1</span>, median)</span>
<span id="cb28-18"><a href="r-package.html#cb28-18"></a>}</span></code></pre></div>
<p>If you are using several functions from stats, it may be easier to use the <code>@import</code> tag, which imports all functions from a package at once.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="r-package.html#cb29-1"></a><span class="co">#&#39; Medians of river lengths and discharges</span></span>
<span id="cb29-2"><a href="r-package.html#cb29-2"></a><span class="co">#&#39;</span></span>
<span id="cb29-3"><a href="r-package.html#cb29-3"></a><span class="co">#&#39; @param data A data frame with two rows. The first row indicates river length and</span></span>
<span id="cb29-4"><a href="r-package.html#cb29-4"></a><span class="co">#&#39;   second row indicates river discharge. The columns of data indicate river names.</span></span>
<span id="cb29-5"><a href="r-package.html#cb29-5"></a><span class="co">#&#39; @param pattern A pattern by which to include only particular rivers</span></span>
<span id="cb29-6"><a href="r-package.html#cb29-6"></a><span class="co">#&#39;</span></span>
<span id="cb29-7"><a href="r-package.html#cb29-7"></a><span class="co">#&#39; @return The median river length and mean river discharge for the desired rivers</span></span>
<span id="cb29-8"><a href="r-package.html#cb29-8"></a><span class="co">#&#39; @import stats</span></span>
<span id="cb29-9"><a href="r-package.html#cb29-9"></a><span class="co">#&#39; @export</span></span>
<span id="cb29-10"><a href="r-package.html#cb29-10"></a><span class="co">#&#39;</span></span>
<span id="cb29-11"><a href="r-package.html#cb29-11"></a><span class="co">#&#39; @examples</span></span>
<span id="cb29-12"><a href="r-package.html#cb29-12"></a><span class="co">#&#39; data(&quot;rivers&quot;)</span></span>
<span id="cb29-13"><a href="r-package.html#cb29-13"></a><span class="co">#&#39; river_medians(rivers, pattern = &quot;Mi&quot;)</span></span>
<span id="cb29-14"><a href="r-package.html#cb29-14"></a>river_medians &lt;-<span class="st"> </span><span class="cf">function</span>(data, pattern) {</span>
<span id="cb29-15"><a href="r-package.html#cb29-15"></a>  desired_rivers &lt;-<span class="st"> </span><span class="kw">grep</span>(pattern, <span class="kw">names</span>(data))</span>
<span id="cb29-16"><a href="r-package.html#cb29-16"></a>  new_data &lt;-<span class="st"> </span>data[, desired_rivers]</span>
<span id="cb29-17"><a href="r-package.html#cb29-17"></a>  <span class="kw">apply</span>(new_data, <span class="dv">1</span>, median)</span>
<span id="cb29-18"><a href="r-package.html#cb29-18"></a>}</span></code></pre></div>
<p>Be careful when using <code>@importFrom</code> or <code>@import</code> to ensure that two functions from different packages don’t have the same name – this is when using <code>packagename::</code> to prefix the function is crucial.</p>
<div id="exercises-2" class="section level4">
<h4><span class="header-section-number">1.2.7.1</span> Exercises</h4>
<ol style="list-style-type: decimal">
<li>Play around with using these functions for some new patterns – do you notice anything strange?</li>
</ol>
<p>These exercises are more challenging, so if they don’t make sense now, that is okay! Make sure to re-review the solutions after the workshop.</p>
<ol start="2" style="list-style-type: decimal">
<li><p>Write a new function, <code>river_stat()</code>, that takes a data frame, pattern, and a general function by which to summarize river length and discharge. This general function should not be an actual function but rather a placeholder so that a user may insert their own function as an argument.</p></li>
<li><p>Rewrite <code>river_stat()</code> so that it also takes additional arguments to the summarizing function (hint: use <code>...</code> as an argument)</p></li>
</ol>
</div>
</div>
<div id="description" class="section level3">
<h3><span class="header-section-number">1.2.8</span> DESCRIPTION</h3>
<p>The DESCRIPTION file is automatically added while creating an R package and contains the R package’s metadata.</p>
<pre><code>Package: RPRW
Title: R Packages for Reproducible Workflows
Version: 0.0.0.9000
Authors@R: 
    person(given = &quot;Michael&quot;,
           family = &quot;Dumelle&quot;,
           role = c(&quot;aut&quot;, &quot;cre&quot;),
           email = &quot;first.last@example.com&quot;)
Description: A companion R package for &quot;Using R Packages for Reproducible Workflows&quot;
    at the 2021 EPA R Workshop.
License: `use_mit_license()`, `use_gpl3_license()` or friends to pick a
    license
Encoding: UTF-8
LazyData: true
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.1.1
Depends: 
    R (&gt;= 2.10)
Imports: 
    stats</code></pre>
<p>The DESCRIPTION file is where you track version numbers, authorship, and additional R packages that your R package uses. Two fields in DESCRIPTION do most of the communication regarding how your R package uses additional R packages:</p>
<ol style="list-style-type: decimal">
<li><p>Imports: Packages here must be installed in order for your package to work. As a result, any package listed in <code>Imports</code> will be installed alongside your package. Packages in <code>Imports</code> help build the foundation of your package.</p></li>
<li><p>Suggests: Packages here enhance your package but are not required for your package to work. You might use suggested packages for enhanced plotting, additional data sets, or more. Packages in <code>Suggests</code> can add finishing touches to your package, but they are not part of your package’s foundation.</p></li>
</ol>
<p>Other fields used to communicate how your R package uses additional R packages are <code>Depends</code>, <code>LinkingTo</code>, and <code>Enhances</code>. The difference between <code>Depends</code> and <code>Imports</code> is subtle – the general advice is to use <code>Imports</code> instead of <code>Depends</code>.</p>
</div>
<div id="namespace" class="section level3">
<h3><span class="header-section-number">1.2.9</span> NAMESPACE</h3>
<p>While the DESCRIPTION file communicates what packages your package <em>uses</em>, the NAMESPACE file communicates <em>how</em> your package uses these packages. More specifically, the NAMESPACE file controls which functions your package exports (makes available to others) and what functions from what packages must be available for your exported functions to work. This file is automatically generated by devtools and should not be edited by hand.</p>
<p>In <code>river_median()</code>, if you called <code>median</code> using <code>stats::median</code>, your NAMESPACE file will look like</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="r-package.html#cb31-1"></a><span class="co"># Generated by roxygen2: do not edit by hand</span></span>
<span id="cb31-2"><a href="r-package.html#cb31-2"></a></span>
<span id="cb31-3"><a href="r-package.html#cb31-3"></a><span class="kw">export</span>(river_means)</span>
<span id="cb31-4"><a href="r-package.html#cb31-4"></a><span class="kw">export</span>(river_medians)</span></code></pre></div>
<p>If you used the <code>@importFrom stats median</code> approach, your NAMESPACE will look like</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="r-package.html#cb32-1"></a><span class="co"># Generated by roxygen2: do not edit by hand</span></span>
<span id="cb32-2"><a href="r-package.html#cb32-2"></a></span>
<span id="cb32-3"><a href="r-package.html#cb32-3"></a><span class="kw">export</span>(river_means)</span>
<span id="cb32-4"><a href="r-package.html#cb32-4"></a><span class="kw">export</span>(river_medians)</span>
<span id="cb32-5"><a href="r-package.html#cb32-5"></a><span class="kw">importFrom</span>(stats,median)</span></code></pre></div>
<p>If you used the <code>@import stats</code> approach, your NAMESPACE will look like</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="r-package.html#cb33-1"></a><span class="co"># Generated by roxygen2: do not edit by hand</span></span>
<span id="cb33-2"><a href="r-package.html#cb33-2"></a></span>
<span id="cb33-3"><a href="r-package.html#cb33-3"></a><span class="kw">export</span>(river_means)</span>
<span id="cb33-4"><a href="r-package.html#cb33-4"></a><span class="kw">export</span>(river_medians)</span>
<span id="cb33-5"><a href="r-package.html#cb33-5"></a><span class="kw">import</span>(stats)</span></code></pre></div>
</div>
<div id="testthat" class="section level3">
<h3><span class="header-section-number">1.2.10</span> testthat</h3>
<p>Testing your code to make sure that it performs as intended is an important step in the package building process. Though upfront, it may seem like extra work, implementing a rigorous testing procedure for your package will provide several benefits: <a href="https://r-pkgs.org/tests.html">fewer bugs, better code structure, easier restarts, and robust code</a>. In R, testing is incorporated into your package through the <a href="https://testthat.r-lib.org/">testthat</a> package. To begin using testthat, run</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="r-package.html#cb34-1"></a><span class="kw">use_testthat</span>()</span></code></pre></div>
<pre><code>√ Adding &#39;testthat&#39; to Suggests field in DESCRIPTION
√ Setting Config/testthat/edition field in DESCRIPTION to &#39;3&#39;
√ Creating &#39;tests/testthat/&#39;
√ Writing &#39;tests/testthat.R&#39;</code></pre>
<p>The root of your package directory shoudl look like
<img src="images/newrpack_files3.PNG" width="100%" /></p>
<p>The tests folder should look like
<img src="images/newrpack_files4.PNG" width="100%" /></p>
<p>Tests are generally written on a function-by-function basis. All tests for a function are contained in an R script titled <code>test-function_name</code>. For example, to start testing <code>river_means()</code>, run</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="r-package.html#cb36-1"></a><span class="kw">use_test</span>(<span class="st">&quot;river_means&quot;</span>)</span></code></pre></div>
<pre><code>√ Writing &#39;tests/testthat/test-river_means.R&#39;
* Modify &#39;tests/testthat/test-river_means.R&#39;</code></pre>
<p>Your <code>testthat</code> folder should look like
<img src="images/newrpack_files5.PNG" width="100%" /></p>
<p>Tests can be fairly detailed and cover many components of a function (such as input types, output types, function output, etc.). Here we write a simple test that calculates whether our function, <code>river_means()</code>, yields output that we would expect if we calculated the means “by hand” for an example scenario where our pattern includes Missouri and Mississippi.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="r-package.html#cb38-1"></a><span class="kw">test_that</span>(<span class="st">&quot;the mean length is calculated correctly in a test case&quot;</span>, {</span>
<span id="cb38-2"><a href="r-package.html#cb38-2"></a>  </span>
<span id="cb38-3"><a href="r-package.html#cb38-3"></a>  <span class="co"># calculate values required for the test for length</span></span>
<span id="cb38-4"><a href="r-package.html#cb38-4"></a></span>
<span id="cb38-5"><a href="r-package.html#cb38-5"></a>  <span class="co">## calculate the means from the function</span></span>
<span id="cb38-6"><a href="r-package.html#cb38-6"></a>  river_means_val &lt;-<span class="st"> </span><span class="kw">river_means</span>(rivers, <span class="st">&quot;Missouri|Mississippi&quot;</span>)</span>
<span id="cb38-7"><a href="r-package.html#cb38-7"></a>  river_means_length &lt;-<span class="st"> </span>river_means_val[[<span class="dv">1</span>]]</span>
<span id="cb38-8"><a href="r-package.html#cb38-8"></a></span>
<span id="cb38-9"><a href="r-package.html#cb38-9"></a>  <span class="co">## calculate the means &quot;by hand&quot;</span></span>
<span id="cb38-10"><a href="r-package.html#cb38-10"></a>  raw_vec_length &lt;-<span class="st"> </span><span class="kw">unlist</span>(rivers[<span class="st">&quot;length&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;Missouri&quot;</span>, <span class="st">&quot;Mississippi&quot;</span>)])</span>
<span id="cb38-11"><a href="r-package.html#cb38-11"></a>  raw_means_length &lt;-<span class="st"> </span><span class="kw">mean</span>(raw_vec_length)</span>
<span id="cb38-12"><a href="r-package.html#cb38-12"></a>  </span>
<span id="cb38-13"><a href="r-package.html#cb38-13"></a>  <span class="co"># perform the actual test for length</span></span>
<span id="cb38-14"><a href="r-package.html#cb38-14"></a></span>
<span id="cb38-15"><a href="r-package.html#cb38-15"></a>  <span class="co">## check that the function and &quot;by hand&quot; output matches</span></span>
<span id="cb38-16"><a href="r-package.html#cb38-16"></a>  <span class="kw">expect_equal</span>(river_means_length, raw_means_length)</span>
<span id="cb38-17"><a href="r-package.html#cb38-17"></a>})</span></code></pre></div>
<pre><code>#&gt; Error in test_that(&quot;the mean length is calculated correctly in a test case&quot;, : could not find function &quot;test_that&quot;</code></pre>
<p>The tests in testthat are prefixed with <code>expect_</code>. If you have many tests, the <code>test()</code> function runs all of them in the <code>testthat</code> folder:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="r-package.html#cb40-1"></a><span class="kw">test</span>()</span></code></pre></div>
<pre><code>i Loading RPRW
i Testing RPRW
√ |  OK F W S | Context
√ |   1       | river_means                                                     
                                               
== Results =========================================================================
[ FAIL 0 | WARN 0 | SKIP 0 | PASS 1 ]</code></pre>
<p>We can write a similar test for discharge and then repeat the process for <code>river_meadians()</code>. Then <code>test()</code> returns</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="r-package.html#cb42-1"></a><span class="kw">test</span>()</span></code></pre></div>
<pre><code>i Loading RPRW
i Testing RPRW
√ |  OK F W S | Context
√ |   2       | river_means                                                         
√ |   2       | river_medians                                                       

== Results =========================================================================
[ FAIL 0 | WARN 0 | SKIP 0 | PASS 4 ]</code></pre>
<p>All tests pass – hooray! I want to again emphasize how important testing is. I know that it seems like an extra chore, but in my experience, writing careful tests has always paid off…with interest.</p>
<div id="exercises-3" class="section level4">
<h4><span class="header-section-number">1.2.10.1</span> Exercises</h4>
<ol style="list-style-type: decimal">
<li>Write similar tests for <code>river_means()</code> (discharge), <code>river_medians()</code> (length), and <code>river_medians()</code> (length)</li>
</ol>
</div>
</div>
<div id="license" class="section level3">
<h3><span class="header-section-number">1.2.11</span> License</h3>
<p>At some point, your package needs a license. The license places restrictions on how your package can be shared with others. Licensing can be complicated quickly, so I refer you <a href="https://r-pkgs.org/license.html">here</a> for more information. For illustration purposes, we will use a GPL-3 license for this package.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="r-package.html#cb44-1"></a><span class="kw">use_gpl_license</span>()</span></code></pre></div>
<pre><code>√ Setting active project to &#39;path_to_RPRW_package/RPRW&#39;
√ Setting License field in DESCRIPTION to &#39;GPL (&gt;= 3)&#39;
√ Writing &#39;LICENSE.md&#39;
√ Adding &#39;^LICENSE\\.md$&#39; to &#39;.Rbuildignore&#39;</code></pre>
<p>The licensing update will be reflected in the DESCRIPTION file.</p>
</div>
<div id="vignettes" class="section level3">
<h3><span class="header-section-number">1.2.12</span> Vignettes</h3>
<p>Vignettes act as high-level user guides for your package. A vignette acts as the glue that binds together all the documentation from the individual functions to solve a particular problem. Typically, they guide the user through a typical workflow one would experience while using your package. The <a href="https://ggplot2.tidyverse.org/">ggplot2</a> package is a popular package for visualizing data. After installing ggplot2</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="r-package.html#cb46-1"></a><span class="kw">install.packages</span>(<span class="st">&quot;ggplot2&quot;</span>)</span></code></pre></div>
<p>you can view its available vignettes by running</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="r-package.html#cb47-1"></a><span class="kw">vignette</span>(<span class="dt">package =</span> <span class="st">&quot;ggplot2&quot;</span>)</span></code></pre></div>
<p>A file will pop up alongside your R scripts with the contents
<img src="images/newrpack_files6.PNG" width="100%" />
Then to view a specific vignette, run <code>vignette(topic, package)</code>. For example, to view the vignette regarding <strong>aes</strong>thetic specifications, run</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="r-package.html#cb48-1"></a><span class="kw">vignette</span>(<span class="st">&quot;ggplot2-specs&quot;</span>, <span class="st">&quot;ggplot2&quot;</span>)</span></code></pre></div>
<p>You will then see the vignette in the bottom-right hand pane of RStudio. Vignettes are also available on a package’s CRAN page – for the ggplot2 aesthetic specifications vignette, see <a href="https://cran.r-project.org/web/packages/ggplot2/vignettes/ggplot2-specs.html">here</a>.</p>
<p>To include vignettes in your R package, first run</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="r-package.html#cb49-1"></a><span class="kw">use_vignette</span>(<span class="st">&quot;river-statistics&quot;</span>, <span class="st">&quot;River Statistics&quot;</span>)</span></code></pre></div>
<pre><code>√ Adding &#39;knitr&#39; to Suggests field in DESCRIPTION
√ Setting VignetteBuilder field in DESCRIPTION to &#39;knitr&#39;
√ Adding &#39;inst/doc&#39; to &#39;.gitignore&#39;
√ Creating &#39;vignettes/&#39;
√ Adding &#39;*.html&#39;, &#39;*.R&#39; to &#39;vignettes/.gitignore&#39;
√ Adding &#39;rmarkdown&#39; to Suggests field in DESCRIPTION
√ Writing &#39;vignettes/river-statistics.Rmd&#39;
* Modify &#39;vignettes/river-statistics.Rmd&#39;</code></pre>
<p>A few things happen after running <code>use_vignette()</code>: your DESCRIPTION file is edited, a vignettes folder is inserted into the root of your directory, and a <code>.Rmd</code> file is added to the vignettes folder. The <code>.Rmd</code> file extension indicates that the vignette is an RMarkdown document. RMarkdown documents provide a convenient way to create <em>dynamic</em> documents. Dynamic documents combine code and text and form the foundation for reproducible report writing in R. More on RMarkdown is available <a href="https://rmarkdown.rstudio.com/">here</a>, <a href="https://bookdown.org/yihui/rmarkdown/">here</a> and <a href="https://bookdown.org/yihui/rmarkdown-cookbook/">here</a>. I highly recommend you get some experience with it, as its tools are quite powerful.</p>
<p>While we won’t create a vignette for our package during the workshop, I have added a vignette to the companion R package. After installation, it can be viewed by running</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="r-package.html#cb51-1"></a><span class="kw">vignette</span>(river<span class="op">-</span>statistics, <span class="st">&quot;RPRW&quot;</span>)</span></code></pre></div>
</div>
<div id="check" class="section level3">
<h3><span class="header-section-number">1.2.13</span> <code>check()</code></h3>
<p>So now we have built our R package and are ready to share it with the world! But we should probably check to make sure we did not make any small mistakes? This is what <code>check()</code> does – it runs through a series of checks on your package to make sure it can be properly installed and shared. <code>check()</code> takes a few minutes to run, but it will return errors, warnings, and notes associated with your package. Though the warnings and notes are important, it is most crucial to address the errors immediately.
Hopefully your output after running <code>check()</code> looks like</p>
<pre><code>-- R CMD check results ---------- RPRW 0.0.0.9000 ----
Duration: 34.4s

0 errors √ | 0 warnings √ | 0 notes √</code></pre>
</div>
<div id="install" class="section level3">
<h3><span class="header-section-number">1.2.14</span> <code>install()</code></h3>
<p>After <code>check()</code> returns zero errors (and hopefully zero warnings and notes), you can install your package by running</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="r-package.html#cb53-1"></a><span class="kw">install</span>()</span></code></pre></div>
<p>After installation, you can use <code>library()</code> to load your package (like you do any other R package).</p>
</div>
<div id="congratulations" class="section level3">
<h3><span class="header-section-number">1.2.15</span> Congratulations</h3>
<p>Congratulations on building an R package!</p>
<p><img src="images/you_did_it.jpg" width="50%" /></p>
</div>
</div>
<div id="debugging" class="section level2">
<h2><span class="header-section-number">1.3</span> Debugging</h2>
<p>Even the best of programmers write code that may fail in unintended ways. This is referred to as a “bug,” and the process of fixing the “bug” is known as “debugging”. Don’t expect to always write perfect code – do expect to have the tools necessary to track down bugs and remedy them. Though we went through a rigorous documentation and testing procedure when creating <code>river_means()</code> and <code>river_medians()</code>, there are still bugs present in these functions.</p>
<div id="a-mysterious-error-message" class="section level3">
<h3><span class="header-section-number">1.3.1</span> A Mysterious Error Message</h3>
<p>We have used <code>river_means()</code> and <code>river_medians()</code> to successfully find means and medians for all sorts of river combinations. But running</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="r-package.html#cb54-1"></a><span class="kw">river_means</span>(rivers, <span class="st">&quot;R&quot;</span>)</span></code></pre></div>
<pre><code>#&gt; Error in rowMeans(new_data): &#39;x&#39; must be an array of at least two dimensions</code></pre>
<p>yields a mystifying error. Something is wrong – and we need to figure out what. A good first step is to copy and paste the error into a Google search engine and see if anyone has solved the problem yet. If you are lucky, this will help you find the bug. If not, you need to use another approach. Fortunately, R has tools to help isolate bugs.</p>
</div>
<div id="traceback" class="section level3">
<h3><span class="header-section-number">1.3.2</span> <code>traceback()</code></h3>
<p>The <code>traceback()</code> function is run after code generating an error and it identifies where the error occurred.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="r-package.html#cb56-1"></a><span class="kw">traceback</span>()</span></code></pre></div>
<pre><code>#&gt; No traceback available</code></pre>
<p>Locating the source of bugs goes a long way towards removing them. Here, we see that the function failed at the <code>rowMeans()</code> step of <code>river_means()</code>. While useful, we still don’t exactly know why the error is occurring.</p>
</div>
<div id="browser" class="section level3">
<h3><span class="header-section-number">1.3.3</span> <code>browser()</code></h3>
<p>Before I learned about <code>browser()</code>, I would try to debug by storing my arguments locally (so that they were in the global environment) and then sequentially running each line of the function one-at-a-time. Perhaps some of you have done this too. Unfortunately, for many reasons (which we don’t discuss in detail today), its an inferior method of debugging compared to <code>browser()</code>. The <code>browser()</code> method involves inserting <code>browser()</code> into the body of your function. Running your function with <code>browser()</code> inside of it then let’s you interactively step into the function at <code>browser()</code>. No more storing arguments and running code line-by-line! Let’s try this out with <code>river_means()</code></p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="r-package.html#cb58-1"></a>river_means &lt;-<span class="st"> </span><span class="cf">function</span>(data, pattern) {</span>
<span id="cb58-2"><a href="r-package.html#cb58-2"></a>  <span class="kw">browser</span>()</span>
<span id="cb58-3"><a href="r-package.html#cb58-3"></a>  desired_rivers &lt;-<span class="st"> </span><span class="kw">grep</span>(pattern, <span class="kw">names</span>(data))</span>
<span id="cb58-4"><a href="r-package.html#cb58-4"></a>  new_data &lt;-<span class="st"> </span>data[, desired_rivers]</span>
<span id="cb58-5"><a href="r-package.html#cb58-5"></a>  <span class="kw">rowMeans</span>(new_data)</span>
<span id="cb58-6"><a href="r-package.html#cb58-6"></a>}</span></code></pre></div>
<p>Now when running <code>river_means()</code>, you will step into the function. For example,</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="r-package.html#cb59-1"></a><span class="kw">river_means</span>(rivers, <span class="st">&quot;R&quot;</span>)</span></code></pre></div>
<p>will open a new file that looks like
<img src="images/newrpack_files7.PNG" width="100%" /></p>
<p>In your new interactive context, you will see a few buttons in the R console (lower left-hand window)
<img src="images/newrpack_files8.PNG" width="100%" /></p>
<p>These are five buttons to type into the console and evaluate (<code>Enter/Return</code>) that let you navigate the interactive context. In order (left to right), they are</p>
<ul>
<li>Next (<code>n</code>) executes the next line of the code</li>
<li>Step (<code>s</code>) steps into the function called by the current line of code</li>
<li>Finish (<code>f</code>) finishes execution of the current function</li>
<li>Continue (<code>c</code>) leaves the interactive context and continues execution of the function</li>
<li>Stop (<code>Q</code>) leaves the interactive context and terminates execution of the function</li>
</ul>
<p>In the interactive context of <code>river_means()</code>, we see <code>data</code> and <code>pattern</code> are defined:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="r-package.html#cb60-1"></a><span class="kw">print</span>(data)</span></code></pre></div>
<pre><code>#&gt;           Missouri Mississippi Yukon Colorado Arkansas Columbia  Red Canadian
#&gt; length        3768        3544  3190     2330     2322     2000 1811     1458
#&gt; discharge     1956       18400  6340       40     1004     7730  852      174</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="r-package.html#cb62-1"></a><span class="kw">print</span>(pattern)</span></code></pre></div>
<pre><code>#&gt; [1] &quot;R&quot;</code></pre>
<p>Pressing <code>n</code> executes <code>browser()</code>. Pressing <code>n</code> again executes</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="r-package.html#cb64-1"></a>desired_rivers &lt;-<span class="st"> </span><span class="kw">grep</span>(pattern, <span class="kw">names</span>(data))</span></code></pre></div>
<p>Inspecting <code>desired_rivers</code>, we see</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="r-package.html#cb65-1"></a><span class="kw">print</span>(desired_rivers)</span></code></pre></div>
<pre><code>#&gt; [1] 7</code></pre>
<p>This seems correct, so the error does not appear to be here. Let’s press <code>n</code> to evaluate the next line</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="r-package.html#cb67-1"></a>new_data &lt;-<span class="st"> </span>data[, desired_rivers]</span></code></pre></div>
<p>Inspecting <code>new_data</code>, we see</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="r-package.html#cb68-1"></a>new_data</span></code></pre></div>
<pre><code>#&gt; [1] 1811  852</code></pre>
<p>Well this seems weird – it does not look like a data frame. Let’s inspect the structure</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="r-package.html#cb70-1"></a><span class="kw">str</span>(new_data)</span></code></pre></div>
<pre><code>#&gt;  num [1:2] 1811 852</code></pre>
<p>It is not a data frame, but rather a numeric vector. Because <code>rowMeans()</code> requires an array of two or more dimensions (e.g. matrix or data frame), the next line of code fails. Pressing <code>n</code> again returns the error and removes you from the interactive context</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="r-package.html#cb72-1"></a><span class="kw">rowMeans</span>(new_data)</span></code></pre></div>
<pre><code>#&gt; Error in rowMeans(new_data): &#39;x&#39; must be an array of at least two dimensions</code></pre>
<p>A similar error occurs within <code>river_medians()</code> when running <code>apply()</code></p>
<p>So what is happening here? We know the code works when the pattern yields at least two matches in <code>rivers</code>, and we know the code behaves oddly when the pattern only has one match. Looking at the documentation of <code>[</code> we see a <code>drop</code> argument, which coerces to the lowest possible dimension when equal to <code>TRUE</code>. When subsetting data frames, <code>drop</code> is <code>TRUE</code> by default. So when subsetting a data frame using a single column, the data frame structure is only preserved when <code>drop = FALSE</code>. Accommodating this change in <code>river_means()</code> and <code>river_medians()</code> yields functions whose bodies looks like</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="r-package.html#cb74-1"></a>river_means &lt;-<span class="st"> </span><span class="cf">function</span>(data, pattern) {</span>
<span id="cb74-2"><a href="r-package.html#cb74-2"></a>  desired_rivers &lt;-<span class="st"> </span><span class="kw">grep</span>(pattern, <span class="kw">names</span>(data))</span>
<span id="cb74-3"><a href="r-package.html#cb74-3"></a>  new_data &lt;-<span class="st"> </span>data[, desired_rivers, drop =<span class="st"> </span><span class="ot">FALSE</span>]</span>
<span id="cb74-4"><a href="r-package.html#cb74-4"></a>  <span class="kw">rowMeans</span>(new_data)</span>
<span id="cb74-5"><a href="r-package.html#cb74-5"></a>}</span>
<span id="cb74-6"><a href="r-package.html#cb74-6"></a></span>
<span id="cb74-7"><a href="r-package.html#cb74-7"></a>river_medians &lt;-<span class="st"> </span><span class="cf">function</span>(data, pattern) {</span>
<span id="cb74-8"><a href="r-package.html#cb74-8"></a>  desired_rivers &lt;-<span class="st"> </span><span class="kw">grep</span>(pattern, <span class="kw">names</span>(data))</span>
<span id="cb74-9"><a href="r-package.html#cb74-9"></a>  new_data &lt;-<span class="st"> </span>data[, desired_rivers, drop =<span class="st"> </span><span class="ot">FALSE</span>]</span>
<span id="cb74-10"><a href="r-package.html#cb74-10"></a>  <span class="kw">apply</span>(new_data, <span class="dv">1</span>, median)</span>
<span id="cb74-11"><a href="r-package.html#cb74-11"></a>}</span></code></pre></div>
<p>Running these functions with <code>pattern = "R"</code> behaves as intended</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="r-package.html#cb75-1"></a><span class="kw">river_means</span>(rivers, <span class="st">&quot;R&quot;</span>)</span></code></pre></div>
<pre><code>#&gt;    length discharge 
#&gt;      1811       852</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="r-package.html#cb77-1"></a><span class="kw">river_medians</span>(rivers, <span class="st">&quot;R&quot;</span>)</span></code></pre></div>
<pre><code>#&gt;    length discharge 
#&gt;      1811       852</code></pre>
<p>For more information about debugging in R, <a href="https://www.youtube.com/watch?v=vgYS-F8opgE">watch</a> or <a href="https://adv-r.hadley.nz/debugging.html">read</a>.</p>
</div>
<div id="another-error-no-mysterious-message" class="section level3">
<h3><span class="header-section-number">1.3.4</span> Another Error – No Mysterious Message</h3>
<p>We received and fixed an error message that occurred when the pattern only matched one river. But what happens when it matches zero rivers?</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="r-package.html#cb79-1"></a><span class="kw">river_means</span>(rivers, <span class="st">&quot;ZZZ&quot;</span>)</span>
<span id="cb79-2"><a href="r-package.html#cb79-2"></a><span class="kw">river_medians</span>(rivers, <span class="st">&quot;ZZZ&quot;</span>)</span></code></pre></div>
<p>These types of bugs are especially pernicious because there is no error message associated with them. Whenever the output is unexpected, use <code>browser()</code> to diagnose the problem. In this context, <code>desired_rivers</code> is a length-zero vector, which causes problems in the remaining parts of the function. To guard against these types of bugs, program defensively and force the function to return an error message early.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="r-package.html#cb80-1"></a>river_means &lt;-<span class="st"> </span><span class="cf">function</span>(data, pattern) {</span>
<span id="cb80-2"><a href="r-package.html#cb80-2"></a>  desired_rivers &lt;-<span class="st"> </span><span class="kw">grep</span>(pattern, <span class="kw">names</span>(data))</span>
<span id="cb80-3"><a href="r-package.html#cb80-3"></a>  <span class="cf">if</span> (<span class="kw">length</span>(desired_rivers) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</span>
<span id="cb80-4"><a href="r-package.html#cb80-4"></a>    <span class="kw">stop</span>(<span class="st">&quot;This is an error message that stops the function&quot;</span>)</span>
<span id="cb80-5"><a href="r-package.html#cb80-5"></a>  }</span>
<span id="cb80-6"><a href="r-package.html#cb80-6"></a>  new_data &lt;-<span class="st"> </span>data[, desired_rivers, drop =<span class="st"> </span><span class="ot">FALSE</span>]</span>
<span id="cb80-7"><a href="r-package.html#cb80-7"></a>  <span class="kw">rowMeans</span>(new_data)</span>
<span id="cb80-8"><a href="r-package.html#cb80-8"></a>}</span>
<span id="cb80-9"><a href="r-package.html#cb80-9"></a><span class="kw">river_means</span>(rivers, <span class="st">&quot;ZZZ&quot;</span>)</span></code></pre></div>
<pre><code>#&gt; Error in river_means(rivers, &quot;ZZZ&quot;): This is an error message that stops the function</code></pre>
<div id="exercises-4" class="section level4">
<h4><span class="header-section-number">1.3.4.1</span> Exercises</h4>
<ol style="list-style-type: decimal">
<li>Rewrite <code>river_medians()</code> so that it stops when no patterns are matched and returns an informative error message.</li>
</ol>
</div>
</div>
</div>
<div id="additional-resources" class="section level2">
<h2><span class="header-section-number">1.4</span> Additional Resources</h2>
<ul>
<li><a href="https://r-pkgs.org/index.html">R Packages</a> by <a href="http://hadley.nz/">Hadley Wickham</a> and <a href="https://jennybryan.org/">Jenny Bryan</a></li>
<li><a href="https://hilaryparker.com/2014/04/29/writing-an-r-package-from-scratch/">Writing an R package from scratch</a> by <a href="https://hilaryparker.com/">Hilary Parker</a></li>
<li><a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html">Writing R Extensions</a> by CRAN (this resource is very technical)</li>
</ul>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-marwick2018packaging">
<p>Marwick, Ben, Carl Boettiger, and Lincoln Mullen. 2018. “Packaging Data Analytical Work Reproducibly Using R (and Friends).” <em>The American Statistician</em> 72 (1): 80–88.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="a-research-compendia.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/01-r-package.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
