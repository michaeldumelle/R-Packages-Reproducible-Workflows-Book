% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{book}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Using R Packages for Reproducible Workflows},
  pdfauthor={Michael Dumelle},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs}
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{booktabs}
\usepackage[]{natbib}
\bibliographystyle{plainnat}

\title{Using R Packages for Reproducible Workflows}
\author{Michael Dumelle}
\date{September 22, 2021}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{1}
\tableofcontents
}
\hypertarget{welcome}{%
\chapter*{Welcome}\label{welcome}}
\addcontentsline{toc}{chapter}{Welcome}

Welcome to the 2021 EPA R Workshop titled ``Using R Packages for Reproducible Workflows'' by me, Michael Dumelle -- I am glad to have you here! You should have R and RStudio installed before starting this workshop. If not, no problem -- just follow along with me as we proceed through the workshop and revisit this book later. R code and output from this workshop are in blocks with gray background like this

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\KeywordTok{print}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> [1] 1 2 3
\end{verbatim}

You can copy and paste these blocks by hovering your cursor in the upper-right portion of the block and clicking the copy button (which looks like two pages that slightly overlap). You can either follow along throughout the workshop by copying and pasting the R code onto your machine and/or by reading the R code output the book provides. Sometimes when I use functions, I will prefix the function call \texttt{package::} so that it is clear what package the function is from. For example, \texttt{ggplot2::ggsave()} calls the \texttt{ggsave()} function in the \texttt{ggplot2} package.

There are two types of hyperlinks in this book: internal and external. Internal hyperlinks take you to the place in the book. External hyperlinks will take you to a webpage outside of the book. Both internal and external links will be described in text but the actual link will follow the relevant text and read (\href{}{internal link}) or (\href{}{external link}). There are several options in the upper-left toolbar of the book.

\includegraphics[width=1\linewidth]{images/newrpack_files0}

From left to right, they let you:

\begin{itemize}
\tightlist
\item
  Collapse or expand the table of contents
\item
  Search throughout the document
\item
  Adjust font size (small or large), font type (Serif or Sans), and color scheme (White, Sepia, or Night)
\item
  Edit the book (you don't have access to this one)
\item
  Download the book as a PDF or EPUB book (formatting warning: the book was built for a workshop format, not a PDF or EPUB format)

  \begin{itemize}
  \tightlist
  \item
    If you are unable to download the PDF via this link, it is also available here (\href{https://github.com/michaeldumelle/R-Packages-Reproducible-Workflows-Book/blob/main/docs/_main.pdf}{external link})
  \end{itemize}
\item
  Use a Javascript keyboard shortcut helper
\end{itemize}

This workshop book was published using Bookdown \citep{xie2016bookdown}. The book will be maintained for an indefinite amount of time after the workshop, so feel free to check back in for a refresher whenever you would like!

\hypertarget{schedule}{%
\section*{Schedule}\label{schedule}}
\addcontentsline{toc}{section}{Schedule}

Here is the tentative schedule for today:

\begin{itemize}
\tightlist
\item
  1:00 - 1:15 EDT: Introductions and Getting Started (\protect\hyperlink{getting-started}{internal link})
\item
  1:15 - 2:00 EDT: Building an R Package Part I (\protect\hyperlink{r-package}{internal link})
\item
  2:00 - 2:10 EDT: Break
\item
  2:10 - 2:50 EDT: Building an R Package Part II (\protect\hyperlink{r-package}{internal link})
\item
  2:50 - 3:05 EDT: Break
\item
  3:05 - 3:50 EDT: Making an R Package a Research Compendium (\protect\hyperlink{r-package-rc}{internal link})
\item
  3:50 - 4:00 EDT: Break
\item
  4:00 - 4:30 EDT: Extensions (\protect\hyperlink{extensions}{internal link})
\item
  4:30 - 4:40 EDT: Break
\item
  4:40 - 5:00 EDT: Questions
\end{itemize}

We will try to roughly adhere to this schedule, but it is possible that we stray slightly from it -- this is my first time giving the workshop!

\hypertarget{about-me}{%
\section*{About Me}\label{about-me}}
\addcontentsline{toc}{section}{About Me}

I finished my PhD in statistics at Oregon State University in 2020. I now work in ORD-CPHEA-PESD-FEB as a statistician, primarily on the National Aquatic Resource Surveys (NARS) team. My main research interests are sampling and survey design, spatial statistics, and software development. To learn more about me and my work, visit my website (\href{https://michaeldumelle.github.io/}{external link}).

\hypertarget{acknowledgements}{%
\section*{Acknowledgements}\label{acknowledgements}}
\addcontentsline{toc}{section}{Acknowledgements}

I would like to thank Charlotte Wickham, Hadley Wickham, Jenny Bryan, and Yihui Xie for the immense impact their work has had on my programming journey. Much of this workshop draws from heavily their inspiration. I would also like to thank everyone who helped me create and give this workshop. A special thanks to for providing feedback after the first version of the workshop that significantly improved future versions.

\hypertarget{getting-started}{%
\section*{Getting Started}\label{getting-started}}
\addcontentsline{toc}{section}{Getting Started}

The first thing we need to do is install and load the devtools (\href{https://devtools.r-lib.org/}{external link}) package by running

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"devtools"}\NormalTok{, }\DataTypeTok{dependencies =} \OtherTok{TRUE}\NormalTok{)}
\KeywordTok{library}\NormalTok{(devtools)}
\end{Highlighting}
\end{Shaded}

The devtools package contains tools to make developing R packages easier, and we will use functions in devtools frequently throughout this workshop. devtools is closely linked to the usethis (\href{https://usethis.r-lib.org/}{external link}) package, which is installed alongside devtools. The usethis package contains tools that make package development less tedious and more structured.

In this workshop we will build an R package named RPRW (\textbf{R} \textbf{P}ackages for \textbf{R}eproducible \textbf{W}orkflows) designed to quantify properties of rivers in North America. Then we will turn RPRW into a research compendium, a standard by which to organize a body of work.

If you don't want to build RPRW now and just want to look at the finished product, you can download in its entirety by running

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{devtools}\OperatorTok{::}\KeywordTok{install_github}\NormalTok{(}
  \DataTypeTok{repo =} \StringTok{"michaeldumelle/cRPRW"}\NormalTok{,}
  \DataTypeTok{ref =} \StringTok{"main"}\NormalTok{,}
  \DataTypeTok{build_vignettes =} \OtherTok{TRUE}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Notice that it has a ``c'' (short for ``companion'') prefix to RPRW to avoid conflicts with the version you build yourself today.

Then you can load cRPRW by running

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(cRPRW)}
\end{Highlighting}
\end{Shaded}

Now that we have devtools installed and have talked about RPRW, let's get started building this R package!

\begin{center}\includegraphics[width=0.5\linewidth]{images/coding} \end{center}

\hypertarget{r-package}{%
\chapter{Building an R Package}\label{r-package}}

\hypertarget{what-is-an-r-package}{%
\section{What is an R Package?}\label{what-is-an-r-package}}

An R package is a collection of code, data, documentation, and tests with a particular structure that can be shared with others. R packages are commonly downloaded from the Comprehensive R Archive Network (CRAN) (\href{https://cran.r-project.org/}{external link}). You can install them from CRAN by running

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"package_name"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

load them by running

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(package_name)}
\end{Highlighting}
\end{Shaded}

and get help by running

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{?package_name}
\end{Highlighting}
\end{Shaded}

After loading packages, you can refer to functions within them by interactively running \texttt{function\_name()}. To be explicit about which functions come from which packages, I tend to refer to them as \texttt{package\_name::function\_name()}. The package name prefix actually prevents the need to explicitly load the package using \texttt{library()}.

One of the many reasons R packages are so useful is because they are the fundamental vessel by which to share R code. If your code is in a package, others can easily download and use it -- this is the essence of open-source software! Most R users have some experience with at least one package, so they will likely be familiar with how to use yours after you share it. But sharing code is not the only benefit of creating packages -- a major benefit of using packages is that they enforce your code is built using a certain structure. Adhering to this structure:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  saves you time -- You don't need to think about how to organize your files because packages tell you how these files must be organized!

  \begin{itemize}
  \tightlist
  \item
    This rigid structure is especially helpful for me -- before I started creating packages my R scripts would be saved in all sorts of locations with no particular organization structure. This made it \emph{very challenging} to come back to my work later and find a particular script.
  \end{itemize}
\item
  gives you access to a set of standardized tools -- people have created many useful tools that work with R packages, so take advantage of them!

  \begin{itemize}
  \tightlist
  \item
    e.g.~devtools and usethis
  \end{itemize}
\item
  forces you to frequently document your work

  \begin{itemize}
  \tightlist
  \item
    Before I started using R packages, when I would come back my old code, I was convinced someone else wrote it -- I basically had to rewrite it all to understand it. R packages help prevent this.
  \end{itemize}
\item
  keeps your code, documentation, and package dependencies all in sync
\item
  guides your research compendium
\item
  can make your research compendium completely reproducible and easy to share

  \begin{itemize}
  \tightlist
  \item
    This is because packages are built upon R projects, which we discuss more later.
  \end{itemize}
\end{enumerate}

\hypertarget{ex-set1}{%
\subsection{Exercises}\label{ex-set1}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  What are some of your favorite R packages?
\item
  Of those we have talked about so far, what benefits of R packages are most appealing to you?
\end{enumerate}

\hypertarget{creating-an-r-package}{%
\section{Creating an R Package}\label{creating-an-r-package}}

Next we will create the RPRW package together! If this is your first R package, then an extra special congratulations to you -- this is a big milestone! For those interested in viewing the source code of the RPRW package, visit the GitHub repository here (\href{https://github.com/michaeldumelle/RPRW}{external link}).

\hypertarget{the-motivating-dataset}{%
\subsection{The Motivating Dataset}\label{the-motivating-dataset}}

Suppose we want RPRW to summarize the length (in kilometers) and discharge (meters per second cubed) of North American rivers. Suppose we also want RPRW to easily accommodate many subsets of rivers based on their name. Below are our data of interest:

\begin{verbatim}
#>           Missouri Mississippi Yukon Colorado Arkansas Columbia  Red Canadian
#> length        3768        3544  3190     2330     2322     2000 1811     1458
#> discharge     1956       18400  6340       40     1004     7730  852      174
\end{verbatim}

If the structure of \texttt{river} is atypical to you, see Exercise 3.7.1.1 (\protect\hyperlink{ex-set14}{internal link}).

\hypertarget{first-step}{%
\subsection{The First Step}\label{first-step}}

The first step is using devtools to create a package template for us. There are a two ways to easily create this template: \texttt{usethis::create\_package()} and the RStudio toolbar. In this class we will use \texttt{usethis::create\_package()}. Suppose you want the R package to be contained in the folder ``RPRW'' at the location on your computer specified by ``path\_to\_RPRW\_package'' (which must exist). To create the R package, run

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{usethis}\OperatorTok{::}\KeywordTok{create_package}\NormalTok{(}\StringTok{"path_to_RPRW_package/RPRW"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
√ Creating 'path_to_RPRW_package/RPRW/'
√ Setting active project to 'path_to_RPRW_package/RPRW'
√ Creating 'R/'
√ Writing 'DESCRIPTION'
Package: RPRW
Title: What the Package Does (One Line, Title Case)
Version: 0.0.0.9000
Authors@R (parsed):
    * First Last <first.last@example.com> [aut, cre] (YOUR-ORCID-ID)
Description: What the package does (one paragraph).
License: `use_mit_license()`, `use_gpl3_license()` or friends to
    pick a license
Encoding: UTF-8
LazyData: true
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.1.1
√ Writing 'NAMESPACE'
√ Writing 'RPRW.Rproj'
√ Adding '^RPRW\\.Rproj$' to '.Rbuildignore'
√ Adding '.Rproj.user' to '.gitignore'
√ Adding '^\\.Rproj\\.user$' to '.Rbuildignore'
√ Opening 'path_to_RPRW_package/RPRW/' in new RStudio session
√ Setting active project to '<no active project>'
√ Setting active project to 'path_to_RPRW_package/RPRW'
\end{verbatim}

RStudio will automatically create a new window, and you can safely close the old RStudio window. As you can see in the ``Files'' tab of the bottom-right RStudio pane, this new window is ``placed'' within ``path\_to\_RPRW\_package/RPRW'' and you can see several newly created files.

\includegraphics[width=1\linewidth]{images/newrpack_files}

Notice the \texttt{.Rproj} file, which indicates that your package is also an R project. We talk about R projects later, but the takeaway is that they provide a convenient default place for R to look for files (more formally, this default place is called a working directory). This is convenient because the functions in devtools and usethis we explore later will operate on the files in our working directory, which is forced to be the root of the ``RPRW'' folder by the package structure. Finally, notice that the top-right RStudio pane now has a ``Build'' tab, which contains some useful tools for your R package.

If you instead want to use the RStudio toolbar approach, navigate to ``File -\textgreater{} New Project -\textgreater{} New Directory -\textgreater{} R Package -\textgreater{} Create Project'' in the RStudio toolbar. With this approach, you will not see any output in the R console of your original RStudio window.

\hypertarget{some-prelminaries}{%
\subsection{Some prelminaries}\label{some-prelminaries}}

Because \texttt{usethis::create\_package()} created a new RStudio window for us, we need to reload devtools (which also loads usethis:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(devtools)}
\end{Highlighting}
\end{Shaded}

Next we will store the river data (the motivating dataset) in the global environment so we can work with it:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{river <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}
  \DataTypeTok{Missouri =} \KeywordTok{c}\NormalTok{(}\DecValTok{3768}\NormalTok{, }\DecValTok{1956}\NormalTok{),}
  \DataTypeTok{Mississippi =} \KeywordTok{c}\NormalTok{(}\DecValTok{3544}\NormalTok{, }\DecValTok{18400}\NormalTok{),}
  \DataTypeTok{Yukon =} \KeywordTok{c}\NormalTok{(}\DecValTok{3190}\NormalTok{, }\DecValTok{6340}\NormalTok{),}
  \DataTypeTok{Colorado =} \KeywordTok{c}\NormalTok{(}\DecValTok{2330}\NormalTok{, }\DecValTok{40}\NormalTok{),}
  \DataTypeTok{Arkansas =} \KeywordTok{c}\NormalTok{(}\DecValTok{2322}\NormalTok{, }\DecValTok{1004}\NormalTok{),}
  \DataTypeTok{Columbia =} \KeywordTok{c}\NormalTok{(}\DecValTok{2000}\NormalTok{, }\DecValTok{7730}\NormalTok{),}
  \DataTypeTok{Red =} \KeywordTok{c}\NormalTok{(}\DecValTok{1811}\NormalTok{, }\DecValTok{852}\NormalTok{),}
  \DataTypeTok{Canadian =} \KeywordTok{c}\NormalTok{(}\DecValTok{1458}\NormalTok{, }\DecValTok{174}\NormalTok{)}
\NormalTok{) }
\KeywordTok{rownames}\NormalTok{(river) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"length"}\NormalTok{, }\StringTok{"discharge"}\NormalTok{)}
\KeywordTok{print}\NormalTok{(river)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#>           Missouri Mississippi Yukon Colorado Arkansas Columbia  Red Canadian
#> length        3768        3544  3190     2330     2322     2000 1811     1458
#> discharge     1956       18400  6340       40     1004     7730  852      174
\end{verbatim}

\hypertarget{first-function}{%
\subsection{The First Function}\label{first-function}}

R packages are composed of several functions that work together to accomplish a set of goals. Within your R package, the folder named ``R'' is where functions live. Let's create our first function, \texttt{river\_means()}, which finds the mean river length and discharge of desired rivers. To create an R script named \texttt{river\_means.R} in the package's R folder, run

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{usethis}\OperatorTok{::}\KeywordTok{use_r}\NormalTok{(}\StringTok{"river_means"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

You will see some output in the console

\begin{verbatim}
* Modify 'R/river_means.R'
* Call `use_test()` to create a matching test file 
\end{verbatim}

and the R script is opened in the editor window of RStudio and placed in the R folder.

\includegraphics[width=1\linewidth]{images/newrpack_function}

Generally, the name of your file should match the name of the function, and you should use separate files for separate functions. More experienced R users -- it is okay to break this rule every once in a while depending on the context.

The body of \texttt{river\_means()} looks like

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{river_means <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{rowMeans}\NormalTok{(new_data)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

There are two arguments in \texttt{river\_means()}:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \texttt{data}: A data frame (whose rows represent length or discharge and whose columns represent rivers)

  \begin{itemize}
  \tightlist
  \item
    Making \texttt{data} the first argument to \texttt{river\_means()} makes it naturally pipeable (\href{https://r4ds.had.co.nz/pipes.html}{external link})
  \end{itemize}
\item
  \texttt{pattern}: A character string indicating the pattern by which to subset the rivers in \texttt{data} before calculating means (all rivers whose names satisfy the pattern are kept)
\end{enumerate}

There are three lines of code in \texttt{river\_means()}:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Find the variables (rivers) in \texttt{data} whose names contain the pattern.
\item
  Subset \texttt{data} to include only the rivers whose names contain the pattern
\item
  Find the mean length and discharge of the rivers whose names contain the pattern
\end{enumerate}

By default, the function returns the object evaluated by its last line of code. So \texttt{river\_means()} returns the output from \texttt{rowMeans()}. You can force the function to return a different object earlier using \texttt{return(object)}.

You can leave comments in your function by prefixing a line with \texttt{\#}. Comments are used to communicate in plain language the intent of your code. Leaving comments is usually good practice because it helps others (including future you) better understand the goals of your code.

Paste this code into your version of \texttt{river\_means.R} and click the save icon (or \texttt{Ctrl\ +\ S}).

\hypertarget{load-all}{%
\subsection{\texorpdfstring{\texttt{devtools::load\_all()}}{devtools::load\_all()}}\label{load-all}}

Now that we have written \texttt{river\_means()}, it is natural to want to try it out. Though we wrote our function in \texttt{river\_means.R}, to use it interactively we must tell R that it is an object we want to use. If you were not making an R package, you may store \texttt{river\_means()} by running \texttt{river\_means()} in ``R/river\_means.R'' script, copying and pasting \texttt{river\_means()} into the console and pressing \texttt{Enter}, or by running

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{source}\NormalTok{(}\StringTok{"R/river_means.R"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

These approaches put \texttt{river\_means()} in the global environment (look at the environment tab in the upper-right pane of RStudio). Unfortunately messing around too much in the global environment can easily introduce errors in your functions or have them behave in unexpected ways.

To approach we use here is to leverage devtools, since after all, you are bothering to create a package, so you may as well use the tools designed for them! The devtools function \texttt{devtools::load\_all()} emulates the process of building, installing, and loading a package. This has a few benefits. First, the functions are ``sourced'' into a better spot (not the global environment). Second, it makes all of your functions (and data, which we get to soon) available through a single line of code rather than running and/or sourcing several functions separately. I highly recommend you practice using \texttt{devtools::load\_all()} instead of navigating the global environment.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{devtools}\OperatorTok{::}\KeywordTok{load_all}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

By running \texttt{search()} or selecting the drop-down ``Global Environment'' window in the ``Environment'' pane (upper-right pane in RStudio), you see \texttt{package:RPRW}, which indicates \texttt{devtools::load\_all()} is treating RPRW like a package. If you make any changes to your functions, make sure to save them and rerun \texttt{devtools::load\_all()}.

Now we get to try out \texttt{river\_means()}! Suppose we want to summarize the rivers whose names start with ``Mi'' (in \texttt{river}, this is only Missouri and Mississippi).

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{river_means}\NormalTok{(river, }\StringTok{"Mi"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#>    length discharge 
#>      3656     10178
\end{verbatim}

Next suppose we want to summarize rivers whose names start with ``Y'' (Yukon) or ``R'' (Red)?

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{river_means}\NormalTok{(river, }\StringTok{"Y|R"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#>    length discharge 
#>    2500.5    3596.0
\end{verbatim}

Hooray -- our function works! Give yourself a congratulations :)! And for more on patterns and strings in R, visit here (\href{https://r4ds.had.co.nz/strings.html}{external link}) and here (\href{https://bookdown.org/rdpeng/rprogdatascience/regular-expressions.html\#sub-and-gsub}{external link}).

\hypertarget{ex-set2}{%
\subsubsection{Exercises}\label{ex-set2}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  How many functions does \texttt{river\_means()} call within the body of the function? What package are these functions in?
\item
  Try using \texttt{river\_means()} with a few different patterns. Do you notice anything strange?
\end{enumerate}

\hypertarget{creating-data}{%
\subsection{Creating Package Data}\label{creating-data}}

So far the \texttt{river} data has been stored in our global environment. What if you want to save this data in an easily accessible location and/or share it with others? Another package development tool to the rescue -- \texttt{usethis::use\_data()} (are you starting to notice the benefits of the additional tools devtools and usethis provide packages?).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{usethis}\OperatorTok{::}\KeywordTok{use_data}\NormalTok{(river)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
√ Creating 'data/'
√ Saving 'river' to 'data/river.rda'
\end{verbatim}

You will see that at the root of your R package (inside ``path\_to\_RPRW\_package/RPRW''), there is now a folder called \texttt{data}. In \texttt{data}, there is a file called \texttt{river.rda}. \texttt{river\_rda} contains the \texttt{river} data (in a compressed format built for R objects) and can now be loaded alongside your functions when running \texttt{devtools::load\_all()}. For illustration, let's remove \texttt{river} from our global environment and then load it using \texttt{devtools::load\_all()}:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{rm}\NormalTok{(river) }\CommentTok{# remove the river data from our global environment}
\StringTok{`}\DataTypeTok{devtools::load_all()}\StringTok{`} \CommentTok{# load the river data}
\KeywordTok{print}\NormalTok{(river) }\CommentTok{# view the river data}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#>           Missouri Mississippi Yukon Colorado Arkansas Columbia  Red Canadian
#> length        3768        3544  3190     2330     2322     2000 1811     1458
#> discharge     1956       18400  6340       40     1004     7730  852      174
\end{verbatim}

\hypertarget{roxygen}{%
\subsection{roxygen Comments}\label{roxygen}}

After writing \texttt{river\_means()}, you should document it while its structure is fresh in your mind. This makes it easier for others (including future you) to understand how to use \texttt{river\_means()}. Documenting R functions is a bit more complicated than leaving standard comments (\texttt{\#}). R package documentation must be written in "R documentation (.Rd) formuat. The simplest way to write R documentation for functions is to use a special type of comment with your functions: \emph{roxygen} comments (view the roxygen2 (\href{https://roxygen2.r-lib.org/}{external link}) package for more). roxygen comments are prefixed with \texttt{\#\textquotesingle{}} (instead of \texttt{\#}) and have special \textbf{tags} associated with them. roxygen comment templates can be automatically inserted into your R script by putting your cursor somewhere in the body of a function and do either of:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  In the upper-left toolbar, go to ``Code -\textgreater{} Insert Roxygen Skeleton''
\item
  Pressing \texttt{Ctrl/Cmd\ +\ Alt\ +\ Shift\ +\ R}
\end{enumerate}

Inserting this roxygen template into \texttt{river\_means()} yields

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#' Title}
\CommentTok{#'}
\CommentTok{#' @param data }
\CommentTok{#' @param pattern }
\CommentTok{#'}
\CommentTok{#' @return}
\CommentTok{#' @export}
\CommentTok{#'}
\CommentTok{#' @examples}
\NormalTok{river_means <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{rowMeans}\NormalTok{(new_data)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

The \texttt{@} indicates the tag. The template inserts four tags for us:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \texttt{@param}: to document function arguments
\item
  \texttt{@return}: to document function output
\item
  \texttt{@export}: to make the function available after installing the package

  \begin{itemize}
  \tightlist
  \item
    You may not want to export every function in your package (e.g.~helpers)
  \end{itemize}
\item
  \texttt{@examples}: to provide examples of using the function
\end{enumerate}

Let's document \texttt{river\_means()}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#' Means of river lengths and discharges}
\CommentTok{#'}
\CommentTok{#' @param data A data frame with two rows. The first row indicates river length and}
\CommentTok{#'   second row indicates river discharge. The columns of data indicate river names.}
\CommentTok{#' @param pattern A pattern by which to include only particular rivers}
\CommentTok{#'}
\CommentTok{#' @return The mean river length and mean river discharge for the desired rivers}
\CommentTok{#' @export}
\CommentTok{#'}
\CommentTok{#' @examples}
\CommentTok{#' data("river")}
\CommentTok{#' river_means(river, pattern = "Mi")}
\NormalTok{river_means <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{rowMeans}\NormalTok{(new_data)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Next we need to turn these roxygen comments into a new format that powers the actual documentation. The details of this new format are not critical -- the important take-away is that the roxygen comments are automatically transformed to the new format by running

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{devtools}\OperatorTok{::}\KeywordTok{document}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
i Updating RPRW documentation
i Loading RPRW
Writing NAMESPACE
Writing river_means.Rd
\end{verbatim}

\texttt{devtools::document()} creates a new folder at the root of the package called \texttt{man} that now contains a file called \texttt{river\_means.Rd}

\includegraphics[width=1\linewidth]{images/newrpack_files2}

The \texttt{river\_means.Rd} file is the result of transforming the roxygen comments to documentation that packages use. As you can see, \texttt{river\_means.Rd} is a bit more complicated than the roxygen comments in \texttt{river\_means()}. Luckily, \texttt{river\_means.Rd} is automatically generated. The broader, important point of all this is that after running \texttt{devtools::document()}, you can view the documentation of \texttt{river\_means()}!

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{?river_means}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=1\linewidth]{images/newrpack_example}

Note that \texttt{devtools::document()} simultaneously updates documentation for all of the \texttt{.R} files in the R folder that have roxygen comments. From now on I'll stop reminding you every time, but again, notice the benefits of leveraging the tools that devtools and usethis provide.

For more on documentation in R packages (including documenting data), visit here (\href{https://r-pkgs.org/man.html\#man}{external link}) and the vignettes here (\href{https://cran.r-project.org/web/packages/roxygen2/index.html}{external link}). Though we skip documenting the river data here, the RPRW package available from GitHub does document it (the documentation can be viewed by running \texttt{?river} after \texttt{library(RPRW)}).

\hypertarget{second-function}{%
\subsection{The Second Function}\label{second-function}}

You may be wondering how to tell your package to use functions from other packages. \texttt{river\_means()}uses a few other functions available in R (see Exercise 1.1.1.1 (\protect\hyperlink{ex-set1}{internal link}): \texttt{\textless{}-}, \texttt{grep()}, \texttt{names()}, \texttt{{[}}, and \texttt{rowMeans()}. How does R know how to use the right \texttt{names()} function when executing \texttt{river\_means()}? These questions related to an package's \texttt{NAMESPACE}, which we discuss a bit later.

The functions used in \texttt{river\_means()} are all from the base package in R (\href{https://stat.ethz.ch/R-manual/R-devel/library/base/html/00Index.html}{external link}). The base package is automatically installed alongside R. When using functions from the base package in your package, you don't have to give R any special warning. This is the only package that operates this way, however. When using functions from other packages in your package, you need to let R know what package that function comes from (this is true even for other packages automatically installed alongside R - datasets, graphics, grDevices, methods, stats, and utils). To illustrate this process, suppose we want to create a new function in our package called \texttt{river\_medians()} that operates like \texttt{river\_means()} but computes medians instead of means. First we create the script in our R folder by running

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{usethis}\OperatorTok{::}\KeywordTok{use_r}\NormalTok{(}\StringTok{"river_medians"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Then we can write \texttt{river\_medians()} (there is no \texttt{rowMedians()} function so we need to use \texttt{apply()} to summarize across rows -- see \texttt{?apply} for more detail):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{river_medians <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{apply}\NormalTok{(new_data, }\DecValTok{1}\NormalTok{, median)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

But wait! Run

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{?median}
\end{Highlighting}
\end{Shaded}

See anything different? You'll notice that \texttt{median()} is in the stats package (\href{https://stat.ethz.ch/R-manual/R-devel/library/stats/html/00Index.html}{external link}), not the base package. We need to let R know that when \texttt{river\_medians()} uses \texttt{median()}, \texttt{median()} is from the stats package. To accomplish this, there are two steps to take.

The first step is to tell your package that at least one function from the stats package is required by running

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{usethis}\OperatorTok{::}\KeywordTok{use_package}\NormalTok{(}\StringTok{"stats"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
√ Adding 'stats' to Imports field in DESCRIPTION
* Refer to functions with `stats::fun()`
\end{verbatim}

The package stats was added to the Imports field in the \texttt{DESCRIPTION} file at the root of your package. We will talk more about \texttt{DESCRIPTION} in a bit, but for now just remember that it contains metadata (high-level data) about your package. No matter how many times your package uses any function from stats, you only need to run \texttt{usethis::use\_package("stats")} once. If you accidentally misspell a package name in here, you should delete the misspelled name in the \texttt{Imports} section of the \texttt{DESCRIPTION} file, which we cover later.

The second step is to tell the \texttt{river\_medians()} function to use the \texttt{median()} function from stats. There are a few ways to do this. The way that some consider ``best practice'' is to preface any outside functions (aside from those in base) with \texttt{package::}. Incorporating this into \texttt{river\_medians()} and inserting roxygen documentation yields

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#' Medians of river lengths and discharges}
\CommentTok{#'}
\CommentTok{#' @param data A data frame with two rows. The first row indicates river length and}
\CommentTok{#'   second row indicates river discharge. The columns of data indicate river names.}
\CommentTok{#' @param pattern A pattern by which to include only particular rivers}
\CommentTok{#'}
\CommentTok{#' @return The median river length and mean river discharge for the desired rivers}
\CommentTok{#' @export}
\CommentTok{#'}
\CommentTok{#' @examples}
\CommentTok{#' data("river")}
\CommentTok{#' river_medians(river, pattern = "Mi")}
\NormalTok{river_medians <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{apply}\NormalTok{(new_data, }\DecValTok{1}\NormalTok{, stats}\OperatorTok{::}\NormalTok{median)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

This approach does add some extra typing and can be cumbersome if you are using many outside functions. The \texttt{package::} prefix can be avoided by importing \texttt{median()} from stats to \texttt{river\_median()} using the roxygen tag \texttt{@importFrom}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#' Medians of river lengths and discharges}
\CommentTok{#'}
\CommentTok{#' @param data A data frame with two rows. The first row indicates river length and}
\CommentTok{#'   second row indicates river discharge. The columns of data indicate river names.}
\CommentTok{#' @param pattern A pattern by which to include only particular rivers}
\CommentTok{#'}
\CommentTok{#' @return The median river length and mean river discharge for the desired rivers}
\CommentTok{#' @importFrom stats median}
\CommentTok{#' @export}
\CommentTok{#'}
\CommentTok{#' @examples}
\CommentTok{#' data("river")}
\CommentTok{#' river_medians(river, pattern = "Mi")}
\NormalTok{river_medians <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{apply}\NormalTok{(new_data, }\DecValTok{1}\NormalTok{, median)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

A third option is relevant if you are using several functions from stats. In this case, it may be easier to use the \texttt{@import} tag, which imports all functions from stats to \texttt{river\_median()}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#' Medians of river lengths and discharges}
\CommentTok{#'}
\CommentTok{#' @param data A data frame with two rows. The first row indicates river length and}
\CommentTok{#'   second row indicates river discharge. The columns of data indicate river names.}
\CommentTok{#' @param pattern A pattern by which to include only particular rivers}
\CommentTok{#'}
\CommentTok{#' @return The median river length and mean river discharge for the desired rivers}
\CommentTok{#' @import stats}
\CommentTok{#' @export}
\CommentTok{#'}
\CommentTok{#' @examples}
\CommentTok{#' data("rivers")}
\CommentTok{#' river_medians(rivers, pattern = "Mi")}
\NormalTok{river_medians <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{apply}\NormalTok{(new_data, }\DecValTok{1}\NormalTok{, median)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Be careful when using \texttt{@importFrom} or \texttt{@import} (especially \texttt{@import}). If two functions from different packages have the same name and you try to use one it in your function, R may use the wrong one. In these contexts, using the \texttt{package::} prefix is crucial.

To finish creating the \texttt{river\_medians()} documentation, run

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{devtools}\OperatorTok{::}\KeywordTok{document}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

The \texttt{@importFrom} and \texttt{@import} tags affect the \texttt{NAMESPACE} file, which we get to later. This file is updated by running \texttt{devtools::document()}. Note that if you want to use \texttt{river\_medians()} interactively, make sure to run \texttt{devtools::load\_all()} again (for our example, this is not \emph{strictly necessary} because stats comes loaded alongside R, but it is a good habit).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{devtools}\OperatorTok{::}\KeywordTok{load_all}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\hypertarget{ex-set3}{%
\subsubsection{Exercises}\label{ex-set3}}

These exercises are challenging, so if they don't make sense now, that is okay! Make sure to re-review the solutions after the workshop.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Write a new function, \texttt{river\_stats()}, that takes a data frame, pattern, and a general function by which to summarize river length and discharge. This general function should not be an actual function but rather a placeholder for a function a user inserts themselves.
\item
  Rewrite \texttt{river\_stats()} from the previous exercise so that \texttt{river\_stats()} also takes additional arguments to the summarizing function (hint: use \texttt{...} as an argument)
\end{enumerate}

\hypertarget{description}{%
\subsection{\texorpdfstring{\texttt{DESCRIPTION}}{DESCRIPTION}}\label{description}}

The \texttt{DESCRIPTION} file contains the R package's metadata (and was automatically created alongside the R package). The \texttt{DESCRIPTION} file lets you easily track version numbers, authorship, and additional R packages that your R package uses. There are two fields in \texttt{DESCRIPTION} that do most of the communication regarding how your R package uses additional R packages:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  \texttt{Imports}: Packages here must be installed in order for your package to work. As a result, any package listed in \texttt{Imports} will be installed alongside your package. Packages in \texttt{Imports} help build the foundation of your package.
\item
  \texttt{Suggests}: Packages here enhance your package but are not required for your package to work. You might use suggested packages for enhanced plotting, additional data sets, or more. Packages in \texttt{Suggests} can add finishing touches to your package, but they are not part of your package's foundation -- they are like a home's paint color, not its framing.
\end{enumerate}

Other fields used to communicate how your R package uses additional R packages are \texttt{Depends}, \texttt{LinkingTo}, and \texttt{Enhances}. The difference between \texttt{Depends} and \texttt{Imports} is subtle -- the general advice is to use \texttt{Imports} instead of \texttt{Depends}. For more information about these fields, see Package Dependencies (\href{https://cran.r-project.org/doc/manuals/r-release/R-exts.html\#Package-Dependencies}{external link}).

Editing the package, title, author, and description fields of this package yield a \texttt{DESCRIPTION} file that looks like

\begin{verbatim}
Package: RPRW
Title: R Packages for Reproducible Workflows
Version: 0.0.0.9000
Authors@R: 
    person(given = "Michael",
           family = "Dumelle",
           role = c("aut", "cre"),
           email = "Dumelle.Michael@epa.gov")
Description: A companion R package for "Using R Packages for Reproducible Workflows"
    at the 2021 EPA R Workshop.
License: `use_mit_license()`, `use_gpl3_license()` or friends to pick a
    license
Encoding: UTF-8
LazyData: true
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.1.1
Depends: 
    R (>= 2.10)
Imports: 
    stats
\end{verbatim}

We will talk about some of the remaining parts of \texttt{DESCRIPTION} later.

\hypertarget{namespace}{%
\subsection{\texorpdfstring{\texttt{NAMESPACE}}{NAMESPACE}}\label{namespace}}

While the \texttt{DESCRIPTION} file communicates which other packages your package \emph{uses}, the \texttt{NAMESPACE} file communicates \emph{how} your package uses these packages. More specifically, the \texttt{NAMESPACE} file controls which functions your package exports (making them available to others when your package is installed) and which packages from which functions must be available for your exported functions to work. The \texttt{NAMESPACE} file is automatically updated while running \texttt{devtools::document()} and should not be edited by hand (in fact, there is a warning in the \texttt{NAMESPACE} file to warn against editing the file by hand). This illustrates another advantage of using roxygen comments and \texttt{devtools::document}: documentation for a function from the \texttt{.R} file is used to generate \texttt{.Rd} documentation and the \texttt{NAMESPACE} imports and exports, so they all remain consistent.

In \texttt{river\_median()}, if you called \texttt{median} using \texttt{stats::median}, your \texttt{NAMESPACE} file will look like

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Generated by roxygen2: do not edit by hand}

\KeywordTok{export}\NormalTok{(river_means)}
\KeywordTok{export}\NormalTok{(river_medians)}
\end{Highlighting}
\end{Shaded}

If you used the \texttt{@importFrom\ stats\ median} approach, your \texttt{NAMESPACE} will look like

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Generated by roxygen2: do not edit by hand}

\KeywordTok{export}\NormalTok{(river_means)}
\KeywordTok{export}\NormalTok{(river_medians)}
\KeywordTok{importFrom}\NormalTok{(stats,median)}
\end{Highlighting}
\end{Shaded}

If you used the \texttt{@import\ stats} approach, your \texttt{NAMESPACE} will look like

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Generated by roxygen2: do not edit by hand}

\KeywordTok{export}\NormalTok{(river_means)}
\KeywordTok{export}\NormalTok{(river_medians)}
\KeywordTok{import}\NormalTok{(stats)}
\end{Highlighting}
\end{Shaded}

\hypertarget{testthat}{%
\subsection{testthat}\label{testthat}}

Testing your code to make sure that it performs as intended is an important step in the package building process. Though this may seem like extra work upfront, implementing a rigorous testing procedure for your package is essential for its continued success. In R, testing is incorporated into your package through the testthat (\href{https://testthat.r-lib.org/}{external link}) package. To begin using testthat, run

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{usethis}\OperatorTok{::}\KeywordTok{use_testthat}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
√ Adding 'testthat' to Suggests field in DESCRIPTION
√ Setting Config/testthat/edition field in DESCRIPTION to '3'
√ Creating 'tests/testthat/'
√ Writing 'tests/testthat.R'
\end{verbatim}

The root of your package directory should look like

\includegraphics[width=1\linewidth]{images/newrpack_files3}

The tests folder should look like

\includegraphics[width=1\linewidth]{images/newrpack_files4}

Tests are generally written on a function-by-function basis. Tests for a function should be contained in an R script titled \texttt{test-function\_name}. Luckily, \texttt{usethis::use\_test()} creates an R script for you with the proper name! To start setting up tests for \texttt{river\_means()}, run

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{usethis}\OperatorTok{::}\KeywordTok{use_test}\NormalTok{(}\StringTok{"river_means"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
√ Writing 'tests/testthat/test-river_means.R'
* Modify 'tests/testthat/test-river_means.R'
\end{verbatim}

Your \texttt{testthat} folder should look like

\includegraphics[width=1\linewidth]{images/newrpack_files5}

Tests can be fairly detailed and cover many components of a function (such as input types, output types, function output, etc.). The tests in testthat are prefixed with \texttt{expect\_}. Here we write a simple test that calculates whether our function, \texttt{river\_means()}, yields output that we would expect if we calculated the means ``by hand''. Copy and paste this into \texttt{test-river\_means.R}:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{test_that}\NormalTok{(}\StringTok{"the mean length is calculated correctly in a test case"}\NormalTok{, \{}
  
  \CommentTok{# calculate values required for the test for length}

  \CommentTok{## calculate the means from the function}
\NormalTok{  river_means_val <-}\StringTok{ }\KeywordTok{river_means}\NormalTok{(river, }\StringTok{"Missouri|Mississippi"}\NormalTok{)}
\NormalTok{  river_means_length <-}\StringTok{ }\NormalTok{river_means_val[[}\DecValTok{1}\NormalTok{]]}

  \CommentTok{## calculate the means "by hand"}
\NormalTok{  raw_vec_length <-}\StringTok{ }\KeywordTok{unlist}\NormalTok{(river[}\StringTok{"length"}\NormalTok{, }\KeywordTok{c}\NormalTok{(}\StringTok{"Missouri"}\NormalTok{, }\StringTok{"Mississippi"}\NormalTok{)])}
\NormalTok{  raw_means_length <-}\StringTok{ }\KeywordTok{mean}\NormalTok{(raw_vec_length)}
  
  \CommentTok{# perform the actual test for length}

  \CommentTok{## check that the function and "by hand" output matches}
  \KeywordTok{expect_equal}\NormalTok{(river_means_length, raw_means_length)}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> Error in test_that("the mean length is calculated correctly in a test case", : could not find function "test_that"
\end{verbatim}

You should then see a ``Run Tests'' button in the editor window. Clicking on that button runs the tests and prints the results in the ``Build'' tab of the environment window, which should look like

\begin{verbatim}
==> Testing R file using 'testthat'

i Loading cRPRW

== Testing test-river_means.R ==================================================
[ FAIL 0 | WARN 0 | SKIP 0 | PASS 1 ] Done!

Test complete
\end{verbatim}

If you have many tests, the \texttt{devtools::test()} function runs all of the tests in the \texttt{testthat} folder:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{devtools}\OperatorTok{::}\KeywordTok{test}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
i Loading RPRW
i Testing RPRW
√ |  OK F W S | Context
√ |   1       | river_means                                                     
                                               
== Results =========================================================================
[ FAIL 0 | WARN 0 | SKIP 0 | PASS 1 ]
\end{verbatim}

We can write a similar test for discharge and then repeat the process for \texttt{river\_meadians()}. Then \texttt{devtools::test()} returns

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{devtools}\OperatorTok{::}\KeywordTok{test}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
i Loading RPRW
i Testing RPRW
√ |  OK F W S | Context
√ |   2       | river_means                                                         
√ |   2       | river_medians                                                       

== Results =========================================================================
[ FAIL 0 | WARN 0 | SKIP 0 | PASS 4 ]
\end{verbatim}

All tests pass -- hooray! I want to again emphasize how important testing is. I know that it seems like an extra chore, but in my experience, writing careful tests has always paid off\ldots with interest.

\hypertarget{ex-set4}{%
\subsubsection{Exercises}\label{ex-set4}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Write similar tests for \texttt{river\_means()} (discharge), \texttt{river\_medians()} (length), and \texttt{river\_medians()} (discharge).
\item
  Check out the covr (\href{https://cran.r-project.org/web/packages/covr/vignettes/how_it_works.html}{external link}) package, which quantifies how much of your package's code is used by your tests.
\end{enumerate}

\hypertarget{license}{%
\subsection{License}\label{license}}

At some point, your package needs a license. The license places restrictions on how your package can be shared with others. Licensing can be rather technical and complicated, so I refer you here (\href{https://r-pkgs.org/license.html}{external link}) for more information. For illustration purposes, we will use a GPL-3 license for this package:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{usethis}\OperatorTok{::}\KeywordTok{use_gpl_license}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
√ Setting License field in DESCRIPTION to 'GPL (>= 3)'
√ Writing 'LICENSE.md'
√ Adding '^LICENSE\\.md$' to '.Rbuildignore'
\end{verbatim}

\texttt{usethis::use\_gpl\_license()} adds the license to \texttt{DESCRIPTION} and creates a \texttt{LICENSE.md} file at the root of your package that contains information about the license. Approved licenses for EPA repositories include CC0, MIT, GPL-3, and Apache 2.

\hypertarget{vignettes}{%
\subsection{Vignettes}\label{vignettes}}

Vignettes act as high-level user guides for your package. They are the glue that binds together several components of your package to illustrate how the package can be used to solve a particular problem. Vignettes tend to be R Markdown documents. Though we cover R Markdown documents in more detail later, for now we note that they that interweave text and R code to create reproducible documents. You can recognize whether a document is an R markdown documents by the \texttt{.Rmd} extension that R documents have.

The ggplot2 (\href{https://ggplot2.tidyverse.org/}{external link}) package is a popular package for visualizing data. After installing ggplot2 (you can check to see if it is already installed by running \texttt{"ggplot2"\ \%in\%\ installed.packages()}), you can view its available vignettes by running

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{vignette}\NormalTok{(}\DataTypeTok{package =} \StringTok{"ggplot2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

after which a file will pop up alongside your R scripts with the contents

\includegraphics[width=1\linewidth]{images/newrpack_files6}

To then view a specific vignette, run \texttt{vignette("topic",\ "package")}. For example, to view the vignette regarding \textbf{aes}thetic specifications, run

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{vignette}\NormalTok{(}\StringTok{"ggplot2-specs"}\NormalTok{, }\StringTok{"ggplot2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

The vignette can then be viewed in the ``Help'' tab of the bottom-right pane of RStudio. Vignettes are also available on a package's CRAN page -- for the ggplot2 aesthetic specifications vignette viewable on its CRAN page, see here (\href{https://cran.r-project.org/web/packages/ggplot2/vignettes/ggplot2-specs.html}{external link}).

Suppose we want to include a vignette in RPRW that shows how to it to compute river statistics. Running

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{use_vignette}\NormalTok{(}\StringTok{"river-statistics"}\NormalTok{, }\StringTok{"River Statistics"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
√ Adding 'knitr' to Suggests field in DESCRIPTION
√ Setting VignetteBuilder field in DESCRIPTION to 'knitr'
√ Adding 'inst/doc' to '.gitignore'
√ Creating 'vignettes/'
√ Adding '*.html', '*.R' to 'vignettes/.gitignore'
√ Adding 'rmarkdown' to Suggests field in DESCRIPTION
√ Writing 'vignettes/river-statistics.Rmd'
* Modify 'vignettes/river-statistics.Rmd'
\end{verbatim}

does a few things. It alters your \texttt{DESCRIPTION} file, most notably adding the knitr (\href{https://yihui.org/knitr/}{external link}) and rmarkdown packages to the \texttt{Suggests} field. It also creates a vignette folder at the root of your package and adds to that folder an rmarkdown vignette named \texttt{river-statistics.Rmd} (notice the \texttt{.Rmd} extension) whose title is ``River Statistics''.

While we won't create a vignette for our package during the workshop, I have added a vignette to the RPRW package. To view it (after installation, which we discuss later), run

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{vignette}\NormalTok{(}\StringTok{"river-statistics"}\NormalTok{, }\StringTok{"RPRW"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{check}{%
\subsection{\texorpdfstring{\texttt{devtools::check()}}{devtools::check()}}\label{check}}

At this point we have built R package and are ready to share it with the world! But we should probably check to make sure we did not make any small mistakes. Does devtools have a way to do this? Of course -- introducing \texttt{devtools::check()}! \texttt{devtools::check()} evaluates several automated tests on your package to make sure it can be properly installed and shared -- this can take a few minutes. The \texttt{devtools::check()} output lists errors, warnings, and notes associated with your package. Though the warnings and notes are important, it is most crucial to address the errors immediately.

Hopefully after running \texttt{devtools::check()}, your output looks like

\begin{verbatim}
-- R CMD check results ---------- RPRW 0.0.0.9000 ----
Duration: 34.4s

0 errors √ | 0 warnings √ | 0 notes √
\end{verbatim}

If not, do your best to fix the errors and address the warnings and notes!

\hypertarget{install}{%
\subsection{\texorpdfstring{\texttt{devtools::install()}}{devtools::install()}}\label{install}}

After \texttt{devtools::check()} identifies zero errors (and hopefully zero warnings and zero notes), you can install your package by running

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{devtools}\OperatorTok{::}\KeywordTok{install}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

After installing RPRW, you can use \texttt{library(RPRW)} to load it as you do for any other R package. To uninstall, you can run

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{remove.packages}\NormalTok{(}\StringTok{"RPRW"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{ex-set5}{%
\subsubsection{Exercises}\label{ex-set5}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Find the argument to \texttt{devtools::install()} that identifies whether vignettes are built alongside installation. What is the default value of this argument?
\end{enumerate}

\hypertarget{congratulations}{%
\subsection{Congratulations}\label{congratulations}}

Congratulations on building an R package! If this was your first one, then an extra special congratulations to you! Hopefully stepping through the process together made it all less intimidating.

\begin{center}\includegraphics[width=0.5\linewidth]{images/well_done} \end{center}

\hypertarget{a-recap}{%
\subsection{A Recap}\label{a-recap}}

Here is a table that walks through the tools we discussed today, step-by-step (omitting the \texttt{devtools::} and \texttt{usethis::} prefixes):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rpack_table <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}
  \DataTypeTok{Task =} \KeywordTok{c}\NormalTok{(}\StringTok{"Creation"}\NormalTok{, }\StringTok{"Add Function"}\NormalTok{, }\StringTok{"Add Package"}\NormalTok{, }\StringTok{"Load Package"}\NormalTok{, }\StringTok{"Add Data"}\NormalTok{, }\StringTok{"Documentation"}\NormalTok{, }\StringTok{"Testing (Setup)"}\NormalTok{, }\StringTok{"Testing (Create)"}\NormalTok{, }\StringTok{"Testing (Perform)"}\NormalTok{, }\StringTok{"License (GPL-3)"}\NormalTok{, }\StringTok{"Vignette"}\NormalTok{, }\StringTok{"Check"}\NormalTok{, }\StringTok{"Install"}\NormalTok{),}
  \DataTypeTok{Command =} \KeywordTok{c}\NormalTok{(}\StringTok{"create_package()"}\NormalTok{, }\StringTok{"use_r()"}\NormalTok{, }\StringTok{"use_package()"}\NormalTok{, }\StringTok{"load_all()"}\NormalTok{, }\StringTok{"use_data()"}\NormalTok{, }\StringTok{"document()"}\NormalTok{, }\StringTok{"use_testthat()"}\NormalTok{, }\StringTok{"use_test()"}\NormalTok{, }\StringTok{"test()"}\NormalTok{, }\StringTok{"use_gpl_license()"}\NormalTok{, }\StringTok{"use_vignette()"}\NormalTok{, }\StringTok{"check()"}\NormalTok{, }\StringTok{"install()"}\NormalTok{)}
\NormalTok{)}
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(rpack_table)}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{l|l}
\hline
Task & Command\\
\hline
Creation & create\_package()\\
\hline
Add Function & use\_r()\\
\hline
Add Package & use\_package()\\
\hline
Load Package & load\_all()\\
\hline
Add Data & use\_data()\\
\hline
Documentation & document()\\
\hline
Testing (Setup) & use\_testthat()\\
\hline
Testing (Create) & use\_test()\\
\hline
Testing (Perform) & test()\\
\hline
License (GPL-3) & use\_gpl\_license()\\
\hline
Vignette & use\_vignette()\\
\hline
Check & check()\\
\hline
Install & install()\\
\hline
\end{tabular}

\hypertarget{debugging}{%
\section{Debugging}\label{debugging}}

Even the best of programmers write code that may fail in unintended ways. This unintended failing of code is referred to as a ``bug,'' and the process of fixing the ``bug'' is known as ``debugging''. Don't expect to always write perfect code -- do expect to have the tools necessary to track down bugs and remedy them. Though we went through a rigorous documentation and testing procedure when creating \texttt{river\_means()} and \texttt{river\_medians()}, there are still bugs present in these functions.

\hypertarget{error-onematch}{%
\subsection{A Mysterious Error Message}\label{error-onematch}}

We have already used \texttt{river\_means()} and \texttt{river\_medians()} to successfully find means and medians for several patterns. But running \texttt{river\_means(river,\ "R")} yields a mystifying error:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{river_means}\NormalTok{(river, }\StringTok{"R"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> Error in rowMeans(new_data): 'x' must be an array of at least two dimensions
\end{verbatim}

Something is wrong -- and we need to figure out what. A good first step is to copy and paste the error into a Google search engine and see if anyone has solved the problem yet. If you are lucky, this approach will identify the bug for you. If you are not so lucky, you need to try a different approach. Fortunately, R has built-in tools that can help you track down bugs -- we will explore a few of these tools next.

\hypertarget{traceback}{%
\subsection{\texorpdfstring{\texttt{traceback()}}{traceback()}}\label{traceback}}

The \texttt{traceback()} function is generally run in the console after receiving an error. \texttt{traceback()} identifies where the error occurred in the previous function call. Here we run \texttt{traceback()} after \texttt{river\_means(river,\ "R")}:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{traceback}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
3: stop("'x' must be an array of at least two dimensions")
2: rowMeans(new_data) at #4
1: river_means(river, "R")
\end{verbatim}

We now know that the error occurs in Line 4 of \texttt{river\_means()} (the \texttt{rowMeans(new\_data)} step). While this is very useful information, we still don't know exactly why the error occurs.

\hypertarget{browser}{%
\subsection{\texorpdfstring{\texttt{browser()}}{browser()}}\label{browser}}

In my early stages of debugging, I would save my arguments to a function in the global environment and then run through each line of the function returning the error, effectively ``recreating'' the environment in which the error occurred. Perhaps some of you have done this too. The bad news is that this approach is often error-prone and inefficient. The good news is that there is a better way -- \texttt{browser()}. Inserting \texttt{browser()} into your code and then running it lets you interactively step into the function, starting at wherever \texttt{browser()} is located. No more saving arguments to the global environment and running code line-by-line! Let's try this out with by changing the body of \texttt{river\_means()} to be:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{river_means <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
  \KeywordTok{browser}\NormalTok{()}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{rowMeans}\NormalTok{(new_data)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

After using \texttt{devtools::load\_all()}, caling \texttt{river\_means()} will let you step into the function before the first line of code. For example,

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{river_means}\NormalTok{(river, }\StringTok{"R"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

opens a new file in the editor (upper left-hand) window that looks like

\includegraphics[width=0.75\linewidth]{images/newrpack_files7_2}
which highlights the most recently executed line in the file, as seen above. The Environment tab shows objects in the function's current environment (in this case, the argument values and any objects the function defines).

You will also see a few buttons in the R console (lower left-hand) window:

\includegraphics[width=0.75\linewidth]{images/newrpack_files8}

These five buttons help you interactively navigate through \texttt{river\_means()}. From left to right, they are

\begin{itemize}
\tightlist
\item
  Next (\texttt{n}), which executes the next line of the code
\item
  Step (\texttt{s}), which steps into the function called by the current line of code
\item
  Finish (\texttt{f}), which finishes execution of the current function
\item
  Continue (\texttt{c}), which leaves the interactive context and continues execution of the function
\item
  Stop (\texttt{Q}), which leaves the interactive context and terminates execution of the function
\end{itemize}

Before navigating through any lines of \texttt{river\_means()}, we see \texttt{data} and \texttt{pattern} are defined:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#>           Missouri Mississippi Yukon Colorado Arkansas Columbia  Red Canadian
#> length        3768        3544  3190     2330     2322     2000 1811     1458
#> discharge     1956       18400  6340       40     1004     7730  852      174
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(pattern)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> [1] "R"
\end{verbatim}

Pressing \texttt{n} (Next) executes \texttt{browser()}. Pressing \texttt{n} (Next) again executes

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\end{Highlighting}
\end{Shaded}

Inspecting \texttt{desired\_rivers}, we see

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(desired_rivers)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> [1] 7
\end{verbatim}

This seems correct, as the seventh river, ``Red'', does match the pattern ``R''. So the error isn't here. Let's press \texttt{n} (Next) to evaluate the next line

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
\end{Highlighting}
\end{Shaded}

Inspecting \texttt{new\_data}, we see

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{new_data}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> [1] 1811  852
\end{verbatim}

Well this seems weird -- \texttt{new\_data} does not look like a data frame. Let's inspect the structure

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{str}\NormalTok{(new_data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#>  num [1:2] 1811 852
\end{verbatim}

\texttt{new\_data} is in fact not a data frame, but rather it is a numeric vector. Because \texttt{rowMeans()} requires an array of two or more dimensions (e.g.~a matrix or data frame), the next line of code, \texttt{rowMeans()}, fails. Pressing \texttt{n} again runs

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{rowMeans}\NormalTok{(new_data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> Error in rowMeans(new_data): 'x' must be an array of at least two dimensions
\end{verbatim}

and returns the error while removing you from the interactive mode.

This is a good example of one of the reasons debugging can be so challenging: often, an error occurs because code from a few lines back runs in an unintended way (even though it runs successfully). Note that a similar error occurs when running \texttt{river\_medians(river,\ "R")} because \texttt{apply()} requires an array of two or more dimensions.

So what is happening here? We know the code works when the pattern yields at least two matches in \texttt{river}. But now, with one match, the code is failing. Let's start with the \texttt{{[}} function called by \texttt{data{[},\ desired\_rivers{]}}, where we receive unintended output. Let's look at the documentation of \texttt{{[}} by running

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{?}\StringTok{`}\DataTypeTok{[}\StringTok{`}
\end{Highlighting}
\end{Shaded}

A close look at the documentation reveals further documentation for the behavior of \texttt{{[}} when applied to a data frame

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{?}\StringTok{`}\DataTypeTok{[.data.frame}\StringTok{`}
\end{Highlighting}
\end{Shaded}

Notice the \texttt{drop} argument in this documentation. The \texttt{drop} argument, when \texttt{TRUE}, coerces the object to the lowest possible dimension. When subsetting a data frame by one column, \texttt{drop} is \texttt{TRUE} by default and data frame structure is turned into a vector structure, which only has one dimension -- this is why the error is occurring. So we need to force our subsetting to always keep the data frame structure by setting \texttt{drop\ =\ FALSE}. Accommodating this change in \texttt{river\_means()} and \texttt{river\_medians()} yields functions that look like

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{river_means <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers, drop =}\StringTok{ }\OtherTok{FALSE}\NormalTok{]}
  \KeywordTok{rowMeans}\NormalTok{(new_data)}
\NormalTok{\}}

\NormalTok{river_medians <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers, drop =}\StringTok{ }\OtherTok{FALSE}\NormalTok{]}
  \KeywordTok{apply}\NormalTok{(new_data, }\DecValTok{1}\NormalTok{, median)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Now running \texttt{river\_means()} and \texttt{river\_medians()} with patterns only having one match behaves as intended

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{river_means}\NormalTok{(river, }\StringTok{"R"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#>    length discharge 
#>      1811       852
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{river_medians}\NormalTok{(river, }\StringTok{"R"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#>    length discharge 
#>      1811       852
\end{verbatim}

For more information about debugging in R, watch this (\href{https://www.rstudio.com/resources/rstudioconf-2020/object-of-type-closure-is-not-subsettable/}{external link}) and/or read this (\href{https://adv-r.hadley.nz/debugging.html}{external link}).

\hypertarget{error-zeromatch}{%
\subsection{Another Error -- No Mysterious Message}\label{error-zeromatch}}

We previously received and fixed an error message that occurred when the pattern only matched one river. So we know our code works when the pattern matches at least one river. But what happens when the pattern matches zero rivers?

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{river_means}\NormalTok{(river, }\StringTok{"ZZZ"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#>    length discharge 
#>       NaN       NaN
\end{verbatim}

The length and discharge means are \texttt{NaN}, which stands for ``Not a Number'' -- this is certainly unintended (note that \texttt{river\_medians(river,\ "ZZZ")} returns similar output.). These types of bugs are especially pernicious because there is no error message associated with them -- we can't use \texttt{traceback()}. Say \texttt{river\_means()} was a small part of a much larger function, -- this bug could be the root of a confusing error several lines later. Whenever function output is unexpected and you can't immediately figure out why, use \texttt{browser()} to diagnose the bug. In this context, \texttt{desired\_rivers} is a length-zero vector, which causes problems in the remaining parts of the function. To guard against these types of bugs, identify potentially problematic scenarios for your function and program defensively, forcing the function to return an informative error message when a problematic scenario is identified. Here we force \texttt{river\_means()} to return an error message when the pattern matches zero rivers:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{river_means <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
  \ControlFlowTok{if}\NormalTok{ (}\KeywordTok{length}\NormalTok{(desired_rivers) }\OperatorTok{==}\StringTok{ }\DecValTok{0}\NormalTok{) \{}
    \KeywordTok{stop}\NormalTok{(}\StringTok{"This is an error message that stops the function."}\NormalTok{)}
\NormalTok{  \}}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers, drop =}\StringTok{ }\OtherTok{FALSE}\NormalTok{]}
  \KeywordTok{rowMeans}\NormalTok{(new_data)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{river_means}\NormalTok{(rivers, }\StringTok{"ZZZ"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> Error in river_means(rivers, "ZZZ"): This is an error message that stops the function.
\end{verbatim}

\hypertarget{ex-set6}{%
\subsubsection{Exercises}\label{ex-set6}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Rewrite \texttt{river\_medians()} so that it stops and returns an informative error message when the pattern matches zero rivers.
\end{enumerate}

\hypertarget{add-resources}{%
\section{Additional Resources}\label{add-resources}}

\begin{itemize}
\tightlist
\item
  R Packages (\href{https://r-pkgs.org/index.html}{external link}) by Hadley Wickham (\href{http://hadley.nz/}{external link}) and Jenny Bryan (\href{https://jennybryan.org/}{external link}) \citep{wickham2015r}
\item
  Writing an R package from scratch (\href{https://hilaryparker.com/2014/04/29/writing-an-r-package-from-scratch/}{external link}) by Hilary Parker (\href{https://hilaryparker.com/}{external link})
\item
  Writing R Extensions (\href{https://cran.r-project.org/doc/manuals/r-release/R-exts.html}{external link}) by CRAN (this resource is very technical)
\end{itemize}

\hypertarget{r-package-rc}{%
\chapter{Making an R Package a Research Compendium}\label{r-package-rc}}

\hypertarget{what-is-a-rc}{%
\section{What is a Research Compendium?}\label{what-is-a-rc}}

\citet{marwick2018packaging} state that the goal of a research compendium is to provide a standard and easily recognizable way to organize the digital materials of a project to enable others to inspect, reproduce, and extend the work. Three generic principles define a research compendium:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Files should be organized according to the prevailing conventions of a broader community. This helps members of the community recognize the structure of the project and make tools that utilize the structure.
\item
  There should be a clear separation of data, methods, and output. For example, raw data should be kept separate from the code that cleans the data so that others can access the raw data.
\item
  The computational environment for the methods should be clearly specified. At the most basic level, this means recording the names and version numbers of software. At the most detailed level, this means completely reproducing the computing environment.
\end{enumerate}

\hypertarget{ex-set7}{%
\subsection{Exercises}\label{ex-set7}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  What principles of a research compendium seem most beneficial to you?
\end{enumerate}

\hypertarget{why-a-rc}{%
\section{Why a Research Compendium?}\label{why-a-rc}}

\citet{marwick2018packaging} (and references therein) give several benefits of a research compendium:

\begin{itemize}
\tightlist
\item
  A convenient way to publicly share data and code
\item
  Work with publicly available data sets may receive higher numbers of citations than work with private data sets (note that publicly available data sets also tend to be easier to clear through EPA platforms)
\item
  Data sharing is associated with higher publication productivity

  \begin{itemize}
  \tightlist
  \item
    Of 7,040 NSF and NIH awards studied, the median number of publications associated with each research grant was five when the data were private and 10 when the data were public
  \end{itemize}
\item
  Structured and simplified file management and workflows
\item
  More defense against errors
\item
  Easier to communicate with others (and future you)
\end{itemize}

\hypertarget{ex-set8}{%
\subsection{Exercises}\label{ex-set8}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Can you identify any benefits to a research compendium that are not already on this list?
\end{enumerate}

\hypertarget{why-r-pack-for-rc}{%
\section{Why an R Package for a Research Compendium?}\label{why-r-pack-for-rc}}

As previously mentioned, a research compendium requires a specific structure. Earlier in this workshop, we got some experience with something in R that also requires a specific structure\ldots\ldots\ldots\ldots R packages! A research compendium can significantly benefit from adopting the structure of an R package. Organization is simpler (as you already have a structure), writing and documenting functions and data helps guard against errors in an analysis, and devtools and usethis have several development tools to help ensure your R package performs as intended.

We have previously discussed how to include data in an R package, but many of you may be wondering how we include additional pieces of a research compendium like analysis scripts, output, or a manuscript itself. If the structure of an R package is so rigid -- how do these pieces fit? We discuss one such approach next.

\hypertarget{rprw-to-rc}{%
\section{Turning RPRW Into A Research Compendium}\label{rprw-to-rc}}

If a folder named \texttt{inst} is placed at the root of an R package's directory, all of the raw contents in \texttt{inst} will be installed upon installation of the R package. This is where we can put the pieces of our research compendium that are not explicitly related to the previous implementation of our R package. We can use this approach to turn RPRW into a research compendium.

Suppose we are using RPRW to supplement a manuscript about rivers. Let's first add the \texttt{inst} folder -- the root of your package's directory should look similar to

\includegraphics[width=1\linewidth]{images/newrpack_files9}

Let's add three folders to \texttt{inst}:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \texttt{analysis} for our analysis scripts -- these scripts contain code that is not related to the functions in the package but is related to other parts of the research compendium (e.g.~generating output for the manuscript)
\item
  \texttt{output} for our analysis output
\item
  \texttt{manuscript} for our manuscript
\end{enumerate}

\includegraphics[width=1\linewidth]{images/newrpack_files10}

First we will make an R script to put in \texttt{analysis}. Recall that in Exercise 1.2.7.1.2 (\protect\hyperlink{ex-set3}{internal link}), we generated \texttt{river\_stats()}, whose body looks like

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{river_stats <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern, FUN, ...) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{apply}\NormalTok{(new_data, }\DecValTok{1}\NormalTok{, FUN, ...)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\texttt{river\_stats()} works like \texttt{river\_means()} and \texttt{river\_medians()} but takes a general function instead of computing the mean or median specifically. Suppose our goal is to find the minimum length and discharge for rivers whose names contain ``C''. Our script to put in \texttt{analysis} will look like

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# find some summary statistics on rivers with pattern "C"}

\CommentTok{## load RPRW -- we need to do this because the script is separate from the }
  \CommentTok{## functions installed in the RPRW package}
\KeywordTok{library}\NormalTok{(RPRW) }

\CommentTok{## find minimums}
\NormalTok{river_min <-}\StringTok{ }\KeywordTok{river_stats}\NormalTok{(river, }\StringTok{"C"}\NormalTok{, min)}

\CommentTok{## make a data frame of the minimums}
\NormalTok{min_df <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}
  \DataTypeTok{data =} \StringTok{"river"}\NormalTok{,}
  \DataTypeTok{pattern =} \StringTok{"C"}\NormalTok{,}
  \DataTypeTok{length_min =}\NormalTok{ river_min[[}\DecValTok{1}\NormalTok{]],}
  \DataTypeTok{discharge_min =}\NormalTok{ river_min[[}\DecValTok{2}\NormalTok{]]}
\NormalTok{)}

\CommentTok{## write out the minimums (without row names)}
\KeywordTok{write.csv}\NormalTok{(min_df, }\StringTok{"inst/output/min_df"}\NormalTok{, }\DataTypeTok{row.names =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

This script loads RPRW and finds the minimum length and discharge for rivers whose names start with C. The script then saves the contents to a CSV file in the \texttt{output} folder. These contents are used when building the manuscript. The manuscript is in the \texttt{manuscript} folder and is a completely reproducible R Markdown document (using an rticles template, which we discuss later). Though we won't discuss the details of this R Markdown document here unless we have time, the files can be viewed on your machine (after installing RPRW) at the location provided by

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{system.file}\NormalTok{(}\StringTok{"manuscript"}\NormalTok{, }\DataTypeTok{package =} \StringTok{"RPRW"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

A compiled PDF of the manuscript is available here (\href{https://github.com/michaeldumelle/RPRW/blob/main/inst/manuscript/manuscript.pdf}{external link}).

\hypertarget{ex-set9}{%
\subsection{Exercises}\label{ex-set9}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  There is a folder name within \texttt{inst} that should be avoided -- what is it?
\end{enumerate}

\hypertarget{citation}{%
\subsection{Adding a Citation}\label{citation}}

Often times your research compendium may be centered around a particular publication. You may build an R package that deals with specific tasks and then write your manuscript using the research compendium structure. In this event, you may want your publication to be easily citable. You can add a citation to your R package research compendium by running

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{use_citation}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
√ Writing 'inst/CITATION'
* Modify 'inst/CITATION'
\end{verbatim}

The citation file is placed in the \texttt{inst} folder. It looks a little intimidating at first, but it automatically creates a text version and LaTeX version of your citation with relatively little ease. Here is raw code I used to create the citation in the RPRW package

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{citHeader}\NormalTok{(}\StringTok{"To cite RPRW in publications use:"}\NormalTok{)}

\KeywordTok{citEntry}\NormalTok{(}
  \DataTypeTok{entry    =} \StringTok{"Manual"}\NormalTok{,}
  \DataTypeTok{title    =} \StringTok{"Using R Packages for Reproducible Workflows"}\NormalTok{,}
  \DataTypeTok{author   =} \KeywordTok{personList}\NormalTok{(}\KeywordTok{as.person}\NormalTok{(}\StringTok{"Michael Dumelle"}\NormalTok{)),}
  \DataTypeTok{journal  =} \StringTok{"EPA 2021 R Workshop"}\NormalTok{,}
  \DataTypeTok{url      =} \StringTok{"https://github.com/michaeldumelle/R-Packages-Reproducible-Workflows-Book"}\NormalTok{,}
  \DataTypeTok{textVersion =}
  \KeywordTok{paste}\NormalTok{(}
    \StringTok{"Michael Dumelle."}\NormalTok{,}
    \StringTok{"(2021)."}\NormalTok{,}
    \StringTok{"Using R Packages for Reproducible Workflows."}\NormalTok{,}
    \StringTok{"EPA 2021 R Workshop."}\NormalTok{,}
    \StringTok{"URL https://github.com/michaeldumelle/R-Packages-Reproducible-Workflows-Book."}
\NormalTok{  )}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

To view the citation, run

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{citation}\NormalTok{(}\DataTypeTok{package =} \StringTok{"RPRW"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> 
#> To cite RPRW in publications use:
#> 
#>   Michael Dumelle. (2021). Using R Packages for Reproducible Workflows.
#>   EPA 2021 R Workshop. URL
#>   https://github.com/michaeldumelle/R-Packages-Reproducible-Workflows-Book.
#> 
#> A BibTeX entry for LaTeX users is
#> 
#>   @Manual{,
#>     title = {Using R Packages for Reproducible Workflows},
#>     author = {Michael Dumelle},
#>     journal = {EPA 2021 R Workshop},
#>     url = {https://github.com/michaeldumelle/R-Packages-Reproducible-Workflows-Book},
#>   }
\end{verbatim}

If left unedited, the package citation defaults to something that looks like

\begin{verbatim}
 
 To cite package 'RPRW' in publications use:
 
   Michael Dumelle (2021). RPRW: R Packages for Reproducible Workflows.
   R package version 0.0.0.9000.
 
 A BibTeX entry for LaTeX users is
 
   @Manual{,
     title = {RPRW: R Packages for Reproducible Workflows},
     author = {Michael Dumelle},
     year = {2021},
     note = {R package version 0.0.0.9000},
   }
\end{verbatim}

\hypertarget{rc-recap}{%
\section{Research Compendium Recap}\label{rc-recap}}

The research compendium now visibly contains:

\begin{itemize}
\tightlist
\item
  \texttt{data}: a folder containing data
\item
  \texttt{DESCRIPTION}: a file containing metadata about our package
\item
  \texttt{inst}: a folder containing auxiliary files to be downloaded alongside the package's installation

  \begin{itemize}
  \tightlist
  \item
    \texttt{analysis}: a folder containing R scripts that are separate from the R package but used as part of the research compendium
  \item
    \texttt{CITATION}: a file containing citation information
  \item
    \texttt{manuscript}: a file containing the manuscript and auxiliary files
  \item
    \texttt{output}: a file containing the CSV output
  \end{itemize}
\item
  \texttt{LICENSE.md}: a file containing metadata about our license (GPL-3)
\item
  \texttt{man}: a folder containing R function documentation from the package
\item
  \texttt{NAMESPACE}: a file containing exports and imports
\item
  \texttt{R}: a folder containing R functions from the package
\item
  \texttt{RPRW.Rproj}: a file containing R Project metadata
\item
  \texttt{tests}: a folder containing R function testing
\item
  \texttt{vignettes}: a folder containing the package vignette
\end{itemize}

You can also add a \texttt{README.md} file to give a broad overview of your package (\texttt{README.md} is useful whether or not you use Git and GitHub). The \texttt{README.md} file is a Markdown (\href{https://www.markdownguide.org/}{external link}) file (notice the .md extension and notice the connection between R Markdown (\texttt{.Rmd}) and Markdown (\texttt{.md})) in the RPRW package that looks like

\begin{verbatim}
# RPRW
Companion R package for "Using R Packages for Reproducible Workflows" at the 2021 EPA R Workshop
\end{verbatim}

\hypertarget{sharing-rc}{%
\section{Sharing Your Research Compendium}\label{sharing-rc}}

So now you have a research compendium that combines your R functions with your data, code, and manuscript to create a reproducible product that is easy to share with your colleagues. But how do we share it? Running

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{devtools}\OperatorTok{::}\KeywordTok{build}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

will build an R package for you. By default, the package will be located in the same folder as the folder containing your R package with name ``package-name\_version-number.tar.gz''. Note that this is one level above the location of your R package's directory. For example, if folder ``A'' holds ``RPRW'', which is the folder containing all of the files associated with my R package, then using \texttt{devtools::build()} will install ``RPRW\_0.0.0.9000.tar.gz'' in folder ``A''. If there are any files in your package folder that you do not present in the installed version of the package, place the file paths in the \texttt{.Rbuildignore} file. Fore more on \texttt{.Rbuildignore}, visit here (\href{https://r-pkgs.org/package-structure-state.html\#rbuildignore}{external link}).

After building the package, you can send it to a colleague, they can save it on their machine, and then they can install it by running

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{install.packages}\NormalTok{(path_to_package, }\DataTypeTok{repos =} \OtherTok{NULL}\NormalTok{, }\DataTypeTok{type =} \StringTok{"source"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

If your colleague doesn't remember where they saved the file, they can interactively search for it by running

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{install.packages}\NormalTok{(}\KeywordTok{file.choose}\NormalTok{(), }\DataTypeTok{repos =} \OtherTok{NULL}\NormalTok{, }\DataTypeTok{type =} \StringTok{"source"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Because R packages leverage R projects your colleague can immediately run any of your code on their machine (a reminder that we discuss R projects soon)!

\hypertarget{hosting-your-research-compendium}{%
\section{Hosting Your Research Compendium}\label{hosting-your-research-compendium}}

You can host your research compendium in an open-access repository so that a broader audience may access it. One approach is to host it on GitHub, which we discuss more later. This approach has the advantage of being easy to install by running

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{devtools}\OperatorTok{::}\KeywordTok{install_github}\NormalTok{(}\StringTok{"GitHub_user_name/repository_name"}\NormalTok{, }\StringTok{"repository_branch"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

You can also put your research compendium on Zenodo (\href{https://zenodo.org/}{external link}). Zenodo is an open-access repository designed to permanently archive research compendia. GitHub and Zenodo compliment each other nicely: GitHub acts as the ``easy to access'' version of the research compendium while Zenodo is the more permanent version. For an example of a research compendium that combines these approaches, visit the GitHub repository here (\href{https://github.com/usepa/ri_wq_trends}{external link}) and Zenodo archive here (\href{https://zenodo.org/record/4306765\#.YUygPbhKhPY}{external link}).

\hypertarget{ex-set10}{%
\subsection{Exercises}\label{ex-set10}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Run \texttt{?devtools::build} to look at some additional arguments -- which seem useful to you?
\end{enumerate}

\hypertarget{ex-rc}{%
\section{An Example R Package Reserach Compendium}\label{ex-rc}}

A recent publication of mine used this R package research compendium structure -- you can view the GitHub repository here (\href{https://github.com/michaeldumelle/DumelleEtAl2021STLMM}{external link}).

\hypertarget{extensions}{%
\chapter{Extensions}\label{extensions}}

\hypertarget{r-projects}{%
\section{R Projects}\label{r-projects}}

When I first started coding in R, I would try to share my code with others and encountered a problem -- my colleagues would copy, paste, and run my code but it would not work on their machine. Often this was because my scripts read in files from different file paths (locations) on my computer -- and these file paths were unique to my machine!, To get my code to work, my colleagues would have to edit my code that used file paths so that they pointed to the correct files on their machine. Not only is this a lot to ask of someone, it also makes it incredibly error-prone. More often than not, I would have to meet with someone to get the code I sent them up and running. This was a waste of time for everyone involved.

R looks for files to load in a working directory. This is helpful because looking for files in a working directory prevents you from having to type out the full path to a file every time you want to load something. For example, suppose you are not using a working directory and you have several files to load that live in \texttt{a/long/path/with/s\ p\ a\ c\ e\ s/and/cH-a\_r-\/-aCt-er\$!!!}. To load \texttt{my\_cool\_file.csv} and \texttt{my\_other\_cool\_file.csv}, you have to run

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{read.csv}\NormalTok{(}\StringTok{"a/long/path/with/s p a c e s/and/cH-a_r--aCt-er$!!!/my_cool_file.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

and then retype (or copy/paste) the path to run

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{read.csv}\NormalTok{(}\StringTok{"a/long/path/with/s p a c e s/and/cH-a_r--aCt-er$!!!/my_other_cool_file.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

This workflow is tedious and error-prone. If you set your working directory to \texttt{a/really/long/path/with/s\ p\ a\ c\ e\ s/and/cH-a\_r-\/-aCt-er\$!!!}, then to load \texttt{my\_cool\_file.csv} and \texttt{my\_other\_cool\_file.csv}, you have to run

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{read.csv}\NormalTok{(}\StringTok{"my_cool_file.csv"}\NormalTok{)}
\KeywordTok{read.csv}\NormalTok{(}\StringTok{"my_other_cool_file.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

You can set working directories in R using \texttt{setwd()}, but this isn't really a good idea for various reasons (you get to discuss them in the exercises). There is a better way to control your working directory -- R projects!

R projects automatically set your working directory to live wherever the project is stored on your machine. So if I have \texttt{my\_cool\_file.csv} and \texttt{my\_other\_cool\_file.csv} in the root (top-most level) of my R project, I can load them by running

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{read.csv}\NormalTok{(}\StringTok{"my_cool_file.csv"}\NormalTok{)}
\KeywordTok{read.csv}\NormalTok{(}\StringTok{"my_other_cool_file.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

while inside the R project. This is so powerful because that means I can bundle up my R project, send it to my colleague, and then the R project will set my colleague's working directory to live wherever they save the project. That means that they can load \texttt{my\_cool\_file.csv} and \texttt{my\_other\_cool\_file.csv} using the exact same code I used. No more file path problems -- this is a vastly improved workflow. It may not seem like a big deal now, but learning how to use R projects makes sharing your work substantially easier.

A side benefit of R projects is that they provide a convenient structure by which to organize all the files associated with a particular task. To learn more about creating and maintaining R packages, visit here (\href{https://r4ds.had.co.nz/workflow-projects.html}{external link}) and here (\href{https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects}{external link}). If you do not use R projects yet, I recommend that you start.

\hypertarget{ex-set11}{%
\subsection{Exercises}\label{ex-set11}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  What are some drawbacks of running \texttt{setwd()} whenever you want to set a working directory?
\item
  Look into the here (\href{https://here.r-lib.org/}{external link}) package, designed to help solve working directory problems (that can even occur within R Projects).
\end{enumerate}

\hypertarget{renv}{%
\subsection{renv}\label{renv}}

The renv (\href{https://rstudio.github.io/renv/articles/renv.html}{external link}) package brings R package version management to your projects. renv prevents code in your R project from returning separate results based on the version of the R packages installed. It works by saving the specific versions of the R packages in your project and then makes it easy for others to install those same versions before running code in the project.

\hypertarget{rmarkdown}{%
\section{R Markdown}\label{rmarkdown}}

R Markdown documents provide a convenient way to combine text, R code, and results into a fully reproducible document that compiles (knits) to one of several output types (HTLM, PDF, word, slide decks, etc.). An R Markdown document has file extension \texttt{.Rmd} and can be created in RStudio by clicking ``File -\textgreater{} New File -\textgreater{} R Markdown'', which brings up the following options

\includegraphics[width=1\linewidth]{images/rmark1}

Pressing OK automatically opens a file with several contents

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: "Untitled"}
\NormalTok{author: "Michael Dumelle"}
\NormalTok{date: "9/17/2021"}
\NormalTok{output: html_document}
\NormalTok{---}

\BaseNTok{```\{r setup, include=FALSE\}}
\BaseNTok{knitr::opts_chunk$set(echo = TRUE)}
\BaseNTok{```}

\FunctionTok{## R Markdown}

\NormalTok{This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see }\OtherTok{<http://rmarkdown.rstudio.com>}\NormalTok{.}

\NormalTok{When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:}

\BaseNTok{```\{r cars\}}
\BaseNTok{summary(cars)}
\BaseNTok{```}

\FunctionTok{## Including Plots}

\NormalTok{You can also embed plots, for example:}

\BaseNTok{```\{r pressure, echo=FALSE\}}
\BaseNTok{plot(pressure)}
\BaseNTok{```}

\NormalTok{Note that the }\BaseNTok{`echo = FALSE`}\NormalTok{ parameter was added to the code chunk to prevent printing of the R code that generated the plot.}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\item
  The part surrounded by \texttt{-\/-\/-} is the YAML header, which contains metadata about your document -- big picture options are controlled here. For more on YAML headers, check out the ymlthis package and its associated vignettes here (\href{https://cran.r-project.org/web/packages/ymlthis/index.html}{external link}).
\item
  The parts prefixed by \texttt{\#} are first-level (section-level) headers, and the parts prefixed by \texttt{\#\#} are second level (subsection-level) headers.
\item
  The parts surrounded by \texttt{\textasciigrave{}\textasciigrave{}\textasciigrave{}} are code chunks -- these are the engine that powers R Markdown. Code chunks let you run and display R code and output in your document. More generally, code chunks look like
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r label, chunk_options\}}
\BaseNTok{R code}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  The line
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr::opts_chunk$set()}
\end{Highlighting}
\end{Shaded}

lets you set default options for your code chunks. For example, \texttt{knitr::opts\_chunk\$set(echo\ =\ TRUE)} sets \texttt{echo\ =\ TRUE} for all all code chunks, unless a particular code chunk sets \texttt{echo\ =\ FALSE}. More information on available code chunk options is available here (\href{https://yihui.org/knitr/options/}{external link}).

\begin{itemize}
\tightlist
\item
  The rest of the document contains the body of the document -- the plain text.
\end{itemize}

For more on the structure of R Markdown documents, visit here (\href{https://bookdown.org/yihui/rmarkdown-cookbook/conceptual-overview.html}{external link}).

R Markdown documents are useful for a variety of reasons, two of which we will focus on next:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  R Markdown lets you create fully reproducible documents by combining R code and text (these are often called \textbf{dynamic} documents). What if there is a slight change to the data? No problem, the tables or figures are reproduced when re-knitting. What if you want to use a new output style (like a PDF or Word Document)? No problem, just change \texttt{output:} and re-knit.
\item
  This approach is less error-prone and usually less work compared to the alternative approach of remaking tables, figures, etc. ``by hand'' and the inserting them manually into your document..
\end{enumerate}

For much, much more on R Markdown, read this (\href{https://bookdown.org/yihui/rmarkdown/}{external link}) and this (\href{https://bookdown.org/yihui/rmarkdown-cookbook/}{external link}). I highly recommend you get some experience with it, as its tools are immensely powerful.

\hypertarget{ex-set12}{%
\subsection{Exercises}\label{ex-set12}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  What benefits do you see to R Markdown documents?
\item
  Save the basic R Markdown template we just discussed and knit it to see its contents.
\end{enumerate}

\hypertarget{rticles}{%
\section{rticles}\label{rticles}}

The rticles package is an extension of R Markdown designed to make adhering to journal style requirements easier. Some journal types rticles accommodates are Elsevier, PLOS, Sage, Springer, and Taylor \& Francis, among others. After installing rticles (\texttt{install.packages("rticles")}), you can access article templates by starting a new R Markdown document and selecting the template tab

\includegraphics[width=1\linewidth]{images/rmark2}

The rticles templates have complicated YAML headers, but they generally have pretty clear inline instructions for how to edit them. The YAML headers change between templates, but the body of the document is just standard R Markdown (potentially with some LaTeX). This is very convenient because the body of the document is the same across templates (potentially with minor LaTeX discrepancies that are generally explained in the template's inline instructions). Decide you want to switch from an Elsevier journal to a Taylor \& Francis journal? No problem, just change the template type! For this reason, rticles is one my favorite R packages.

For a brief introduction LaTeX, see this (\href{https://www.overleaf.com/learn/latex/Learn_LaTeX_in_30_minutes}{external link}). While some working knowledge of LaTeX is not necessarily required to successfully use rticles, it can be immensely helpful.

\hypertarget{ex-set13}{%
\subsection{Exercises}\label{ex-set13}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Visit this (\href{https://github.com/rstudio/rticles}{external link}) to see all the journals that rticles has a template for.
\end{enumerate}

\hypertarget{git-github}{%
\section{Git and GitHub}\label{git-github}}

I highly recommend you learn how to use Git and GitHub. Though intimidating, frustrating, and time-consuming at first, Git and GitHub are well worth the effort. Git (\href{https://git-scm.com/}{external link}) is a version control system. A version control system keeps track of all changes made to your code in a Git repository (which is a \texttt{.git/} folder somewhere in your code -- note the \texttt{.git/} folder is usually hidden). Git is useful on its own, but it benefits greatly from integration with GitHub. GitHub (\href{https://github.com/}{external link}) is a website that lets you easily share your code, collaborate with others, track changes to your code, and backup your code, among other features. Git and GitHub is by far the most popular version control system for R packages, and access to development versions of R packages is usually only available through GitHub.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{devtools}\OperatorTok{::}\KeywordTok{install_github}\NormalTok{(}\StringTok{"username/packagename"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Though we won't get into details of Git and GitHub here (aside from a quick example we discuss next), luckily RStudio has many tools to enable R to communicate with Git and GitHub. For an intro to Git and GitHub through RStudio, visit this (\href{https://r-pkgs.org/git.html}{external link}). For a thorough book about using Git and GitHub through RStudio, visit this (\href{https://happygitwithr.com/}{external link}). For a video overview of using Git and GitHub through RStudio, watch this (\href{https://www.rstudio.com/resources/rstudioconf-2017/happy-git-and-gihub-for-the-user-tutorial/}{external link}).

\hypertarget{cloning-a-github-repository-in-rstudio}{%
\subsection{Cloning a GitHub Repository in RStudio}\label{cloning-a-github-repository-in-rstudio}}

After ensuring GitHub and R Studio can talk to one another, one GitHub and RStudio workflow is to create a repository on GitHub and then clone it using RStudio. After creating the repository on GitHub, copy the HTTPS URL:

\includegraphics[width=1\linewidth]{images/newrpack_github1}

Then go to ``File -\textgreater{} New Project -\textgreater{} Version Control -\textgreater{} Git''. Copying and pasting the HTTPS URL in the ``Repository URL:'' field and pressing ``Create Project'' clones the repository and creates an R project in a folder with name given by the ``Project directory name:'' field (which defaults to the repository name) located at the ``Create project as subdirectory of:'' field. You can then use \texttt{usethis::create\_package()} to turn the repository into an R package (note that \texttt{usethis::create\_package(".")} creates a package in the current working directory).

\hypertarget{gitignore}{%
\subsection{\texorpdfstring{\texttt{.gitignore}}{.gitignore}}\label{gitignore}}

The \texttt{.gitignore} file in your package files deserves some special attention. Similar to \texttt{.Rbuildignore}, \texttt{.gitignore} contains file paths that are stored locally but not meant to be put on GitHub. For more on \texttt{.gitignore}, visit here (\href{https://r-pkgs.org/git.html\#git-ignore}{external link}).

\hypertarget{ci}{%
\section{Continuous Integration}\label{ci}}

Continuous integration (often abbreviated CI) is the process of performing automated checks on code anytime it is updated. This may seem cumbersome, but it is a really good idea because it forces you to check for errors with every new version of code. One option for continuous integration in your R package's GitHub repository is GitHub Actions (\href{https://github.com/features/actions}{external link}). devtools has several tools to help you set up GitHub actions. I recommend using their ``standard'' GitHub actions template, which can be added to your R project by running

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{use_github_action}\NormalTok{(}\DataTypeTok{name =} \StringTok{"check-standard"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
√ Creating '.github/'
√ Adding '^\\.github$' to '.Rbuildignore'
√ Adding '*.html' to '.github/.gitignore'
√ Creating '.github/workflows/'
√ Writing '.github/workflows/check-standard.yaml'
* Learn more at <https://github.com/r-lib/actions/blob/master/examples/README.md>
\end{verbatim}

You will notice that this code created a new folder at the root of our package named \texttt{.github}. The .github folder may be hidden so you may need to enable the viewing of hidden files to look through its contents on your machine (in the files pane of R studio click more and check ``show hidden files''. Then every time you push to GitHub, GitHub actions will simulate \texttt{devtools::check()} on several operating systems (Windows, Mac, Linux) and return the results. To view this approach implemented for the RPRW package, visit this (\href{https://github.com/michaeldumelle/RPRW/actions}{external link}). Another option for continuous integration is Travis CI (\href{https://travis-ci.org/}{external link}).

\hypertarget{style}{%
\section{Code Style}\label{style}}

The tidyverse style guide (\href{https://style.tidyverse.org/}{external link}) provides a set of code-writing guidelines that help make your code as easy to read as possible. The tidyverse style guide claims ``Good coding style is like correct punctuation: you can manage without it, butitsuremakesthingseasiertoread.''

The styler (\href{https://styler.r-lib.org/}{external link}) package lets you restyle text, files, or entire projects. It includes an RStudio add in and is integrated with usethis. For example,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{usethis}\OperatorTok{::}\KeywordTok{use_tidy_style}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

will automatically restyle all functions in your package's \texttt{R} folder to conform to the tidyverse style guide.

The lintr (\href{https://github.com/jimhester/lintr}{external link}) package performs automated checks to help you conform to a style guide. The default style guide is the tidyverse style guide.

\hypertarget{add-tips}{%
\section{Additional Tips}\label{add-tips}}

\begin{itemize}
\tightlist
\item
  RStudio has cheat sheets for many commonly used packages available here (\href{https://www.rstudio.com/resources/cheatsheets/}{external link})
\item
  To view all R Studio keyboard shortcuts, go to ``Tools (editor/upper-left window) -\textgreater{} Keyboard Shortcuts Help'' or press \texttt{Alt\ +\ Shift\ +\ K}
\item
  The most recent R Studio version (1.4) is a large update with several wonderful new features -- if you have not requested it yet, I recommend you do so. Two of these features are Visual R Markdown (\href{https://blog.rstudio.com/2020/09/30/rstudio-v1-4-preview-visual-markdown-editing/}{external link}) and the command palette (\href{https://blog.rstudio.com/2020/10/14/rstudio-v1-4-preview-command-palette/}{external link}).
\item
  I recommend you try and use the tidyverse (\href{https://www.tidyverse.org/}{external links}) for data analyses. The tidyverse is a collection of R packages designed to make data analyses easier to code and easier to comprehend. To learn more, read this (\href{https://r4ds.had.co.nz/}{external link}) cover-to-cover -- it is one of my favorite books.
\item
  If you are building an R package you plan to submit to CRAN (i.e.~the primary purpose of the R package is for others to download and use it -- the primary purpose is NOT to be a research compendium), I recommend you try to only import absolutely necessary packages. The more packages your package imports, the higher the risk your package breaks when a package you depend on introduces an update / bug / etc. For example, if plan to use the purrr package (which is part of the tidyverse) for the \texttt{purrr::map()} function, consider using \texttt{lapply()} from the base package instead. If there is a base-R equivalent of a function you want in your package, use the base-R version, even if it means you have to relearn the base-R version

  \begin{itemize}
  \tightlist
  \item
    When I say base-R here, I mean any of the packages that come installed alongside R: the packages base, datasets, graphics, grDevices, methods, stats, and utils.
  \end{itemize}
\item
  Visit this (\href{https://twitter.com/rstudiotips?lang=en}{external link}) for more R tips and tricks
\item
  Sign up for R Weekly (\href{https://rweekly.org/}{external link}) to get weekly R updates.
\item
  You don't have to learn how to do all of this all at once! Move at a pace you are comfortable with.
\item
  Everyone has their own coding style, and my recommendations may differ from your coding preferences -- that is okay! All I hope is that you consider them.
\end{itemize}

\hypertarget{ex-set14}{%
\subsection{Exercises}\label{ex-set14}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  A data set is called ``tidy'' if it has three qualities: 1) each variable has its own column, 2) each observation has its own row, and 3) each value has its own cell. Is \texttt{river} tidy? Why or why not?
\item
  Make \texttt{river} tidy.
\end{enumerate}

\hypertarget{thank-you}{%
\section{Thank you!}\label{thank-you}}

Thank you so much for attending this workshop! I do genuinely appreciate you taking some time out of your day to take this journey with me, and I hope that you got something useful out of this workshop.

\begin{center}\includegraphics[width=0.5\linewidth]{images/thank_you} \end{center}

\hypertarget{your-compendia}{%
\chapter{Turning An R Package into a Reproducible Research Compendia}\label{your-compendia}}

\hypertarget{exercise-solutions}{%
\chapter{Exercise Solutions}\label{exercise-solutions}}

\hypertarget{building-an-r-package}{%
\section*{Building an R Package}\label{building-an-r-package}}
\addcontentsline{toc}{section}{Building an R Package}

\textbf{Exercise 1.1.1.1} (\protect\hyperlink{ex-set1}{internal link})
What are some of your favorite R packages?

Answer 1.1.1.1
This is for you to answer! I have many favorites, but a few are devtools, purrr, rlang, rticles, styler, and usethis.

\textbf{Exercise 1.1.1.2} (\protect\hyperlink{ex-set1}{internal link})
Of those we have talked about so far, what benefits of R packages are most appealing to you?

Answer 1.1.1.2
This is for you to answer! One of the the most appealing benefits to me is the structure that helps keep me organized.

\textbf{Exercise 1.2.4.1.1} (\protect\hyperlink{ex-set2}{internal link})
How many functions does \texttt{river\_means()} call within the body of the function? What package are these functions in?

Answer 1.2.4.1.1
There are five functions: \texttt{\textless{}-}, \texttt{grep()}, \texttt{names()}, \texttt{{[}}, and \texttt{rowMeans()}. They are all in the ``base'' package -- this fact be can seen in each function's documentation

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{?}\StringTok{`}\DataTypeTok{<-}\StringTok{`}
\NormalTok{?grep}
\NormalTok{?names}
\NormalTok{?}\StringTok{`}\DataTypeTok{[}\StringTok{`}
\NormalTok{?rowMeans}
\end{Highlighting}
\end{Shaded}

\textbf{Exercise 1.2.4.1.2} (\protect\hyperlink{ex-set2}{internal link})
Try using \texttt{river\_means()} with a few different patterns. Do you notice anything strange?

Answer 1.2.4.1.1
Strange behavior occurs when the pattern matches only one river or zero rivers. If the pattern matches only one river, there is an error:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{river_means}\NormalTok{(river, }\StringTok{"R"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> Error in rowMeans(new_data): 'x' must be an array of at least two dimensions
\end{verbatim}

If the pattern matches zero rivers, the mean is \texttt{NaN} (which stands for not a number)

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{river_means}\NormalTok{(river, }\StringTok{"ZZZ"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#>    length discharge 
#>       NaN       NaN
\end{verbatim}

These are both unintended and are discussed more in Debugging (\protect\hyperlink{debugging}{internal link}).

\textbf{Exercise 1.2.7.1.1} (\protect\hyperlink{ex-set3}{internal link})
Write a new function, \texttt{river\_stats()}, that takes a data frame, pattern, and a general function by which to summarize river length and discharge. This general function should not be an actual function but rather a placeholder for a function a user inserts themselves.

Answer 1.2.7.1.1

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#' Summary statistics of river lengths and discharges}
\CommentTok{#'}
\CommentTok{#' @param data A data frame with two rows. The first row indicates river length and}
\CommentTok{#'   second row indicates river discharge. The columns of data indicate river names.}
\CommentTok{#' @param pattern A pattern by which to include only particular rivers}
\CommentTok{#' @param FUN A function to summarize the rivers}
\CommentTok{#'}
\CommentTok{#' @return The summarized river length and mean river discharge for the desired rivers}
\CommentTok{#' @export}
\CommentTok{#'}
\CommentTok{#' @examples}
\CommentTok{#' data("river")}
\CommentTok{#' river_stat(river, "Mi", min)}
\NormalTok{river_stats <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern, FUN) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{apply}\NormalTok{(new_data, }\DecValTok{1}\NormalTok{, FUN)}
\NormalTok{\}}
\KeywordTok{river_stats}\NormalTok{(river, }\StringTok{"Mi"}\NormalTok{, min)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#>    length discharge 
#>      3544      1956
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{river_stats}\NormalTok{(river, }\StringTok{"Mi"}\NormalTok{, max)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#>    length discharge 
#>      3768     18400
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{river_stats}\NormalTok{(river, }\StringTok{"Mi"}\NormalTok{, mean)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#>    length discharge 
#>      3656     10178
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{river_stats}\NormalTok{(river, }\StringTok{"Mi"}\NormalTok{, stats}\OperatorTok{::}\NormalTok{median)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#>    length discharge 
#>      3656     10178
\end{verbatim}

\textbf{Exercise 1.2.7.1.2} \protect\hyperlink{ex-set3}{internal link})
Rewrite \texttt{river\_stats()} from the previous exercise so that \texttt{river\_stats()} also takes additional arguments to the summarizing function (hint: use \texttt{...} as an argument)

Answer 1.2.7.1.2

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#' Summary statistics of river lengths and discharges}
\CommentTok{#'}
\CommentTok{#' @param data A data frame with two rows. The first row indicates river length and}
\CommentTok{#'   second row indicates river discharge. The columns of data indicate river names.}
\CommentTok{#' @param pattern A pattern by which to include only particular rivers}
\CommentTok{#' @param FUN A function to summarize the rivers}
\CommentTok{#' @param ... Additional arguments to pass to \textbackslash{}code\{FUN\}}
\CommentTok{#'}
\CommentTok{#' @return The summarized river length and mean river discharge for the desired rivers}
\CommentTok{#' @export}
\CommentTok{#'}
\CommentTok{#' @examples}
\CommentTok{#' data("river")}
\CommentTok{#' river_stat(river, "Mi|C", mean, trim = 0.5)}
\NormalTok{river_stats <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern, FUN, ...) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{apply}\NormalTok{(new_data, }\DecValTok{1}\NormalTok{, FUN, ...)}
\NormalTok{\}}
\KeywordTok{river_stats}\NormalTok{(river, }\StringTok{"Mi|C"}\NormalTok{, mean, }\DataTypeTok{trim =} \DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#>    length discharge 
#>      2620      5660
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{river_stats}\NormalTok{(river, }\StringTok{"Mi|C"}\NormalTok{, mean, }\DataTypeTok{trim =} \FloatTok{0.5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#>    length discharge 
#>      2330      1956
\end{verbatim}

\textbf{Exercise 1.2.10.1} (\protect\hyperlink{ex-set4}{internal link})
Write similar tests for \texttt{river\_means()} (discharge), \texttt{river\_medians()} (length), and \texttt{river\_medians()} (discharge).

Answer 1.2.10.1

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{testthat}\OperatorTok{::}\KeywordTok{test_that}\NormalTok{(}\StringTok{"the mean discharge is calculated correctly in a test case"}\NormalTok{, \{}
  
  \CommentTok{# calculate values required for the test for discharge}

  \CommentTok{## calculate the means from the function}
\NormalTok{  river_means_val <-}\StringTok{ }\KeywordTok{river_means}\NormalTok{(river, }\StringTok{"Missouri|Mississippi"}\NormalTok{)}
\NormalTok{  river_means_discharge <-}\StringTok{ }\NormalTok{river_means_val[[}\DecValTok{2}\NormalTok{]]}

  \CommentTok{## calculate the means "by hand"}
\NormalTok{  raw_vec_discharge <-}\StringTok{ }\KeywordTok{unlist}\NormalTok{(river[}\StringTok{"discharge"}\NormalTok{, }\KeywordTok{c}\NormalTok{(}\StringTok{"Missouri"}\NormalTok{, }\StringTok{"Mississippi"}\NormalTok{)])}
\NormalTok{  raw_means_discharge <-}\StringTok{ }\KeywordTok{mean}\NormalTok{(raw_vec_discharge)}
  
  \CommentTok{# perform the actual test for discharge}

  \CommentTok{## check that the function and "by hand" output matches}
  \KeywordTok{expect_equal}\NormalTok{(river_means_discharge, raw_means_discharge)}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> -- Error (<text>:16:3): the mean discharge is calculated correctly in a test case --
#> Error: could not find function "expect_equal"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{testthat}\OperatorTok{::}\KeywordTok{test_that}\NormalTok{(}\StringTok{"the median length is calculated correctly in a test case"}\NormalTok{, \{}
  
  \CommentTok{# calculate values required for the test for length}

  \CommentTok{## calculate the medians from the function}
\NormalTok{  river_medians_val <-}\StringTok{ }\KeywordTok{river_medians}\NormalTok{(river, }\StringTok{"Missouri|Mississippi"}\NormalTok{)}
\NormalTok{  river_medians_length <-}\StringTok{ }\NormalTok{river_medians_val[[}\DecValTok{1}\NormalTok{]]}

  \CommentTok{## calculate the medians "by hand"}
\NormalTok{  raw_vec_length <-}\StringTok{ }\KeywordTok{unlist}\NormalTok{(river[}\StringTok{"length"}\NormalTok{, }\KeywordTok{c}\NormalTok{(}\StringTok{"Missouri"}\NormalTok{, }\StringTok{"Mississippi"}\NormalTok{)])}
\NormalTok{  raw_medians_length <-}\StringTok{ }\KeywordTok{median}\NormalTok{(raw_vec_length)}
  
  \CommentTok{# perform the actual test for length}

  \CommentTok{## check that the function and "by hand" output matches}
  \KeywordTok{expect_equal}\NormalTok{(river_medians_length, raw_medians_length)}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> -- Error (<text>:16:3): the median length is calculated correctly in a test case --
#> Error: could not find function "expect_equal"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{testthat}\OperatorTok{::}\KeywordTok{test_that}\NormalTok{(}\StringTok{"the mean discharge is calculated correctly in a test case"}\NormalTok{, \{}
  
  \CommentTok{# calculate values required for the test for discharge}

  \CommentTok{## calculate the medians from the function}
\NormalTok{  river_medians_val <-}\StringTok{ }\KeywordTok{river_medians}\NormalTok{(river, }\StringTok{"Missouri|Mississippi"}\NormalTok{)}
\NormalTok{  river_medians_discharge <-}\StringTok{ }\NormalTok{river_medians_val[[}\DecValTok{2}\NormalTok{]]}

  \CommentTok{## calculate the medians "by hand"}
\NormalTok{  raw_vec_discharge <-}\StringTok{ }\KeywordTok{unlist}\NormalTok{(river[}\StringTok{"discharge"}\NormalTok{, }\KeywordTok{c}\NormalTok{(}\StringTok{"Missouri"}\NormalTok{, }\StringTok{"Mississippi"}\NormalTok{)])}
\NormalTok{  raw_medians_discharge <-}\StringTok{ }\KeywordTok{median}\NormalTok{(raw_vec_discharge)}
  
  \CommentTok{# perform the actual test for discharge}

  \CommentTok{## check that the function and "by hand" output matches}
  \KeywordTok{expect_equal}\NormalTok{(river_medians_discharge, raw_medians_discharge)}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> -- Error (<text>:16:3): the mean discharge is calculated correctly in a test case --
#> Error: could not find function "expect_equal"
\end{verbatim}

\textbf{Exercise 1.2.10.2} (\protect\hyperlink{ex-set4}{internal link})
Check out the covr (\href{https://cran.r-project.org/web/packages/covr/vignettes/how_it_works.html}{external link}) package, which quantifies how much of your package's code is used by your tests.

Answer 1.2.10.2
NA

\textbf{Exercise 1.2.14.1.1} (\protect\hyperlink{ex-set5}{internal link})
Find the argument to \texttt{devtools::install()} that identifies whether vignettes are built alongside installation. What is the default value of this argument?

Answer 1.2.14.1.1
Running

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{?devtools_install}
\end{Highlighting}
\end{Shaded}

we see that \texttt{build\_vignettes} controls whether vignettes are build alongside installation. The default argument for \texttt{build\_vignettes} is \texttt{FALSE}.

\textbf{Exercise 1.3.4.1.1} (\protect\hyperlink{ex-set6}{internal link})
Rewrite \texttt{river\_medians()} so that it stops and returns an informative error message when the pattern matches zero rivers.

Answer 1.3.4.1.1

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{river_medians <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
  \ControlFlowTok{if}\NormalTok{ (}\KeywordTok{length}\NormalTok{(desired_rivers) }\OperatorTok{==}\StringTok{ }\DecValTok{0}\NormalTok{) \{}
    \KeywordTok{stop}\NormalTok{(}\StringTok{"The pattern provided does not match any rivers in the data provided."}\NormalTok{)}
\NormalTok{  \}}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers, drop =}\StringTok{ }\OtherTok{FALSE}\NormalTok{]}
  \KeywordTok{rowMeans}\NormalTok{(new_data)}
\NormalTok{\}}
\KeywordTok{river_medians}\NormalTok{(rivers, }\StringTok{"ZZZ"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> Error in river_medians(rivers, "ZZZ"): The pattern provided does not match any rivers in the data provided.
\end{verbatim}

The error messages in the \texttt{RPRW} package are more informative but more difficult to code.

\hypertarget{making-an-r-package-a-research-compendium}{%
\section*{Making an R Package a Research Compendium}\label{making-an-r-package-a-research-compendium}}
\addcontentsline{toc}{section}{Making an R Package a Research Compendium}

\textbf{Exercise 2.1.1.1} (\protect\hyperlink{ex-set7}{internal link})
What principles of a research compendium seem most beneficial to you?

Answer 2.1.1.1
This is for you to answer! To me, the file organization, file separation, and computational details all seem like wonderful principles!

\textbf{Exercise 2.2.1.1} (\protect\hyperlink{ex-set8}{internal link})
Can you identify any benefits to a research compendium that are not already on this list?

Answer 2.2.1.1
This is for you to answer! To me, another benefit is leveraging a structure that facilitates reproducibility.

\textbf{Exercise 2.4.1.1} (\protect\hyperlink{ex-set9}{internal link})
There is a folder name within \texttt{inst} that should be avoided -- what is it?

Answer 2.4.1.1
You should not name a folder in \texttt{inst} named \texttt{doc}. The package building process automatically creates a folder named \texttt{doc} upon installation -- so putting a \texttt{doc} folder in \texttt{inst} creates conflicts. For those that use GitHub, \texttt{inst/doc} is automatically placed in \texttt{gitignore}.

\textbf{Exercise 2.6.1.1} (\protect\hyperlink{ex-set10}{internal link})
Run \texttt{?devtools::build} to look at some additional arguments -- which seem useful to you?

Answer 2.6.1.1
This is for you to answer! But \texttt{vignettes} and \texttt{manual} seem important to be aware of.

\hypertarget{extensions-1}{%
\section*{Extensions}\label{extensions-1}}
\addcontentsline{toc}{section}{Extensions}

\textbf{Exercise 3.1.1.1} (\protect\hyperlink{ex-set11}{internal link})
What are some drawbacks of running \texttt{setwd()} whenever you want to set a working directory?

Answer 3.1.1.1
* You have to remember to run \texttt{setwd()} anytime you want to re-run a script
* It is easy to run \texttt{setwd()} and point to the wrong working directory
* It means that your code is harder to share because someone else will have to change the line of code calling \texttt{setwd()}
* Can you think of more?

\textbf{Exercise 3.1.1.2} (\protect\hyperlink{ex-set11}{internal link})
Look into the here (\href{https://here.r-lib.org/}{external link}) package, designed to help solve working directory problems (that can even occur within R Projects).

Answer 3.1.1.1
NA

\textbf{Exercise 3.2.1.1} (\protect\hyperlink{ex-set12}{internal link})
What benefits do you see to R Markdown documents?

Answer 3.1.1.1
This is for you to answer! One of my favorite benefits is making reproducible figures, tables, and output within the document.

\textbf{Exercise 3.2.1.2} (\protect\hyperlink{ex-set12}{internal link})
Save the basic R Markdown template we just discussed and knit it to see its contents.

Answer 3.1.1.1
Go to ``File -\textgreater{} New File -\textgreater{} R Markdown'' and create an R Markdown template. Then in the editor (upper-left) window, click ``Knit''. Save the file to a location and then the document will knit to an HTML document and pop up in a default viewer. To knit to other output types, click on the down arrow to the right of the ``Knit'' button.

\textbf{Exercise 3.3.1.1} (\protect\hyperlink{ex-set13}{internal link})
Visit this (\href{https://github.com/rstudio/rticles}{external}) to see all the journals that rticles has a template for.

Answer 3.1.1.1
NA

\textbf{Exercise 3.7.1.1} (\protect\hyperlink{ex-set14}{internal link})
1. A data set is called ``tidy'' if it has three qualities: 1) each variable has its own column, 2) each observation has its own row, and 3) each value has its own cell. Is \texttt{river} tidy?

Answer 3.7.1.1
\texttt{river} is not tidy. The river names are spread across columns. One could also argue that \texttt{length} and \texttt{discharge} are both values of a \texttt{metric} argument. Then a tidy \texttt{river} data set would look like

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{river_tidy}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> # A tibble: 16 x 3
#>    name        metric    value
#>    <chr>       <chr>     <dbl>
#>  1 Missouri    length     3768
#>  2 Mississippi length     3544
#>  3 Yukon       length     3190
#>  4 Colorado    length     2330
#>  5 Arkansas    length     2322
#>  6 Columbia    length     2000
#>  7 Red         length     1811
#>  8 Canadian    length     1458
#>  9 Missouri    discharge  1956
#> 10 Mississippi discharge 18400
#> 11 Yukon       discharge  6340
#> 12 Colorado    discharge    40
#> 13 Arkansas    discharge  1004
#> 14 Columbia    discharge  7730
#> 15 Red         discharge   852
#> 16 Canadian    discharge   174
\end{verbatim}

\textbf{Exercise 3.7.1.2} (\protect\hyperlink{ex-set14}{internal link})
Make \texttt{river} tidy

Answer 3.7.1.1

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# approach 1 to loading packages}
\KeywordTok{library}\NormalTok{(tibble) }\CommentTok{# run install.packages("tibble") if needed}
\KeywordTok{library}\NormalTok{(tidyr) }\CommentTok{# run install.packages("tidyr") if needed}
\KeywordTok{library}\NormalTok{(dplyr) }\CommentTok{# # run install.packages("dplyr) if needed}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# approach 2 to loading packages}
\KeywordTok{library}\NormalTok{(tidyverse) }\CommentTok{# run install.packages("tidyverse") if needed}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{river_tidy <-}\StringTok{ }\NormalTok{river }\OperatorTok{%>%}
\StringTok{  }\NormalTok{tibble}\OperatorTok{::}\KeywordTok{rownames_to_column}\NormalTok{(}\DataTypeTok{var =} \StringTok{"metric"}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\NormalTok{tidyr}\OperatorTok{::}\KeywordTok{pivot_longer}\NormalTok{(Missouri}\OperatorTok{:}\NormalTok{Canadian) }\OperatorTok{%>%}
\StringTok{  }\NormalTok{dplyr}\OperatorTok{::}\KeywordTok{select}\NormalTok{(name, metric, value)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{river_tidy}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> # A tibble: 16 x 3
#>    name        metric    value
#>    <chr>       <chr>     <dbl>
#>  1 Missouri    length     3768
#>  2 Mississippi length     3544
#>  3 Yukon       length     3190
#>  4 Colorado    length     2330
#>  5 Arkansas    length     2322
#>  6 Columbia    length     2000
#>  7 Red         length     1811
#>  8 Canadian    length     1458
#>  9 Missouri    discharge  1956
#> 10 Mississippi discharge 18400
#> 11 Yukon       discharge  6340
#> 12 Colorado    discharge    40
#> 13 Arkansas    discharge  1004
#> 14 Columbia    discharge  7730
#> 15 Red         discharge   852
#> 16 Canadian    discharge   174
\end{verbatim}

\hypertarget{sharing-your-book}{%
\chapter{Sharing your book}\label{sharing-your-book}}

\hypertarget{publishing}{%
\section{Publishing}\label{publishing}}

HTML books can be published online, see: \url{https://bookdown.org/yihui/bookdown/publishing.html}

\hypertarget{pages}{%
\section{404 pages}\label{pages}}

By default, users will be directed to a 404 page if they try to access a webpage that cannot be found. If you'd like to customize your 404 page instead of using the default, you may add either a \texttt{\_404.Rmd} or \texttt{\_404.md} file to your project root and use code and/or Markdown syntax.

\hypertarget{metadata-for-sharing}{%
\section{Metadata for sharing}\label{metadata-for-sharing}}

Bookdown HTML books will provide HTML metadata for social sharing on platforms like Twitter, Facebook, and LinkedIn, using information you provide in the \texttt{index.Rmd} YAML. To setup, set the \texttt{url} for your book and the path to your \texttt{cover-image} file. Your book's \texttt{title} and \texttt{description} are also used.

This \texttt{gitbook} uses the same social sharing data across all chapters in your book- all links shared will look the same.

Specify your book's source repository on GitHub using the \texttt{edit} key under the configuration options in the \texttt{\_output.yml} file, which allows users to suggest an edit by linking to a chapter's source file.

Read more about the features of this output format here:

\url{https://pkgs.rstudio.com/bookdown/reference/gitbook.html}

Or use:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{?bookdown}\OperatorTok{::}\NormalTok{gitbook}
\end{Highlighting}
\end{Shaded}

  \bibliography{book.bib,packages.bib}

\end{document}
