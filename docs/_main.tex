% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{book}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Using R Packages for Reproducible Workflows},
  pdfauthor={Michael Dumelle},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs}
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{booktabs}
\usepackage[]{natbib}
\bibliographystyle{plainnat}

\title{Using R Packages for Reproducible Workflows}
\author{Michael Dumelle}
\date{September 22, 2021}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{1}
\tableofcontents
}
\hypertarget{overview}{%
\chapter*{Overview}\label{overview}}
\addcontentsline{toc}{chapter}{Overview}

Welcome to the 2021 EPA R Workshop titled ``Using R Packages for Reproducible Workflows'' by me, Michael Dumelle -- I am glad to have you here! Before proceeding, let's first start up R and download the \href{https://devtools.r-lib.org/}{devtools} package.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"devtools"}\NormalTok{) }\CommentTok{# if required}
\end{Highlighting}
\end{Shaded}

The workshop's companion R package (Using \textbf{R} \textbf{P}ackages for \textbf{R}eproducible \textbf{W}orkflows) is available for download via

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{devtools}\OperatorTok{::}\KeywordTok{install_github}\NormalTok{(}\DataTypeTok{repo =} \StringTok{"michaeldumelle/RPRW"}\NormalTok{, }\DataTypeTok{ref =} \StringTok{"main"}\NormalTok{)}
\KeywordTok{library}\NormalTok{(RPRW)}
\end{Highlighting}
\end{Shaded}

Here are the sections of this workshop:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  \protect\hyperlink{r-package}{Building an R Package}
\item
  \protect\hyperlink{a-research-compendia}{A Research Compendia} for an overview of an effective research compendia
\item
  \protect\hyperlink{your-compendia}{Turning An R Package into a Reproducible Research Compendia}
\item
  \protect\hyperlink{extensions}{Extensions}
\item
  \protect\hyperlink{exercise-solutions}{Exercise Solutions}
\end{enumerate}

\hypertarget{r-package}{%
\chapter{Building an R Package}\label{r-package}}

\hypertarget{what-is-an-r-package}{%
\section{What is an R Package?}\label{what-is-an-r-package}}

An R package is a collection of code, data, documentation, and tests with a particular structure that can be shared with others. R packages are commonly downloaded from the Comprehensive R Archive Network (\href{https://cran.r-project.org/}{CRAN}). You can install them from CRAN with \texttt{install.packages("package\_name")}, load them in your workspace with \texttt{library("package\_name")}, and get help by running (\texttt{help(package\ =\ "package\_name")}).

One of the reasons R packages are so useful is because they are the fundamental way to share code in R. If your code is in a package, others can easily download and use it. If they are familiar with R packages, they likely will be familiar with how to use yours! But sharing R code is not the only benefit of creating R packages. Learning how to build an R package will provide several other benefits to future you!

Future you will benefit from creating your own R packages because they enforce a particular structure. This structure

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Saves you time -- you don't need to think about how to organize your files, R packages have a template!

  \begin{itemize}
  \tightlist
  \item
    This was especially helpful for me because before learning how to create R packages, I would save my R files in all sorts of locations on my computer with all sorts of names. This made it \emph{very challenging} to come back to my work later and find a particular file.
  \end{itemize}
\item
  Gives you standardized tools -- people have created extremely useful tools that work with R packages, so take advantage of them!

  \begin{itemize}
  \tightlist
  \item
    The R package devtools, which we downloaded earlier, contains many of these standarized tools.
  \end{itemize}
\item
  Requires documentation -- This is especially helpful for future you.

  \begin{itemize}
  \tightlist
  \item
    Before I started using R packages, when I would come back my old code, I was convinced someone else wrote it -- I basically had to rewrite it all to understand it. R packages help prevent this.
  \end{itemize}
\item
  Is reproducible -- R packages are built from R projects (see \href{https://r4ds.had.co.nz/workflow-projects.html}{here} and \href{https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects}{here}), so file paths are relative, not absolute!

  \begin{itemize}
  \tightlist
  \item
    \texttt{read\_csv("a\_fun\_csv\_file.csv")} works on my machine -- and yours!
  \item
    While R projects are not the fundamental focus on today, I highly, highly recommend you use them for every data analysis project that you are not using an R package for.
  \end{itemize}
\item
  Guides your data analysis -- We will talk about this today

  \begin{itemize}
  \tightlist
  \item
    See \citet{marwick2018packaging} for more!
  \end{itemize}
\end{enumerate}

\hypertarget{exercises}{%
\subsection{Exercises}\label{exercises}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  What are some of your favorite R packages?
\item
  Of those we have talked about so far, what benefits of R packages are most appealing to you?
\end{enumerate}

\hypertarget{creating-an-r-package}{%
\section{Creating an R Package}\label{creating-an-r-package}}

Together, we will create the companion package for this workshop! If this is your first R package, then an extra special congratulations to you -- this is a big milestone! The name of the package is

\hypertarget{the-motivating-dataset}{%
\subsection{The Motivating Dataset}\label{the-motivating-dataset}}

Suppose we want to build an R package that summarizes length (in kilometers) and discharge (meters per second cubed) of North American rivers based on the names of the rivers. Below is our data of interest

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rivers <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}
  \DataTypeTok{Missouri =} \KeywordTok{c}\NormalTok{(}\DecValTok{3768}\NormalTok{, }\DecValTok{1956}\NormalTok{),}
  \DataTypeTok{Mississippi =} \KeywordTok{c}\NormalTok{(}\DecValTok{3544}\NormalTok{, }\DecValTok{18400}\NormalTok{),}
  \DataTypeTok{Yukon =} \KeywordTok{c}\NormalTok{(}\DecValTok{3190}\NormalTok{, }\DecValTok{6340}\NormalTok{),}
  \DataTypeTok{Colorado =} \KeywordTok{c}\NormalTok{(}\DecValTok{2330}\NormalTok{, }\DecValTok{40}\NormalTok{),}
  \DataTypeTok{Arkansas =} \KeywordTok{c}\NormalTok{(}\DecValTok{2322}\NormalTok{, }\DecValTok{1004}\NormalTok{),}
  \DataTypeTok{Columbia =} \KeywordTok{c}\NormalTok{(}\DecValTok{2000}\NormalTok{, }\DecValTok{7730}\NormalTok{),}
  \DataTypeTok{Red =} \KeywordTok{c}\NormalTok{(}\DecValTok{1811}\NormalTok{, }\DecValTok{852}\NormalTok{),}
  \DataTypeTok{Canadian =} \KeywordTok{c}\NormalTok{(}\DecValTok{1458}\NormalTok{, }\DecValTok{174}\NormalTok{)}
\NormalTok{) }
\KeywordTok{rownames}\NormalTok{(rivers) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"length"}\NormalTok{, }\StringTok{"discharge"}\NormalTok{)}
\NormalTok{rivers}
\CommentTok{#>           Missouri Mississippi Yukon Colorado Arkansas Columbia  Red Canadian}
\CommentTok{#> length        3768        3544  3190     2330     2322     2000 1811     1458}
\CommentTok{#> discharge     1956       18400  6340       40     1004     7730  852      174}
\end{Highlighting}
\end{Shaded}

\hypertarget{the-first-step}{%
\subsection{The First Step}\label{the-first-step}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{devtools}\OperatorTok{::}\KeywordTok{create_package}\NormalTok{(}\StringTok{"path_to_RPRW_package/RPRW"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{√ Creating }\StringTok{'path_to_RPRW_package/RPRW/'}
\NormalTok{√ Setting active project to }\StringTok{'path_to_RPRW_package/RPRW'}
\NormalTok{√ Creating }\StringTok{'R/'}
\NormalTok{√ Writing }\StringTok{'DESCRIPTION'}
\NormalTok{Package}\OperatorTok{:}\StringTok{ }\NormalTok{RPRW}
\NormalTok{Title}\OperatorTok{:}\StringTok{ }\NormalTok{What the Package }\KeywordTok{Does}\NormalTok{ (One Line, Title Case)}
\NormalTok{Version}\OperatorTok{:}\StringTok{ }\DecValTok{0}\NormalTok{.}\DecValTok{0}\NormalTok{.}\FloatTok{0.9000}
\NormalTok{Authors}\OperatorTok{@}\KeywordTok{R}\NormalTok{ (parsed)}\OperatorTok{:}
\StringTok{    }\ErrorTok{*}\StringTok{ }\NormalTok{First Last }\OperatorTok{<}\NormalTok{first.last}\OperatorTok{@}\NormalTok{example.com}\OperatorTok{>}\StringTok{ }\NormalTok{[aut, cre] (YOUR}\OperatorTok{-}\NormalTok{ORCID}\OperatorTok{-}\NormalTok{ID)}
\NormalTok{Description}\OperatorTok{:}\StringTok{ }\NormalTok{What the package }\KeywordTok{does}\NormalTok{ (one paragraph).}
\NormalTok{License}\OperatorTok{:}\StringTok{ `}\DataTypeTok{use_mit_license()}\StringTok{`}\NormalTok{, }\StringTok{`}\DataTypeTok{use_gpl3_license()}\StringTok{`}\NormalTok{ or friends to}
\NormalTok{    pick a license}
\NormalTok{Encoding}\OperatorTok{:}\StringTok{ }\NormalTok{UTF}\DecValTok{-8}
\NormalTok{LazyData}\OperatorTok{:}\StringTok{ }\NormalTok{true}
\NormalTok{Roxygen}\OperatorTok{:}\StringTok{ }\KeywordTok{list}\NormalTok{(}\DataTypeTok{markdown =} \OtherTok{TRUE}\NormalTok{)}
\NormalTok{RoxygenNote}\OperatorTok{:}\StringTok{ }\DecValTok{7}\NormalTok{.}\FloatTok{1.1}
\NormalTok{√ Writing }\StringTok{'NAMESPACE'}
\NormalTok{√ Writing }\StringTok{'RPRW.Rproj'}
\NormalTok{√ Adding }\StringTok{'^RPRW}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{.Rproj$'}\NormalTok{ to }\StringTok{'.Rbuildignore'}
\NormalTok{√ Adding }\StringTok{'.Rproj.user'}\NormalTok{ to }\StringTok{'.gitignore'}
\NormalTok{√ Adding }\StringTok{'^}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{.Rproj}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{.user$'}\NormalTok{ to }\StringTok{'.Rbuildignore'}
\NormalTok{√ Opening }\StringTok{'path_to_RPRW_package/RPRW/'} \ControlFlowTok{in}\NormalTok{ new RStudio session}
\NormalTok{√ Setting active project to }\StringTok{'<no active project>'}
\NormalTok{√ Setting active project to }\StringTok{'path_to_RPRW_package/RPRW'}
\end{Highlighting}
\end{Shaded}

In the ``Files'' pane of RStudio (bottom right corner), you will see that your folder has been populated with a few new files and a new folder.

\includegraphics[width=1\linewidth]{images/newrpack_files}
We will focus on some of these next.

You will also notice that the ``Environment'' pane of RStudio (top right corner) now has a ``Build'' tab -- this tab contains some useful tools for your R package.

\begin{itemize}
\tightlist
\item
  R (folder): Where functions in your R package are stored
\item
  Description: This contains metadata for your package
\item
  Namespace: Information about 1) functions from other packages your package uses and 2) what functions in your package you make available to others
\end{itemize}

\hypertarget{the-first-function}{%
\subsection{The First Function}\label{the-first-function}}

The R folder is where functions in your R package are stored. Let's create our first function, called \texttt{river\_medians()}, which finds the median of river length and discharge of desired rivers. Generally, the name of your file should match the name of the function, and you should use separate files for separate functions. More experienced users, it is okay to break this rule every once in a while in certain contexts. To create an R file in the R folder, run

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{use_r}\NormalTok{(}\StringTok{"river_means"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

You will see some output in the console

\begin{Shaded}
\begin{Highlighting}[]
\OperatorTok{*}\StringTok{ }\NormalTok{Modify }\StringTok{'R/river_means.R'}
\OperatorTok{*}\StringTok{ }\NormalTok{Call }\StringTok{`}\DataTypeTok{use_test()}\StringTok{`}\NormalTok{ to create a matching test file }
\end{Highlighting}
\end{Shaded}

and the appropriate file now in your R folder.

\includegraphics[width=1\linewidth]{images/newrpack_function}

Now let's write our function. We want this function to take the mean length and discharge of all rivers whose names have a common pattern.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{river_means <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{rowMeans}\NormalTok{(new_data)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

The first line of code finds the variables in the data whose names match the pattern. The second line of code subsets the data to include only the desired variables. The third line of code finds and returns the mean length and mean discharge of the desired variables. If you would like, you can leave comments in the code (using \texttt{\#}) to remind yourself what each line of code does. This is usually good practice, as it can help others (and future you) understand the intent of your code line-by-line.

\hypertarget{load_all}{%
\subsection{\texorpdfstring{\texttt{load\_all()}}{load\_all()}}\label{load_all}}

So we have written this function, how should we try it out? Well you \emph{could}
run the function or source it (\texttt{source("R/river\_means.R")}), but this puts it in our global workspace, and if you are not careful, global workspaces can get messy. The devtools
function \texttt{load\_all()} emulates the process of building, installing, and loading our R package, making all of your functions available via a single line of code. As your package becomes more complicated, it is much easier to try our your functions using \texttt{load\_all()} than navigating the global workspace.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{load_all}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

Now let's try out our function! What if we want our summary for the rivers starting with ``Mi'' (Missiouri and Mississippi)?

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{river_means}\NormalTok{(rivers, }\StringTok{"Mi"}\NormalTok{)}
\CommentTok{#>    length discharge }
\CommentTok{#>      3656     10178}
\end{Highlighting}
\end{Shaded}

Or what if we want our summary for rivers starting with ``Y'' (Yukon) or ``R'' (Red)?

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{river_means}\NormalTok{(rivers, }\StringTok{"Y|R"}\NormalTok{)}
\CommentTok{#>    length discharge }
\CommentTok{#>    2500.5    3596.0}
\end{Highlighting}
\end{Shaded}

Hooray -- our function works! Give yourself a congratulations :)!

\hypertarget{exercises-1}{%
\subsubsection{Exercises}\label{exercises-1}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  How many functions does \texttt{river\_means()} call within the body of the function? What package are these functions in?
\end{enumerate}

\hypertarget{creating-package-data}{%
\subsection{Creating Package Data}\label{creating-package-data}}

So far we have used the \texttt{rivers} data from our global workspace. But what if we want this to be data that is included as part of the R packages so that others (or future you) have easy access to it? This is the place for \texttt{use\_data()}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{use_data}\NormalTok{(rivers)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{√ Creating }\StringTok{'data/'}
\NormalTok{√ Saving }\StringTok{'rivers'}\NormalTok{ to }\StringTok{'data/rivers.rda'}
\end{Highlighting}
\end{Shaded}

You will see that at the root of your R package, there is a folder called ``data'', and in that folder is a file called rivers.rda, which contains the rivers data. For illustration, let's remove rivers from our global workspace and then load it like we would data from any other package

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{rm}\NormalTok{(rivers) }\CommentTok{# remove the rivers data from our global workspace}
\KeywordTok{load_all}\NormalTok{() }\CommentTok{# emulate package building process}
\KeywordTok{data}\NormalTok{(}\StringTok{"rivers"}\NormalTok{) }\CommentTok{# load the rivers data}
\NormalTok{rivers}
\end{Highlighting}
\end{Shaded}

\hypertarget{roxygen-comments}{%
\subsection{roxygen Comments}\label{roxygen-comments}}

Now that you have written your function, it is time to thoroughly document your function so that others (or future you) can understand how to use it. The documentation for R functions uses special types of comments called \emph{roxygen} comments. The comments use \texttt{\#\textquotesingle{}} and have special ``tags'' associated with them. To insert a template of roxygen comments into \texttt{river\_means()}, put your cursor somewhere in the \texttt{river\_means()} function and either

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  In the upper-left toolbar, go to Code -\textgreater{} Insert Roxygen Skeleton
\item
  Press Ctrl/Cmd + Alt + Shift + R
\end{enumerate}

You will see \texttt{river\_means()} now looks like

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#' Title}
\CommentTok{#'}
\CommentTok{#' @param data }
\CommentTok{#' @param pattern }
\CommentTok{#'}
\CommentTok{#' @return}
\CommentTok{#' @export}
\CommentTok{#'}
\CommentTok{#' @examples}
\NormalTok{river_means <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{rowMeans}\NormalTok{(new_data)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

The \texttt{@} indicates a particular ``tag'' that controls how functions are documented.

\begin{itemize}
\tightlist
\item
  \texttt{@param}: for documenting arguments to a function
\item
  \texttt{@return}: for documenting the function output
\item
  \texttt{@export}: for making this function available to others downloading your package
\item
  \texttt{@examples}: to give examples for how to use the package
\end{itemize}

Let's fill these in.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#' Means of river lengths and discharges}
\CommentTok{#'}
\CommentTok{#' @param data A data frame with two rows. The first row indicates river length and}
\CommentTok{#'   second row indicates river discharge. The columns of data indicate river names.}
\CommentTok{#' @param pattern A pattern by which to include only particular rivers}
\CommentTok{#'}
\CommentTok{#' @return The mean river length and mean river discharge for the desired rivers}
\CommentTok{#' @export}
\CommentTok{#'}
\CommentTok{#' @examples}
\CommentTok{#' data("rivers")}
\CommentTok{#' river_means(rivers, pattern = "Mi")}
\NormalTok{river_means <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{rowMeans}\NormalTok{(new_data)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

To view this documentation as you would any other package's function documentation, first run

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{document}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{i Updating RPRW documentation}
\NormalTok{i Loading RPRW}
\NormalTok{Writing NAMESPACE}
\NormalTok{Writing river_means.Rd}
\end{Highlighting}
\end{Shaded}

You will notice that there is a new folder at the root of the package, called ``man'', which contains a file called \texttt{river\_means.Rd}.

\includegraphics[width=1\linewidth]{images/newrpack_files2}

The contents of the file here are not too important, as this file is automatically created using \texttt{document()}. The important point is that after running \texttt{document()}, you can view the documentation of your function!

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{?river_means}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=1\linewidth]{images/newrpack_example}

There are several other tags available to customize your documentation -- for more information about these tags and documenting data (which is different than documentation function; the rivers data is documented in the RPRW package hosted on GitHub), see \href{https://r-pkgs.org/man.html\#man}{here}. Though we skip it here, the RPRW package source does document the rivers data and can be viewed using \texttt{?rivers} after loading \texttt{RPRW}.

\hypertarget{the-second-function}{%
\subsection{The Second Function}\label{the-second-function}}

In \texttt{river\_means()}, we used a few functions: \texttt{\textless{}-}, \texttt{grep()}, \texttt{names()}, \texttt{{[}}, and \texttt{rowMeans()}. These functions are all from the base package, which is a special package in the way that it operates with R packages. If you use functions from the base package in your package, you don't have to give R any warning. If you use a function from another package, however, you do need to let R know where that function is coming from. Next we explore this.

Suppose we want to create a function in our package that computes the mean instead of a mean. First we run

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{use_r}\NormalTok{(}\StringTok{"river_medians"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Then we write the function. Note that there is no \texttt{rowMedians()} function, so we use \texttt{apply()} to summarize across rows (see \texttt{?apply} for more detail).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{river_medians <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{apply}\NormalTok{(new_data, }\DecValTok{1}\NormalTok{, median)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

But wait! You'll notice that the function \texttt{median()} is in the stats package, not the base package (run \texttt{?median} to check). So we need to let R know that we will be using a function from a package that is not the base package. To accomplish this, there are two steps to take. First, you need to tell R that you are using another package

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{use_package}\NormalTok{(}\StringTok{"stats"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{√ Adding }\StringTok{'stats'}\NormalTok{ to Imports field }\ControlFlowTok{in}\NormalTok{ DESCRIPTION}
\OperatorTok{*}\StringTok{ }\NormalTok{Refer to functions with }\StringTok{`}\DataTypeTok{stats::fun()}\StringTok{`}
\end{Highlighting}
\end{Shaded}

You will notice that the package stats was added to the Imports field in the DESCRIPTION file -- we will get to DESCRIPTION later, but for now just remember that it contains metadata about your package. You only need to run \texttt{use\_package("stats")} once per package. That is, if you are using a different function from stats, you don't need to run \texttt{use\_package("stats")} again. Second, you need to tell the \texttt{river\_median()} function to use the \texttt{median()} function from the stats package. The best practice is to preface any function from outside the base package with \texttt{packagename::}. This adjustment to \texttt{river\_median()} yields

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{river_medians <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{apply}\NormalTok{(new_data, }\DecValTok{1}\NormalTok{, stats}\OperatorTok{::}\NormalTok{median)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Though this is the best practice, it does add some extra typing and can be cumbersome if you are using outside functions often. The \texttt{packagename::} prefix can be avoided if you import \texttt{median()} to \texttt{river\_median()} using the roxygen tag \texttt{@importFrom}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#' Medians of river lengths and discharges}
\CommentTok{#'}
\CommentTok{#' @param data A data frame with two rows. The first row indicates river length and}
\CommentTok{#'   second row indicates river discharge. The columns of data indicate river names.}
\CommentTok{#' @param pattern A pattern by which to include only particular rivers}
\CommentTok{#'}
\CommentTok{#' @return The median river length and mean river discharge for the desired rivers}
\CommentTok{#' @importFrom stats median}
\CommentTok{#' @export}
\CommentTok{#'}
\CommentTok{#' @examples}
\CommentTok{#' data("rivers")}
\CommentTok{#' river_medians(rivers, pattern = "Mi")}
\NormalTok{river_medians <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{apply}\NormalTok{(new_data, }\DecValTok{1}\NormalTok{, median)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

If you are using several functions from stats, it may be easier to use the \texttt{@import} tag, which imports all functions from a package at once.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#' Medians of river lengths and discharges}
\CommentTok{#'}
\CommentTok{#' @param data A data frame with two rows. The first row indicates river length and}
\CommentTok{#'   second row indicates river discharge. The columns of data indicate river names.}
\CommentTok{#' @param pattern A pattern by which to include only particular rivers}
\CommentTok{#'}
\CommentTok{#' @return The median river length and mean river discharge for the desired rivers}
\CommentTok{#' @import stats}
\CommentTok{#' @export}
\CommentTok{#'}
\CommentTok{#' @examples}
\CommentTok{#' data("rivers")}
\CommentTok{#' river_medians(rivers, pattern = "Mi")}
\NormalTok{river_medians <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{apply}\NormalTok{(new_data, }\DecValTok{1}\NormalTok{, median)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Be careful when using \texttt{@importFrom} or \texttt{@import} to ensure that two functions from different packages don't have the same name -- this is when using \texttt{packagename::} to prefix the function is crucial.

\hypertarget{exercises-2}{%
\subsubsection{Exercises}\label{exercises-2}}

These exercises are challenging, so if they don't make sense now, that is okay! Make sure to re-review the solutions after the workshop.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Write a new function, \texttt{river\_stat()}, that takes a data frame, pattern, and a general function by which to summarize river length and discharge. This general function should not be an actual function but rather a placeholder so that a user may insert their own function as an argument.
\item
  Rewrite \texttt{river\_stat()} so that it also takes additional arguments to the summarizing function (hint: use \texttt{...} as an argument)
\end{enumerate}

\hypertarget{description}{%
\subsection{DESCRIPTION}\label{description}}

\hypertarget{namespace}{%
\subsection{NAMESPACE}\label{namespace}}

\hypertarget{testthat}{%
\subsection{testthat}\label{testthat}}

\hypertarget{license}{%
\subsection{License}\label{license}}

\hypertarget{check}{%
\subsection{\texorpdfstring{\texttt{check()}}{check()}}\label{check}}

\hypertarget{install}{%
\subsection{\texorpdfstring{\texttt{install()}}{install()}}\label{install}}

\hypertarget{congratulations}{%
\subsection{Congratulations}\label{congratulations}}

\hypertarget{additional-resources}{%
\section{Additional Resources}\label{additional-resources}}

\begin{itemize}
\tightlist
\item
  \href{https://r-pkgs.org/index.html}{R Packages} by \href{http://hadley.nz/}{Hadley Wickham} and \href{https://jennybryan.org/}{Jenny Bryan}
\item
  \href{https://hilaryparker.com/2014/04/29/writing-an-r-package-from-scratch/}{Writing an R package from scratch} by \href{https://hilaryparker.com/}{Hilary Parker}
\item
  \href{https://cran.r-project.org/doc/manuals/r-release/R-exts.html}{Writing R Extensions} by CRAN (this resource is very technical)
\end{itemize}

\hypertarget{a-research-compendia}{%
\chapter{A Research Compendia}\label{a-research-compendia}}

Placeholder

\hypertarget{your-compendia}{%
\chapter{Turning An R Package into a Reproducible Research Compendia}\label{your-compendia}}

\hypertarget{extensions}{%
\chapter{Extensions}\label{extensions}}

\hypertarget{exercise-solutions}{%
\chapter{Exercise Solutions}\label{exercise-solutions}}

\emph{Q} 1. What are some of your favorite R packages?

\emph{A} 1. This is for you to answer! Though a few of my favorites include devtools, styler, rticles, rlang, and purrr.

\emph{Q} 1. Of those ew have talked about so far, what benefits of R packages are most appealing to you?

\emph{A} 1. This is also for you to answer. My answer is ``all of them!'', though if I had to pick one, it is saving time by enforcing a structure -- future me appreciates when past me does this.

\emph{Q} 1. How many functions does \texttt{river\_means()} call within the body of the function? What package are these functions in?

\emph{A} 1. There are five functions: \texttt{\textless{}-}, \texttt{grep()}, \texttt{names()}, \texttt{{[}}, and \texttt{rowMeans()}. They are all in the ``base'' package, which can been seen in each function's documentation

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{?}\StringTok{`}\DataTypeTok{<-}\StringTok{`}
\NormalTok{?grep}
\NormalTok{?names}
\NormalTok{?}\StringTok{`}\DataTypeTok{[}\StringTok{`}
\NormalTok{?rowMeans}
\end{Highlighting}
\end{Shaded}

\emph{Q} 1. Write a new function, \texttt{river\_stat()}, that takes a data frame, pattern, and a general function by which to summarize river length and discharge. This general function should not be an actual function but rather a placeholder so that a user may insert their own function as an argument.

\emph{A} 1.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#' Summary statistics of river lengths and discharges}
\CommentTok{#'}
\CommentTok{#' @param data A data frame with two rows. The first row indicates river length and}
\CommentTok{#'   second row indicates river discharge. The columns of data indicate river names.}
\CommentTok{#' @param pattern A pattern by which to include only particular rivers}
\CommentTok{#' @param FUN A function to summarize the rivers}
\CommentTok{#'}
\CommentTok{#' @return The summarized river length and mean river discharge for the desired rivers}
\CommentTok{#' @export}
\CommentTok{#'}
\CommentTok{#' @examples}
\CommentTok{#' data("rivers")}
\CommentTok{#' river_stat(rivers, "Mi", min)}
\NormalTok{river_stat <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern, FUN) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{apply}\NormalTok{(new_data, }\DecValTok{1}\NormalTok{, FUN)}
\NormalTok{\}}
\KeywordTok{river_stat}\NormalTok{(rivers, }\StringTok{"Mi"}\NormalTok{, min)}
\CommentTok{#>    length discharge }
\CommentTok{#>      3544      1956}
\KeywordTok{river_stat}\NormalTok{(rivers, }\StringTok{"Mi"}\NormalTok{, max)}
\CommentTok{#>    length discharge }
\CommentTok{#>      3768     18400}
\KeywordTok{river_stat}\NormalTok{(rivers, }\StringTok{"Mi"}\NormalTok{, mean)}
\CommentTok{#>    length discharge }
\CommentTok{#>      3656     10178}
\KeywordTok{river_stat}\NormalTok{(rivers, }\StringTok{"Mi"}\NormalTok{, stats}\OperatorTok{::}\NormalTok{median)}
\CommentTok{#>    length discharge }
\CommentTok{#>      3656     10178}
\end{Highlighting}
\end{Shaded}

\emph{Q} 1. Rewrite \texttt{river\_stat()} so that it also takes additional arguments to the summarizing function (hint: use \texttt{...} as an argument)

\emph{A} 1.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#' Summary statistics of river lengths and discharges}
\CommentTok{#'}
\CommentTok{#' @param data A data frame with two rows. The first row indicates river length and}
\CommentTok{#'   second row indicates river discharge. The columns of data indicate river names.}
\CommentTok{#' @param pattern A pattern by which to include only particular rivers}
\CommentTok{#' @param FUN A function to summarize the rivers}
\CommentTok{#' @param ... Additional arguments to pass to \textbackslash{}code\{FUN\}}
\CommentTok{#'}
\CommentTok{#' @return The summarized river length and mean river discharge for the desired rivers}
\CommentTok{#' @export}
\CommentTok{#'}
\CommentTok{#' @examples}
\CommentTok{#' data("rivers")}
\CommentTok{#' river_stat(rivers, "Mi|C", mean, trim = 0.5)}
\NormalTok{river_stat <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern, FUN, ...) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{apply}\NormalTok{(new_data, }\DecValTok{1}\NormalTok{, FUN, ...)}
\NormalTok{\}}
\KeywordTok{river_stat}\NormalTok{(rivers, }\StringTok{"Mi|C"}\NormalTok{, mean, }\DataTypeTok{trim =} \DecValTok{0}\NormalTok{)}
\CommentTok{#>    length discharge }
\CommentTok{#>      2620      5660}
\KeywordTok{river_stat}\NormalTok{(rivers, }\StringTok{"Mi|C"}\NormalTok{, mean, }\DataTypeTok{trim =} \FloatTok{0.5}\NormalTok{)}
\CommentTok{#>    length discharge }
\CommentTok{#>      2330      1956}
\end{Highlighting}
\end{Shaded}

  \bibliography{book.bib,packages.bib}

\end{document}
