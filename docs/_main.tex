% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{book}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Using R Packages for Reproducible Workflows},
  pdfauthor={Michael Dumelle},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs}
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{booktabs}
\usepackage[]{natbib}
\bibliographystyle{plainnat}

\title{Using R Packages for Reproducible Workflows}
\author{Michael Dumelle}
\date{September 22, 2021}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{1}
\tableofcontents
}
\hypertarget{overview}{%
\chapter*{Overview}\label{overview}}
\addcontentsline{toc}{chapter}{Overview}

Welcome to the 2021 EPA R Workshop titled ``Using R Packages for Reproducible Workflows'' by me, Michael Dumelle -- I am glad to have you here! Before proceeding, let's first start up R and download the \href{https://devtools.r-lib.org/}{devtools} package.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"devtools"}\NormalTok{) }\CommentTok{# if required}
\end{Highlighting}
\end{Shaded}

The workshop's companion R package (Using \textbf{R} \textbf{P}ackages for \textbf{R}eproducible \textbf{W}orkflows) is available for download via

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{devtools}\OperatorTok{::}\KeywordTok{install_github}\NormalTok{(}\DataTypeTok{repo =} \StringTok{"michaeldumelle/RPRW"}\NormalTok{, }\DataTypeTok{ref =} \StringTok{"main"}\NormalTok{)}
\KeywordTok{library}\NormalTok{(RPRW)}
\end{Highlighting}
\end{Shaded}

Here are the sections of this workshop:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  \protect\hyperlink{r-package}{Building an R Package}
\item
  \protect\hyperlink{r-package-research-compendium}{Making an R Package a Research Compendium}
\item
  \protect\hyperlink{extensions}{Extensions}
\item
  \protect\hyperlink{exercise-solutions}{Exercise Solutions}
\end{enumerate}

\hypertarget{acknowledgements}{%
\section*{Acknowledgements}\label{acknowledgements}}
\addcontentsline{toc}{section}{Acknowledgements}

I would like to thank Charlotte Wickham, Hadley Wickham, Jenny Bryan, and Yihui Xie for the immense impact their work has had on my programming journey. Much of this workshop draws from heavily their inspiration. I would also like to thank everyone who helped me hold this workshop.

\hypertarget{r-package}{%
\chapter{Building an R Package}\label{r-package}}

\hypertarget{what-is-an-r-package}{%
\section{What is an R Package?}\label{what-is-an-r-package}}

An R package is a collection of code, data, documentation, and tests with a particular structure that can be shared with others. R packages are commonly downloaded from the Comprehensive R Archive Network (\href{https://cran.r-project.org/}{CRAN}). You can install them from CRAN with \texttt{install.packages("package\_name")}, load them in your workspace with \texttt{library("package\_name")}, and get help by running (\texttt{help(package\ =\ "package\_name")}).

One of the reasons R packages are so useful is because they are the fundamental way to share code in R. If your code is in a package, others can easily download and use it. If they are familiar with R packages, they likely will be familiar with how to use yours! But sharing R code is not the only benefit of creating R packages. Learning how to build an R package will provide several other benefits to future you!

Future you will benefit from creating your own R packages because they enforce a particular structure. This structure

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Saves you time -- you don't need to think about how to organize your files, R packages have a template!

  \begin{itemize}
  \tightlist
  \item
    This was especially helpful for me because before learning how to create R packages, I would save my R files in all sorts of locations on my computer with all sorts of names. This made it \emph{very challenging} to come back to my work later and find a particular file.
  \end{itemize}
\item
  Gives you standardized tools -- people have created extremely useful tools that work with R packages, so take advantage of them!

  \begin{itemize}
  \tightlist
  \item
    The R package devtools, which we downloaded earlier, contains many of these standarized tools.
  \end{itemize}
\item
  Requires documentation -- This is especially helpful for future you.

  \begin{itemize}
  \tightlist
  \item
    Before I started using R packages, when I would come back my old code, I was convinced someone else wrote it -- I basically had to rewrite it all to understand it. R packages help prevent this.
  \end{itemize}
\item
  Is reproducible -- R packages are built from R projects (see \href{https://r4ds.had.co.nz/workflow-projects.html}{here} and \href{https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects}{here}), so file paths are relative, not absolute!

  \begin{itemize}
  \tightlist
  \item
    \texttt{read\_csv("a\_fun\_csv\_file.csv")} works on my machine -- and yours!
  \item
    While R projects are not the fundamental focus on today, I highly, highly recommend you use them for every data analysis project that you are not using an R package for.
  \end{itemize}
\item
  Guides your data analysis -- We will talk about this today

  \begin{itemize}
  \tightlist
  \item
    See \citet{marwick2018packaging} for more!
  \end{itemize}
\end{enumerate}

\hypertarget{exercises}{%
\subsection{Exercises}\label{exercises}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  What are some of your favorite R packages?
\item
  Of those we have talked about so far, what benefits of R packages are most appealing to you?
\end{enumerate}

\hypertarget{creating-an-r-package}{%
\section{Creating an R Package}\label{creating-an-r-package}}

Together, we will create the companion package for this workshop! If this is your first R package, then an extra special congratulations to you -- this is a big milestone! The name of the package is

\hypertarget{the-motivating-dataset}{%
\subsection{The Motivating Dataset}\label{the-motivating-dataset}}

Suppose we want to build an R package that summarizes length (in kilometers) and discharge (meters per second cubed) of North American rivers based on the names of the rivers. Below is our data of interest

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{river <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}
  \DataTypeTok{Missouri =} \KeywordTok{c}\NormalTok{(}\DecValTok{3768}\NormalTok{, }\DecValTok{1956}\NormalTok{),}
  \DataTypeTok{Mississippi =} \KeywordTok{c}\NormalTok{(}\DecValTok{3544}\NormalTok{, }\DecValTok{18400}\NormalTok{),}
  \DataTypeTok{Yukon =} \KeywordTok{c}\NormalTok{(}\DecValTok{3190}\NormalTok{, }\DecValTok{6340}\NormalTok{),}
  \DataTypeTok{Colorado =} \KeywordTok{c}\NormalTok{(}\DecValTok{2330}\NormalTok{, }\DecValTok{40}\NormalTok{),}
  \DataTypeTok{Arkansas =} \KeywordTok{c}\NormalTok{(}\DecValTok{2322}\NormalTok{, }\DecValTok{1004}\NormalTok{),}
  \DataTypeTok{Columbia =} \KeywordTok{c}\NormalTok{(}\DecValTok{2000}\NormalTok{, }\DecValTok{7730}\NormalTok{),}
  \DataTypeTok{Red =} \KeywordTok{c}\NormalTok{(}\DecValTok{1811}\NormalTok{, }\DecValTok{852}\NormalTok{),}
  \DataTypeTok{Canadian =} \KeywordTok{c}\NormalTok{(}\DecValTok{1458}\NormalTok{, }\DecValTok{174}\NormalTok{)}
\NormalTok{) }
\KeywordTok{rownames}\NormalTok{(river) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"length"}\NormalTok{, }\StringTok{"discharge"}\NormalTok{)}
\NormalTok{river}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#>           Missouri Mississippi Yukon Colorado Arkansas Columbia  Red Canadian
#> length        3768        3544  3190     2330     2322     2000 1811     1458
#> discharge     1956       18400  6340       40     1004     7730  852      174
\end{verbatim}

\hypertarget{the-first-step}{%
\subsection{The First Step}\label{the-first-step}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{devtools}\OperatorTok{::}\KeywordTok{create_package}\NormalTok{(}\StringTok{"path_to_RPRW_package/RPRW"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
√ Creating 'path_to_RPRW_package/RPRW/'
√ Setting active project to 'path_to_RPRW_package/RPRW'
√ Creating 'R/'
√ Writing 'DESCRIPTION'
Package: RPRW
Title: What the Package Does (One Line, Title Case)
Version: 0.0.0.9000
Authors@R (parsed):
    * First Last <first.last@example.com> [aut, cre] (YOUR-ORCID-ID)
Description: What the package does (one paragraph).
License: `use_mit_license()`, `use_gpl3_license()` or friends to
    pick a license
Encoding: UTF-8
LazyData: true
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.1.1
√ Writing 'NAMESPACE'
√ Writing 'RPRW.Rproj'
√ Adding '^RPRW\\.Rproj$' to '.Rbuildignore'
√ Adding '.Rproj.user' to '.gitignore'
√ Adding '^\\.Rproj\\.user$' to '.Rbuildignore'
√ Opening 'path_to_RPRW_package/RPRW/' in new RStudio session
√ Setting active project to '<no active project>'
√ Setting active project to 'path_to_RPRW_package/RPRW'
\end{verbatim}

In the ``Files'' pane of RStudio (bottom right corner), you will see that your folder has been populated with a few new files and a new folder.

\includegraphics[width=1\linewidth]{images/newrpack_files}
We will focus on some of these next.

You will also notice that the ``Environment'' pane of RStudio (top right corner) now has a ``Build'' tab -- this tab contains some useful tools for your R package.

\begin{itemize}
\tightlist
\item
  R (folder): Where functions in your R package are stored
\item
  Description: This contains metadata for your package
\item
  Namespace: Information about 1) functions from other packages your package uses and 2) what functions in your package you make available to others
\end{itemize}

\hypertarget{the-first-function}{%
\subsection{The First Function}\label{the-first-function}}

The R folder is where functions in your R package are stored. Let's create our first function, called \texttt{river\_medians()}, which finds the median of river length and discharge of desired rivers. Generally, the name of your file should match the name of the function, and you should use separate files for separate functions. More experienced users, it is okay to break this rule every once in a while in certain contexts. To create an R file in the R folder, run

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{use_r}\NormalTok{(}\StringTok{"river_means"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

You will see some output in the console

\begin{verbatim}
* Modify 'R/river_means.R'
* Call `use_test()` to create a matching test file 
\end{verbatim}

and the appropriate file now in your R folder.

\includegraphics[width=1\linewidth]{images/newrpack_function}

Now let's write our function. We want this function to take the mean length and discharge of all rivers whose names have a common pattern.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{river_means <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{rowMeans}\NormalTok{(new_data)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

The first line of code finds the variables in the data whose names match the pattern. The second line of code subsets the data to include only the desired variables. The third line of code finds and returns the mean length and mean discharge of the desired variables. If you would like, you can leave comments in the code (using \texttt{\#}) to remind yourself what each line of code does. This is usually good practice, as it can help others (and future you) understand the intent of your code line-by-line.

\hypertarget{load_all}{%
\subsection{\texorpdfstring{\texttt{load\_all()}}{load\_all()}}\label{load_all}}

So we have written this function, how should we try it out? Well you \emph{could}
run the function or source it (\texttt{source("R/river\_means.R")}), but this puts it in our global workspace, and if you are not careful, global workspaces can get messy. The devtools
function \texttt{load\_all()} emulates the process of building, installing, and loading our R package, making all of your functions available via a single line of code. As your package becomes more complicated, it is much easier to try our your functions using \texttt{load\_all()} than navigating the global workspace.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{load_all}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

Now let's try out our function! What if we want our summary for the rivers starting with ``Mi'' (Missiouri and Mississippi)?

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{river_means}\NormalTok{(river, }\StringTok{"Mi"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#>    length discharge 
#>      3656     10178
\end{verbatim}

Or what if we want our summary for rivers starting with ``Y'' (Yukon) or ``R'' (Red)?

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{river_means}\NormalTok{(river, }\StringTok{"Y|R"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#>    length discharge 
#>    2500.5    3596.0
\end{verbatim}

Hooray -- our function works! Give yourself a congratulations :)!

\hypertarget{exercises-1}{%
\subsubsection{Exercises}\label{exercises-1}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  How many functions does \texttt{river\_means()} call within the body of the function? What package are these functions in?
\end{enumerate}

\hypertarget{creating-package-data}{%
\subsection{Creating Package Data}\label{creating-package-data}}

So far we have used the \texttt{river} data from our global workspace. But what if we want this to be data that is included as part of the R packages so that others (or future you) have easy access to it? This is the place for \texttt{use\_data()}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{use_data}\NormalTok{(river)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
√ Creating 'data/'
√ Saving 'river' to 'data/river.rda'
\end{verbatim}

You will see that at the root of your R package, there is a folder called ``data'', and in that folder is a file called rivers.rda, which contains the rivers data. For illustration, let's remove rivers from our global workspace and then load it like we would data from any other package

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{rm}\NormalTok{(river) }\CommentTok{# remove the river data from our global workspace}
\KeywordTok{load_all}\NormalTok{() }\CommentTok{# emulate package building process}
\KeywordTok{data}\NormalTok{(}\StringTok{"river"}\NormalTok{) }\CommentTok{# load the river data}
\NormalTok{river}
\end{Highlighting}
\end{Shaded}

\hypertarget{roxygen-comments}{%
\subsection{roxygen Comments}\label{roxygen-comments}}

Now that you have written your function, it is time to thoroughly document your function so that others (or future you) can understand how to use it. The documentation for R functions uses special types of comments called \emph{roxygen} comments. The comments use \texttt{\#\textquotesingle{}} and have special ``tags'' associated with them. To insert a template of roxygen comments into \texttt{river\_means()}, put your cursor somewhere in the \texttt{river\_means()} function and either

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  In the upper-left toolbar, go to Code -\textgreater{} Insert Roxygen Skeleton
\item
  Press Ctrl/Cmd + Alt + Shift + R
\end{enumerate}

You will see \texttt{river\_means()} now looks like

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#' Title}
\CommentTok{#'}
\CommentTok{#' @param data }
\CommentTok{#' @param pattern }
\CommentTok{#'}
\CommentTok{#' @return}
\CommentTok{#' @export}
\CommentTok{#'}
\CommentTok{#' @examples}
\NormalTok{river_means <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{rowMeans}\NormalTok{(new_data)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

The \texttt{@} indicates a particular ``tag'' that controls how functions are documented.

\begin{itemize}
\tightlist
\item
  \texttt{@param}: for documenting arguments to a function
\item
  \texttt{@return}: for documenting the function output
\item
  \texttt{@export}: for making this function available to others downloading your package
\item
  \texttt{@examples}: to give examples for how to use the package
\end{itemize}

Let's fill these in.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#' Means of river lengths and discharges}
\CommentTok{#'}
\CommentTok{#' @param data A data frame with two rows. The first row indicates river length and}
\CommentTok{#'   second row indicates river discharge. The columns of data indicate river names.}
\CommentTok{#' @param pattern A pattern by which to include only particular rivers}
\CommentTok{#'}
\CommentTok{#' @return The mean river length and mean river discharge for the desired rivers}
\CommentTok{#' @export}
\CommentTok{#'}
\CommentTok{#' @examples}
\CommentTok{#' data("rivers")}
\CommentTok{#' river_means(rivers, pattern = "Mi")}
\NormalTok{river_means <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{rowMeans}\NormalTok{(new_data)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

To view this documentation as you would any other package's function documentation, first run

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{document}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
i Updating RPRW documentation
i Loading RPRW
Writing NAMESPACE
Writing river_means.Rd
\end{verbatim}

You will notice that there is a new folder at the root of the package, called ``man'', which contains a file called \texttt{river\_means.Rd}.

\includegraphics[width=1\linewidth]{images/newrpack_files2}

The contents of the file here are not too important, as this file is automatically created using \texttt{document()}. The important point is that after running \texttt{document()}, you can view the documentation of your function!

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{?river_means}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=1\linewidth]{images/newrpack_example}

There are several other tags available to customize your documentation -- for more information about these tags and documenting data (which is different than documentation function; the rivers data is documented in the RPRW package hosted on GitHub), see \href{https://r-pkgs.org/man.html\#man}{here}. Though we skip it here, the RPRW package source does document the rivers data and can be viewed using \texttt{?rivers} after loading \texttt{RPRW}.

\hypertarget{the-second-function}{%
\subsection{The Second Function}\label{the-second-function}}

In \texttt{river\_means()}, we used a few functions: \texttt{\textless{}-}, \texttt{grep()}, \texttt{names()}, \texttt{{[}}, and \texttt{rowMeans()}. These functions are all from the base package, which is a special package in the way that it operates with R packages. If you use functions from the base package in your package, you don't have to give R any warning. If you use a function from another package, however, you do need to let R know where that function is coming from. Next we explore this.

Suppose we want to create a function in our package that computes the mean instead of a mean. First we run

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{use_r}\NormalTok{(}\StringTok{"river_medians"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Then we write the function. Note that there is no \texttt{rowMedians()} function, so we use \texttt{apply()} to summarize across rows (see \texttt{?apply} for more detail).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{river_medians <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{apply}\NormalTok{(new_data, }\DecValTok{1}\NormalTok{, median)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

But wait! You'll notice that the function \texttt{median()} is in the stats package, not the base package (run \texttt{?median} to check). So we need to let R know that we will be using a function from a package that is not the base package. To accomplish this, there are two steps to take. First, you need to tell R that you are using another package

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{use_package}\NormalTok{(}\StringTok{"stats"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
√ Adding 'stats' to Imports field in DESCRIPTION
* Refer to functions with `stats::fun()`
\end{verbatim}

You will notice that the package stats was added to the Imports field in the DESCRIPTION file -- we will get to DESCRIPTION later, but for now just remember that it contains metadata about your package. You only need to run \texttt{use\_package("stats")} once per package. That is, if you are using a different function from stats, you don't need to run \texttt{use\_package("stats")} again. Second, you need to tell the \texttt{river\_median()} function to use the \texttt{median()} function from the stats package. The best practice is to preface any function from outside the base package with \texttt{packagename::}. This adjustment to \texttt{river\_median()} yields

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{river_medians <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{apply}\NormalTok{(new_data, }\DecValTok{1}\NormalTok{, stats}\OperatorTok{::}\NormalTok{median)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Though this is the best practice, it does add some extra typing and can be cumbersome if you are using outside functions often. The \texttt{packagename::} prefix can be avoided if you import \texttt{median()} to \texttt{river\_median()} using the roxygen tag \texttt{@importFrom}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#' Medians of river lengths and discharges}
\CommentTok{#'}
\CommentTok{#' @param data A data frame with two rows. The first row indicates river length and}
\CommentTok{#'   second row indicates river discharge. The columns of data indicate river names.}
\CommentTok{#' @param pattern A pattern by which to include only particular rivers}
\CommentTok{#'}
\CommentTok{#' @return The median river length and mean river discharge for the desired rivers}
\CommentTok{#' @importFrom stats median}
\CommentTok{#' @export}
\CommentTok{#'}
\CommentTok{#' @examples}
\CommentTok{#' data("rivers")}
\CommentTok{#' river_medians(rivers, pattern = "Mi")}
\NormalTok{river_medians <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{apply}\NormalTok{(new_data, }\DecValTok{1}\NormalTok{, median)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

If you are using several functions from stats, it may be easier to use the \texttt{@import} tag, which imports all functions from a package at once.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#' Medians of river lengths and discharges}
\CommentTok{#'}
\CommentTok{#' @param data A data frame with two rows. The first row indicates river length and}
\CommentTok{#'   second row indicates river discharge. The columns of data indicate river names.}
\CommentTok{#' @param pattern A pattern by which to include only particular rivers}
\CommentTok{#'}
\CommentTok{#' @return The median river length and mean river discharge for the desired rivers}
\CommentTok{#' @import stats}
\CommentTok{#' @export}
\CommentTok{#'}
\CommentTok{#' @examples}
\CommentTok{#' data("rivers")}
\CommentTok{#' river_medians(rivers, pattern = "Mi")}
\NormalTok{river_medians <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{apply}\NormalTok{(new_data, }\DecValTok{1}\NormalTok{, median)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Be careful when using \texttt{@importFrom} or \texttt{@import} to ensure that two functions from different packages don't have the same name -- this is when using \texttt{packagename::} to prefix the function is crucial.

\hypertarget{exercises-2}{%
\subsubsection{Exercises}\label{exercises-2}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Play around with using these functions for some new patterns -- do you notice anything strange?
\end{enumerate}

These exercises are more challenging, so if they don't make sense now, that is okay! Make sure to re-review the solutions after the workshop.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\item
  Write a new function, \texttt{river\_stat()}, that takes a data frame, pattern, and a general function by which to summarize river length and discharge. This general function should not be an actual function but rather a placeholder so that a user may insert their own function as an argument.
\item
  Rewrite \texttt{river\_stat()} so that it also takes additional arguments to the summarizing function (hint: use \texttt{...} as an argument)
\end{enumerate}

\hypertarget{description}{%
\subsection{DESCRIPTION}\label{description}}

The DESCRIPTION file is automatically added while creating an R package and contains the R package's metadata.

\begin{verbatim}
Package: RPRW
Title: R Packages for Reproducible Workflows
Version: 0.0.0.9000
Authors@R: 
    person(given = "Michael",
           family = "Dumelle",
           role = c("aut", "cre"),
           email = "first.last@example.com")
Description: A companion R package for "Using R Packages for Reproducible Workflows"
    at the 2021 EPA R Workshop.
License: `use_mit_license()`, `use_gpl3_license()` or friends to pick a
    license
Encoding: UTF-8
LazyData: true
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.1.1
Depends: 
    R (>= 2.10)
Imports: 
    stats
\end{verbatim}

The DESCRIPTION file is where you track version numbers, authorship, and additional R packages that your R package uses. Two fields in DESCRIPTION do most of the communication regarding how your R package uses additional R packages:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Imports: Packages here must be installed in order for your package to work. As a result, any package listed in \texttt{Imports} will be installed alongside your package. Packages in \texttt{Imports} help build the foundation of your package.
\item
  Suggests: Packages here enhance your package but are not required for your package to work. You might use suggested packages for enhanced plotting, additional data sets, or more. Packages in \texttt{Suggests} can add finishing touches to your package, but they are not part of your package's foundation.
\end{enumerate}

Other fields used to communicate how your R package uses additional R packages are \texttt{Depends}, \texttt{LinkingTo}, and \texttt{Enhances}. The difference between \texttt{Depends} and \texttt{Imports} is subtle -- the general advice is to use \texttt{Imports} instead of \texttt{Depends}.

\hypertarget{namespace}{%
\subsection{NAMESPACE}\label{namespace}}

While the DESCRIPTION file communicates what packages your package \emph{uses}, the NAMESPACE file communicates \emph{how} your package uses these packages. More specifically, the NAMESPACE file controls which functions your package exports (makes available to others) and what functions from what packages must be available for your exported functions to work. This file is automatically generated by devtools and should not be edited by hand.

In \texttt{river\_median()}, if you called \texttt{median} using \texttt{stats::median}, your NAMESPACE file will look like

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Generated by roxygen2: do not edit by hand}

\KeywordTok{export}\NormalTok{(river_means)}
\KeywordTok{export}\NormalTok{(river_medians)}
\end{Highlighting}
\end{Shaded}

If you used the \texttt{@importFrom\ stats\ median} approach, your NAMESPACE will look like

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Generated by roxygen2: do not edit by hand}

\KeywordTok{export}\NormalTok{(river_means)}
\KeywordTok{export}\NormalTok{(river_medians)}
\KeywordTok{importFrom}\NormalTok{(stats,median)}
\end{Highlighting}
\end{Shaded}

If you used the \texttt{@import\ stats} approach, your NAMESPACE will look like

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Generated by roxygen2: do not edit by hand}

\KeywordTok{export}\NormalTok{(river_means)}
\KeywordTok{export}\NormalTok{(river_medians)}
\KeywordTok{import}\NormalTok{(stats)}
\end{Highlighting}
\end{Shaded}

\hypertarget{testthat}{%
\subsection{testthat}\label{testthat}}

Testing your code to make sure that it performs as intended is an important step in the package building process. Though upfront, it may seem like extra work, implementing a rigorous testing procedure for your package will provide several benefits: \href{https://r-pkgs.org/tests.html}{fewer bugs, better code structure, easier restarts, and robust code}. In R, testing is incorporated into your package through the \href{https://testthat.r-lib.org/}{testthat} package. To begin using testthat, run

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{use_testthat}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
√ Adding 'testthat' to Suggests field in DESCRIPTION
√ Setting Config/testthat/edition field in DESCRIPTION to '3'
√ Creating 'tests/testthat/'
√ Writing 'tests/testthat.R'
\end{verbatim}

The root of your package directory shoudl look like

\includegraphics[width=1\linewidth]{images/newrpack_files3}

The tests folder should look like

\includegraphics[width=1\linewidth]{images/newrpack_files4}

Tests are generally written on a function-by-function basis. All tests for a function are contained in an R script titled \texttt{test-function\_name}. For example, to start testing \texttt{river\_means()}, run

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{use_test}\NormalTok{(}\StringTok{"river_means"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
√ Writing 'tests/testthat/test-river_means.R'
* Modify 'tests/testthat/test-river_means.R'
\end{verbatim}

Your \texttt{testthat} folder should look like

\includegraphics[width=1\linewidth]{images/newrpack_files5}

Tests can be fairly detailed and cover many components of a function (such as input types, output types, function output, etc.). Here we write a simple test that calculates whether our function, \texttt{river\_means()}, yields output that we would expect if we calculated the means ``by hand'' for an example scenario where our pattern includes Missouri and Mississippi.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{test_that}\NormalTok{(}\StringTok{"the mean length is calculated correctly in a test case"}\NormalTok{, \{}
  
  \CommentTok{# calculate values required for the test for length}

  \CommentTok{## calculate the means from the function}
\NormalTok{  river_means_val <-}\StringTok{ }\KeywordTok{river_means}\NormalTok{(river, }\StringTok{"Missouri|Mississippi"}\NormalTok{)}
\NormalTok{  river_means_length <-}\StringTok{ }\NormalTok{river_means_val[[}\DecValTok{1}\NormalTok{]]}

  \CommentTok{## calculate the means "by hand"}
\NormalTok{  raw_vec_length <-}\StringTok{ }\KeywordTok{unlist}\NormalTok{(river[}\StringTok{"length"}\NormalTok{, }\KeywordTok{c}\NormalTok{(}\StringTok{"Missouri"}\NormalTok{, }\StringTok{"Mississippi"}\NormalTok{)])}
\NormalTok{  raw_means_length <-}\StringTok{ }\KeywordTok{mean}\NormalTok{(raw_vec_length)}
  
  \CommentTok{# perform the actual test for length}

  \CommentTok{## check that the function and "by hand" output matches}
  \KeywordTok{expect_equal}\NormalTok{(river_means_length, raw_means_length)}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> Error in test_that("the mean length is calculated correctly in a test case", : could not find function "test_that"
\end{verbatim}

The tests in testthat are prefixed with \texttt{expect\_}. If you have many tests, the \texttt{test()} function runs all of them in the \texttt{testthat} folder:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{test}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
i Loading RPRW
i Testing RPRW
√ |  OK F W S | Context
√ |   1       | river_means                                                     
                                               
== Results =========================================================================
[ FAIL 0 | WARN 0 | SKIP 0 | PASS 1 ]
\end{verbatim}

We can write a similar test for discharge and then repeat the process for \texttt{river\_meadians()}. Then \texttt{test()} returns

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{test}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
i Loading RPRW
i Testing RPRW
√ |  OK F W S | Context
√ |   2       | river_means                                                         
√ |   2       | river_medians                                                       

== Results =========================================================================
[ FAIL 0 | WARN 0 | SKIP 0 | PASS 4 ]
\end{verbatim}

All tests pass -- hooray! I want to again emphasize how important testing is. I know that it seems like an extra chore, but in my experience, writing careful tests has always paid off\ldots with interest.

\hypertarget{exercises-3}{%
\subsubsection{Exercises}\label{exercises-3}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Write similar tests for \texttt{river\_means()} (discharge), \texttt{river\_medians()} (length), and \texttt{river\_medians()} (length)
\end{enumerate}

\hypertarget{license}{%
\subsection{License}\label{license}}

At some point, your package needs a license. The license places restrictions on how your package can be shared with others. Licensing can be complicated quickly, so I refer you \href{https://r-pkgs.org/license.html}{here} for more information. For illustration purposes, we will use a GPL-3 license for this package.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{use_gpl_license}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
√ Setting active project to 'path_to_RPRW_package/RPRW'
√ Setting License field in DESCRIPTION to 'GPL (>= 3)'
√ Writing 'LICENSE.md'
√ Adding '^LICENSE\\.md$' to '.Rbuildignore'
\end{verbatim}

The licensing update will be reflected in the DESCRIPTION file.

\hypertarget{vignettes}{%
\subsection{Vignettes}\label{vignettes}}

Vignettes act as high-level user guides for your package. A vignette acts as the glue that binds together all the documentation from the individual functions to solve a particular problem. Typically, they guide the user through a typical workflow one would experience while using your package. The \href{https://ggplot2.tidyverse.org/}{ggplot2} package is a popular package for visualizing data. After installing ggplot2

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"ggplot2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

you can view its available vignettes by running

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{vignette}\NormalTok{(}\DataTypeTok{package =} \StringTok{"ggplot2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

A file will pop up alongside your R scripts with the contents

\includegraphics[width=1\linewidth]{images/newrpack_files6}
Then to view a specific vignette, run \texttt{vignette(topic,\ package)}. For example, to view the vignette regarding \textbf{aes}thetic specifications, run

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{vignette}\NormalTok{(}\StringTok{"ggplot2-specs"}\NormalTok{, }\StringTok{"ggplot2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

You will then see the vignette in the bottom-right hand pane of RStudio. Vignettes are also available on a package's CRAN page -- for the ggplot2 aesthetic specifications vignette, see \href{https://cran.r-project.org/web/packages/ggplot2/vignettes/ggplot2-specs.html}{here}.

To include vignettes in your R package, first run

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{use_vignette}\NormalTok{(}\StringTok{"river-statistics"}\NormalTok{, }\StringTok{"River Statistics"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
√ Adding 'knitr' to Suggests field in DESCRIPTION
√ Setting VignetteBuilder field in DESCRIPTION to 'knitr'
√ Adding 'inst/doc' to '.gitignore'
√ Creating 'vignettes/'
√ Adding '*.html', '*.R' to 'vignettes/.gitignore'
√ Adding 'rmarkdown' to Suggests field in DESCRIPTION
√ Writing 'vignettes/river-statistics.Rmd'
* Modify 'vignettes/river-statistics.Rmd'
\end{verbatim}

A few things happen after running \texttt{use\_vignette()}: your DESCRIPTION file is edited, a vignettes folder is inserted into the root of your directory, and a \texttt{.Rmd} file is added to the vignettes folder. The \texttt{.Rmd} file extension indicates that the vignette is an RMarkdown document. RMarkdown documents provide a convenient way to create \emph{dynamic} documents. Dynamic documents combine code and text and form the foundation for reproducible report writing in R. More on RMarkdown is available \href{https://rmarkdown.rstudio.com/}{here}, \href{https://bookdown.org/yihui/rmarkdown/}{here} and \href{https://bookdown.org/yihui/rmarkdown-cookbook/}{here}. I highly recommend you get some experience with it, as its tools are quite powerful.

While we won't create a vignette for our package during the workshop, I have added a vignette to the companion R package. After installation, it can be viewed by running

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{vignette}\NormalTok{(river}\OperatorTok{-}\NormalTok{statistics, }\StringTok{"RPRW"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{check}{%
\subsection{\texorpdfstring{\texttt{check()}}{check()}}\label{check}}

So now we have built our R package and are ready to share it with the world! But we should probably check to make sure we did not make any small mistakes? This is what \texttt{check()} does -- it runs through a series of checks on your package to make sure it can be properly installed and shared. \texttt{check()} takes a few minutes to run, but it will return errors, warnings, and notes associated with your package. Though the warnings and notes are important, it is most crucial to address the errors immediately.
Hopefully your output after running \texttt{check()} looks like

\begin{verbatim}
-- R CMD check results ---------- RPRW 0.0.0.9000 ----
Duration: 34.4s

0 errors √ | 0 warnings √ | 0 notes √
\end{verbatim}

\hypertarget{install}{%
\subsection{\texorpdfstring{\texttt{install()}}{install()}}\label{install}}

After \texttt{check()} returns zero errors (and hopefully zero warnings and notes), you can install your package by running

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{install}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

After installation, you can use \texttt{library()} to load your package (like you do any other R package).

\hypertarget{congratulations}{%
\subsection{Congratulations}\label{congratulations}}

Congratulations on building an R package!

\includegraphics[width=0.5\linewidth]{images/you_did_it}

\hypertarget{debugging}{%
\section{Debugging}\label{debugging}}

Even the best of programmers write code that may fail in unintended ways. This is referred to as a ``bug,'' and the process of fixing the ``bug'' is known as ``debugging''. Don't expect to always write perfect code -- do expect to have the tools necessary to track down bugs and remedy them. Though we went through a rigorous documentation and testing procedure when creating \texttt{river\_means()} and \texttt{river\_medians()}, there are still bugs present in these functions.

\hypertarget{a-mysterious-error-message}{%
\subsection{A Mysterious Error Message}\label{a-mysterious-error-message}}

We have used \texttt{river\_means()} and \texttt{river\_medians()} to successfully find means and medians for all sorts of river combinations. But running

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{river_means}\NormalTok{(river, }\StringTok{"R"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> Error in rowMeans(new_data): 'x' must be an array of at least two dimensions
\end{verbatim}

yields a mystifying error. Something is wrong -- and we need to figure out what. A good first step is to copy and paste the error into a Google search engine and see if anyone has solved the problem yet. If you are lucky, this will help you find the bug. If not, you need to use another approach. Fortunately, R has tools to help isolate bugs.

\hypertarget{traceback}{%
\subsection{\texorpdfstring{\texttt{traceback()}}{traceback()}}\label{traceback}}

The \texttt{traceback()} function is run after code generating an error and it identifies where the error occurred.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{traceback}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
3: stop("'x' must be an array of at least two dimensions")
2: rowMeans(new_data) at #4
1: river_means(rivers, "R")
\end{verbatim}

Locating the source of bugs goes a long way towards removing them. Here, we see that the function failed at the \texttt{rowMeans()} step of \texttt{river\_means()} (line \texttt{\#4} of \texttt{river\_means()}. While useful, we still don't exactly know why the error is occurring.

\hypertarget{browser}{%
\subsection{\texorpdfstring{\texttt{browser()}}{browser()}}\label{browser}}

Before I learned about \texttt{browser()}, I would try to debug by storing my arguments locally (so that they were in the global environment) and then sequentially running each line of the function one-at-a-time. Perhaps some of you have done this too. Unfortunately, for many reasons (which we don't discuss in detail today), its an inferior method of debugging compared to \texttt{browser()}. The \texttt{browser()} method involves inserting \texttt{browser()} into the body of your function. Running your function with \texttt{browser()} inside of it then let's you interactively step into the function at \texttt{browser()}. No more storing arguments and running code line-by-line! Let's try this out with \texttt{river\_means()}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{river_means <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
  \KeywordTok{browser}\NormalTok{()}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{rowMeans}\NormalTok{(new_data)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Now when running \texttt{river\_means()}, you will step into the function. For example,

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{river_means}\NormalTok{(river, }\StringTok{"R"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

will open a new file that looks like

\includegraphics[width=0.75\linewidth]{images/newrpack_files7}

In your new interactive context, you will see a few buttons in the R console (lower left-hand window)

\includegraphics[width=0.75\linewidth]{images/newrpack_files8}

These are five buttons to type into the console and evaluate (\texttt{Enter/Return}) that let you navigate the interactive context. In order (left to right), they are

\begin{itemize}
\tightlist
\item
  Next (\texttt{n}) executes the next line of the code
\item
  Step (\texttt{s}) steps into the function called by the current line of code
\item
  Finish (\texttt{f}) finishes execution of the current function
\item
  Continue (\texttt{c}) leaves the interactive context and continues execution of the function
\item
  Stop (\texttt{Q}) leaves the interactive context and terminates execution of the function
\end{itemize}

In the interactive context of \texttt{river\_means()}, we see \texttt{data} and \texttt{pattern} are defined:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#>           Missouri Mississippi Yukon Colorado Arkansas Columbia  Red Canadian
#> length        3768        3544  3190     2330     2322     2000 1811     1458
#> discharge     1956       18400  6340       40     1004     7730  852      174
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(pattern)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> [1] "R"
\end{verbatim}

Pressing \texttt{n} executes \texttt{browser()}. Pressing \texttt{n} again executes

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\end{Highlighting}
\end{Shaded}

Inspecting \texttt{desired\_rivers}, we see

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(desired_rivers)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> [1] 7
\end{verbatim}

This seems correct, so the error does not appear to be here. Let's press \texttt{n} to evaluate the next line

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
\end{Highlighting}
\end{Shaded}

Inspecting \texttt{new\_data}, we see

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{new_data}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> [1] 1811  852
\end{verbatim}

Well this seems weird -- it does not look like a data frame. Let's inspect the structure

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{str}\NormalTok{(new_data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#>  num [1:2] 1811 852
\end{verbatim}

It is not a data frame, but rather a numeric vector. Because \texttt{rowMeans()} requires an array of two or more dimensions (e.g.~matrix or data frame), the next line of code fails. Pressing \texttt{n} again returns the error and removes you from the interactive context

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{rowMeans}\NormalTok{(new_data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> Error in rowMeans(new_data): 'x' must be an array of at least two dimensions
\end{verbatim}

A similar error occurs within \texttt{river\_medians()} when running \texttt{apply()}

So what is happening here? We know the code works when the pattern yields at least two matches in \texttt{rivers}, and we know the code behaves oddly when the pattern only has one match. Looking at the documentation of \texttt{{[}} we see a \texttt{drop} argument, which coerces to the lowest possible dimension when equal to \texttt{TRUE}. When subsetting data frames, \texttt{drop} is \texttt{TRUE} by default. So when subsetting a data frame using a single column, the data frame structure is only preserved when \texttt{drop\ =\ FALSE}. Accommodating this change in \texttt{river\_means()} and \texttt{river\_medians()} yields functions whose bodies looks like

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{river_means <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers, drop =}\StringTok{ }\OtherTok{FALSE}\NormalTok{]}
  \KeywordTok{rowMeans}\NormalTok{(new_data)}
\NormalTok{\}}

\NormalTok{river_medians <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers, drop =}\StringTok{ }\OtherTok{FALSE}\NormalTok{]}
  \KeywordTok{apply}\NormalTok{(new_data, }\DecValTok{1}\NormalTok{, median)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Running these functions with \texttt{pattern\ =\ "R"} behaves as intended

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{river_means}\NormalTok{(river, }\StringTok{"R"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#>    length discharge 
#>      1811       852
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{river_medians}\NormalTok{(river, }\StringTok{"R"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#>    length discharge 
#>      1811       852
\end{verbatim}

For more information about debugging in R, \href{https://www.youtube.com/watch?v=vgYS-F8opgE}{watch} or \href{https://adv-r.hadley.nz/debugging.html}{read}.

\hypertarget{another-error-no-mysterious-message}{%
\subsection{Another Error -- No Mysterious Message}\label{another-error-no-mysterious-message}}

We received and fixed an error message that occurred when the pattern only matched one river. But what happens when it matches zero rivers?

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{river_means}\NormalTok{(river, }\StringTok{"ZZZ"}\NormalTok{)}
\KeywordTok{river_medians}\NormalTok{(river, }\StringTok{"ZZZ"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

These types of bugs are especially pernicious because there is no error message associated with them. Whenever the output is unexpected, use \texttt{browser()} to diagnose the problem. In this context, \texttt{desired\_rivers} is a length-zero vector, which causes problems in the remaining parts of the function. To guard against these types of bugs, program defensively and force the function to return an error message early.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{river_means <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
  \ControlFlowTok{if}\NormalTok{ (}\KeywordTok{length}\NormalTok{(desired_rivers) }\OperatorTok{==}\StringTok{ }\DecValTok{0}\NormalTok{) \{}
    \KeywordTok{stop}\NormalTok{(}\StringTok{"This is an error message that stops the function"}\NormalTok{)}
\NormalTok{  \}}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers, drop =}\StringTok{ }\OtherTok{FALSE}\NormalTok{]}
  \KeywordTok{rowMeans}\NormalTok{(new_data)}
\NormalTok{\}}
\KeywordTok{river_means}\NormalTok{(rivers, }\StringTok{"ZZZ"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> Error in river_means(rivers, "ZZZ"): This is an error message that stops the function
\end{verbatim}

\hypertarget{exercises-4}{%
\subsubsection{Exercises}\label{exercises-4}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Rewrite \texttt{river\_medians()} so that it stops when no patterns are matched and returns an informative error message.
\end{enumerate}

\hypertarget{additional-resources}{%
\section{Additional Resources}\label{additional-resources}}

\begin{itemize}
\tightlist
\item
  \href{https://r-pkgs.org/index.html}{R Packages} by \href{http://hadley.nz/}{Hadley Wickham} and \href{https://jennybryan.org/}{Jenny Bryan}
\item
  \href{https://hilaryparker.com/2014/04/29/writing-an-r-package-from-scratch/}{Writing an R package from scratch} by \href{https://hilaryparker.com/}{Hilary Parker}
\item
  \href{https://cran.r-project.org/doc/manuals/r-release/R-exts.html}{Writing R Extensions} by CRAN (this resource is very technical)
\end{itemize}

\hypertarget{r-package-research-compendium}{%
\chapter{Making an R Package a Research Compendium}\label{r-package-research-compendium}}

\hypertarget{what-is-a-research-compendium}{%
\section{What is a Research Compendium?}\label{what-is-a-research-compendium}}

\citet{marwick2018packaging} state that the goal of a research compendium is to provide a standard and easily recognizable way to organize the digital materials of a project to enable others to inspect, reproduce, and extend the research. Three generic principles define research compendium:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Files should be organized according to the prevailing conventions of a broader community. This helps members of the community recognize the structure of the project and make tools that utilize the structure.
\item
  There should be a clear separation of data, methods, and output. For example, raw data should be kept separate from the code that cleans the data so that others can access the raw data.
\item
  The computational environment for the methods should be clearly specified. At the most basic level, this means recording the names and version numbers of software. At the most detailed level, this means completely reproducing the computing environment
\end{enumerate}

\hypertarget{exercises-5}{%
\subsection{Exercises}\label{exercises-5}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Can you identify any benefits to a research compendium?
\end{enumerate}

\hypertarget{why-a-research-compendium}{%
\section{Why a Research Compendium?}\label{why-a-research-compendium}}

\citet{marwick2018packaging} (and references therein) give several benefits of a research compendium:

\begin{itemize}
\tightlist
\item
  A convenient way to publicly share data and code
\item
  Work with publicly available data sets may receive higher numbers of citations than work with private data sets (note that publicly available data sets also tend to be easier to clear through EPA platforms)
\item
  Data sharing is associated with higher publication productivity

  \begin{itemize}
  \tightlist
  \item
    Of 7,040 NSF and NIH awards studied, the median number of publications associated with each research grant was five when the data were private and 10 when the data were public
  \end{itemize}
\item
  Structured and simplified file management and workflows
\item
  More defense against errors
\item
  Easier to communicate with others (and future you)
\end{itemize}

\hypertarget{exercises-6}{%
\subsection{Exercises}\label{exercises-6}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Can you identify any benefits to a research compendium that are not already on this list?
\end{enumerate}

\hypertarget{why-an-r-package-for-a-research-compendium}{%
\section{Why an R Package for a Research Compendium?}\label{why-an-r-package-for-a-research-compendium}}

As previously mentioned, a research compendium requires a specific structure. Earlier in this workshop, we got some experience with something in R that also requires a specific structure\ldots\ldots\ldots\ldots R packages! A research compendium can significantly benefit from adopting the structure of an R package. Organization is simpler (as you already have a structure), writing and documenting functions and data helps guard against errors in an analysis, and devtools have several development tools to help ensure your R package performs as intended.

We have previously discussed how to include data in an R package, but many of you may be wondering how we include additional pieces of a research compendium like analysis scripts, output, or a manuscript itself. If the structure of an R package is so rigid -- how do these pieces fit? We discuss one such approach next.

\hypertarget{turning-rprw-into-a-research-compendium}{%
\section{Turning RPRW Into A Research Compendium}\label{turning-rprw-into-a-research-compendium}}

If a folder named \texttt{inst} is placed at the root of an R package's directory, all of its raw contents will be installed upon installation of the R package. This is where we can put the pieces of our research compendium that are not explicitly related to the previous implementation of our R package. We can use this approach to turn RPRW into a research compendium.

Suppose we are using RPRW to supplement a manuscript about rivers. Let's first add the \texttt{inst} folder -- the root of your package's directory should look similar to

\includegraphics[width=1\linewidth]{images/newrpack_files9}

Let's add three folders to \texttt{inst}:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \texttt{analysis} for our analysis scripts
\item
  \texttt{output} for our analysis output
\item
  \texttt{manuscript} for our manuscript
\end{enumerate}

\includegraphics[width=1\linewidth]{images/newrpack_files10}

Let's make an R script to put in \texttt{analysis} whose contents look like

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# find some summary statistics on rivers with pattern "C"}
\KeywordTok{library}\NormalTok{(RPRW)}

\CommentTok{## find minimums}
\NormalTok{river_min <-}\StringTok{ }\KeywordTok{river_stats}\NormalTok{(river, }\StringTok{"C"}\NormalTok{, min)}

\NormalTok{min_df <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}
  \DataTypeTok{data =} \StringTok{"river"}\NormalTok{,}
  \DataTypeTok{pattern =} \StringTok{"C"}\NormalTok{,}
  \DataTypeTok{length_min =}\NormalTok{ river_min[[}\DecValTok{1}\NormalTok{]],}
  \DataTypeTok{discharge_min =}\NormalTok{ river_min[[}\DecValTok{2}\NormalTok{]]}
\NormalTok{)}

\KeywordTok{write.csv}\NormalTok{(min_df, }\StringTok{"inst/output/min_df"}\NormalTok{, }\DataTypeTok{row.names =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

This R script loads RPRW and finds the minimum length and discharge for rivers whose names start with C. The script then saves the contents to a CSV file in the \texttt{output} folder. These contents are used when building the manuscript about rivers. The manuscript in the \texttt{manuscript} folder is an RMarkdown document that is completely reproducible. Though we won't discuss the details here unless we have time, the files can be viewed on your machine (after installing RPRW) at the location provided by

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{system.file}\NormalTok{(}\StringTok{"manuscript"}\NormalTok{, }\DataTypeTok{package =} \StringTok{"RPRW"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

A compiled PDF of the manuscript is available \href{https://github.com/michaeldumelle/RPRW/blob/main/inst/manuscript/manuscript.pdf}{here}. Let's talk about its structure for a few minutes.

\hypertarget{exercises-7}{%
\subsection{Exercises}\label{exercises-7}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  There is a folder name within \texttt{inst} that should be avoided -- what is it?
\end{enumerate}

\hypertarget{adding-a-citation}{%
\subsection{Adding a Citation}\label{adding-a-citation}}

You can add a citation to your R package research compendium by running

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{use_citation}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
√ Writing 'inst/CITATION'
* Modify 'inst/CITATION'
\end{verbatim}

The citation file is placed in the \texttt{inst} folder. It looks a little intimidating at first, but it automatically creates a text version and LaTeX version of your citation with relatively little ease. Here is raw code I used to create the citation in the RPRW package

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{citHeader}\NormalTok{(}\StringTok{"To cite RPRW in publications use:"}\NormalTok{)}

\KeywordTok{citEntry}\NormalTok{(}
  \DataTypeTok{entry    =} \StringTok{"Manual"}\NormalTok{,}
  \DataTypeTok{title    =} \StringTok{"Using R Packages for Reproducible Workflows"}\NormalTok{,}
  \DataTypeTok{author   =} \KeywordTok{personList}\NormalTok{(}\KeywordTok{as.person}\NormalTok{(}\StringTok{"Michael Dumelle"}\NormalTok{)),}
  \DataTypeTok{journal  =} \StringTok{"EPA 2021 R Workshop"}\NormalTok{,}
  \DataTypeTok{url      =} \StringTok{"https://github.com/michaeldumelle/R-Packages-Reproducible-Workflows-Book"}\NormalTok{,}
  \DataTypeTok{textVersion =}
  \KeywordTok{paste}\NormalTok{(}
    \StringTok{"Michael Dumelle."}\NormalTok{,}
    \StringTok{"(2021)."}\NormalTok{,}
    \StringTok{"Using R Packages for Reproducible Workflows."}\NormalTok{,}
    \StringTok{"EPA 2021 R Workshop."}\NormalTok{,}
    \StringTok{"URL https://github.com/michaeldumelle/R-Packages-Reproducible-Workflows-Book."}
\NormalTok{  )}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Then you can run

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{citation}\NormalTok{(}\DataTypeTok{package =} \StringTok{"RPRW"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> 
#> To cite RPRW in publications use:
#> 
#>   Michael Dumelle. (2021). Using R Packages for Reproducible Workflows.
#>   EPA 2021 R Workshop. URL
#>   https://github.com/michaeldumelle/R-Packages-Reproducible-Workflows-Book.
#> 
#> A BibTeX entry for LaTeX users is
#> 
#>   @Manual{,
#>     title = {Using R Packages for Reproducible Workflows},
#>     author = {Michael Dumelle},
#>     journal = {EPA 2021 R Workshop},
#>     url = {https://github.com/michaeldumelle/R-Packages-Reproducible-Workflows-Book},
#>   }
\end{verbatim}

Editing these citations in this way is most useful when you want to cite the manuscript in your reserach compendium -- not the R package itself. If left unedited, the package citation exist by default and look like

\begin{verbatim}
#> 
#> To cite package 'RPRW' in publications use:
#> 
#>   Michael Dumelle (2021). RPRW: R Packages for Reproducible Workflows.
#>   R package version 0.0.0.9000.
#> 
#> A BibTeX entry for LaTeX users is
#> 
#>   @Manual{,
#>     title = {RPRW: R Packages for Reproducible Workflows},
#>     author = {Michael Dumelle},
#>     year = {2021},
#>     note = {R package version 0.0.0.9000},
#>   }
\end{verbatim}

\hypertarget{recap}{%
\section{Recap}\label{recap}}

So what does our research compendium look like now?

\begin{itemize}
\tightlist
\item
  data: folder containing data
\item
  DESCRIPTION: file containing metadata about our package
\item
  inst: folder containing auxiliary files to be downloaded alongside the package's installation

  \begin{itemize}
  \tightlist
  \item
    analysis: folder containing R scripts that are separate from the R package but used as part of the research compendium
  \item
    CITATION: file containing citation information
  \item
    mamuscript:
  \item
    output:
  \end{itemize}
\item
  LICENSE.md: file containing metadata about our license (GPL-3)
\item
  man: folder containing R function documentation from the package
\item
  NAMESPACE: file containing exports and imports
\item
  R: folder containing R functions from the package
\item
  RPRW.Rproj: file containing R Project metadata
\item
  tests: folder containing R function testing
\item
  vignettes: folder containing the package vignette
\end{itemize}

You can also add a README.md file to give a broad overview of your package. The README.md file in the RPRW package looks like

\begin{verbatim}
# RPRW
Companion R package for "Using R Packages for Reproducible Workflows" at the 2021 EPA R Workshop
\end{verbatim}

\hypertarget{an-example-r-package-reserach-compendium}{%
\subsection{An Example R Package Reserach Compendium}\label{an-example-r-package-reserach-compendium}}

A recent journal article of mine used this R package research compendium structure -- you can view the GitHub repository \href{https://github.com/michaeldumelle/DumelleEtAl2021STLMM}{here}.

\hypertarget{sharing-your-research-compendium}{%
\section{Sharing Your Research Compendium}\label{sharing-your-research-compendium}}

So now you have a research compendium that combines your R functions with your data, code, and manuscript to create a reproducible product that is easy to share with your colleagues. But how do we share it? Running

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{devtools}\OperatorTok{::}\KeywordTok{build}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

will build an R package for you. By default, the package will be located in the same folder as the folder containing your R package with name ``package-name\_version-number.tar.gz''. Note that this is one level above the location of your R package's directory. For example, if folder ``A'' holds ``RPRW'', which is the folder containing all of the files associated with my R package, then using \texttt{devtools::build()} will install ``RPRW\_0.0.0.9000.tar.gz'' in folder ``A''.

After building the package, you can send it to a colleague, they can save it on their machine, and then they can install it by running

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{install.packages}\NormalTok{(path_to_package, }\DataTypeTok{repos =} \OtherTok{NULL}\NormalTok{, }\DataTypeTok{type =} \StringTok{"source"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

If your colleague doesn't remember where they saved the file, they can interactively search for it by running

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{install.packages}\NormalTok{(}\KeywordTok{file.choose}\NormalTok{(), }\DataTypeTok{repos =} \OtherTok{NULL}\NormalTok{, }\DataTypeTok{type =} \StringTok{"source"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Because R packages leverage R projects, all file paths are relative (not absolute), and your colleague can immediately run any of your code on their machine!

\hypertarget{exercises-8}{%
\subsection{Exercises}\label{exercises-8}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Run \texttt{?devtools::build} to look at some additional arguments -- which seem useful to you?
\end{enumerate}

\hypertarget{extensions}{%
\chapter{Extensions}\label{extensions}}

\hypertarget{r-projects}{%
\section{R Projects}\label{r-projects}}

When I first started coding in R, I would try to share my code with others and encountered a problem -- my code would not work on their machine. This is because in my R scripts I would often read in files from different locations on my computer. The paths that point to the objects to read in were specific to my machine. Then when I colleague tried to run my script -- it failed! To get my code to work, they would have edit the file paths to point to the correct objects on their machine. Not only is this a lot to ask of someone, it also makes it incredibly easy to introduce errors. More often than not, I would have to meet with someone to get the code I sent them up and running. This was a waste of time for everyone involved.

R looks for files to load in a working directory. This is helpful because looking for files in a working directory prevents you from having to type out the full path to a file every time you want to load something. For example, you are not using a working directory and you have several files to load that live in \texttt{a/long/path/with/s\ p\ a\ c\ e\ s/or/weird/cH-a\_r-\/-aCt-er\$!!!}. To load \texttt{my\_cool\_file.csv} and \texttt{my\_other\_cool\_file.csv}, you have to run

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{read.csv}\NormalTok{(}\StringTok{"a/long/path/with/s p a c e s/and/weird/cH-a_r--aCt-er$!!!/my_cool_file.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

and then retype (or copy/paste) the path to run

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{read.csv}\NormalTok{(}\StringTok{"a/long/path/with/s p a c e s/and/weird/cH-a_r--aCt-er$!!!/my_other_cool_file.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

This workflow is tedious and error-prone. If you set your working directory to \texttt{a/really/long/path/with/s\ p\ a\ c\ e\ s/or/weird/cH-a\_r-\/-aCt-er\$!!!}, then to load \texttt{my\_cool\_file.csv} and \texttt{my\_other\_cool\_file.csv}, you have to run

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{read.csv}\NormalTok{(}\StringTok{"my_cool_file.csv"}\NormalTok{)}
\KeywordTok{read.csv}\NormalTok{(}\StringTok{"my_other_cool_file.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

You can set working directories in R using \texttt{setwd()}, but this isn't really a good idea for various reasons (you get to discuss them in the exercises). There is a better way to control your working directory -- insert R projects to the rescue!

R projects automatically set your working directory to live wherever the project is stored on your machine. So if I have \texttt{my\_cool\_file.csv} and \texttt{my\_other\_cool\_file.csv} in the root of my R project, I can load them by running

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{read.csv}\NormalTok{(}\StringTok{"my_cool_file.csv"}\NormalTok{)}
\KeywordTok{read.csv}\NormalTok{(}\StringTok{"my_other_cool_file.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

while inside the R project. This is so powerful because that means I can bundle up my R project, send it to my colleague, and then the R project will set my colleagues working directory to live wherever they save the project. That means that they can load \texttt{my\_cool\_file.csv} and \texttt{my\_other\_cool\_file.csv} using the exact same code I used. No more file path problems -- this is a vastly improved workflow. It may not seem like a huge deal now, but learning how to use R projects can make a huge difference in your ability to share your work.

Another benefit of R projects is that it provides a convenient structure to organize all the files associated with a particular task. To learn more about creating and maintaining R packages, check out \href{https://r4ds.had.co.nz/workflow-projects.html}{this} and \href{https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects}{this}.

\hypertarget{exercises-9}{%
\subsection{Exercises}\label{exercises-9}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  What are some drawbacks of running \texttt{setwd()} whenever you want to set a working directory?
\item
  Look into the \href{https://here.r-lib.org/}{here} package, designed to help solve working-directory problems (that can even occur within R Projects).
\end{enumerate}

\hypertarget{renv}{%
\subsection{renv}\label{renv}}

\href{https://rstudio.github.io/renv/articles/renv.html}{renv} is an R package that brings R package version management to your projects. renv prevents code in your R project from returning separate results based on the version of the R packages installed. It works by saving the specific versions of the R packages in your project and then makes it easy for others to install those same versions before running code in the R project.

\hypertarget{r-markdown}{%
\section{R Markdown}\label{r-markdown}}

R Markdown documents provide a convenient way to combine text, R code, and results into a fully reproducible document that compiles (knits) to one of several output types (HTLM, PDF, word, slide decks, etc.). An R Markdown document has file extension \texttt{.Rmd} and can be created in RStudio by clicking File -\textgreater{} New File -\textgreater{} R Markdown, which brings up the following options

\includegraphics[width=1\linewidth]{images/rmark1}

Pressing OK automatically opens a file with several contents

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{---}
\NormalTok{title: "Untitled"}
\NormalTok{author: "Michael Dumelle"}
\NormalTok{date: "9/17/2021"}
\NormalTok{output: html_document}
\NormalTok{---}

\BaseNTok{```\{r setup, include=FALSE\}}
\BaseNTok{knitr::opts_chunk$set(echo = TRUE)}
\BaseNTok{```}

\FunctionTok{## R Markdown}

\NormalTok{This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see }\OtherTok{<http://rmarkdown.rstudio.com>}\NormalTok{.}

\NormalTok{When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:}

\BaseNTok{```\{r cars\}}
\BaseNTok{summary(cars)}
\BaseNTok{```}

\FunctionTok{## Including Plots}

\NormalTok{You can also embed plots, for example:}

\BaseNTok{```\{r pressure, echo=FALSE\}}
\BaseNTok{plot(pressure)}
\BaseNTok{```}

\NormalTok{Note that the }\BaseNTok{`echo = FALSE`}\NormalTok{ parameter was added to the code chunk to prevent printing of the R code that generated the plot.}
\end{Highlighting}
\end{Shaded}

The part surrounded by \texttt{-\/-\/-} is the YAML header, which contains metadata about your document -- big picture options are controlled here. The parts prefixed by \texttt{\#} are first-level (section-level) headers, and the parts prefixed by \texttt{\#\#} are second level (subsection-level) headers. The parts surrounded by \texttt{\textasciigrave{}\textasciigrave{}\textasciigrave{}} are code chunks -- these are the engine that powers R Markdown. Code chunks let you run and display R code and output in your document. More generally, code chunks look like

\begin{Shaded}
\begin{Highlighting}[]
\BaseNTok{```\{r label, chunk_options\}}
\BaseNTok{R code}
\BaseNTok{```}
\end{Highlighting}
\end{Shaded}

The line

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr::opts_chunk$set()}
\end{Highlighting}
\end{Shaded}

lets you set default options for your code chunks. For example, \texttt{knitr::opts\_chunk\$set(echo\ =\ TRUE)} sets \texttt{echo\ =\ TRUE} for all all code chunks, unless a particular code chunk sets \texttt{echo\ =\ FALSE}. More information on available code chunk options is \href{https://yihui.org/knitr/options/}{here}. Finally, the rest of the document contains the body of the document -- the plain text.
For more on the structure of R Markdown documents, see \href{https://bookdown.org/yihui/rmarkdown-cookbook/conceptual-overview.html}{this}.

R Markdown documents are useful for a variety of reasons, two of which we will focus on next.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  R Markdown lets you create fully reproducible documents by combining R code and text. There is a slight change to the data? No problem, the tables or figures you are reproduced after changing the data. Suppose you want to knit to a new document style? No problem, just change \texttt{output:} This is very powerful.
\item
  This approach is less error-prone that remaking tables, figures, etc on your own and then inserting them ``by hand'' into your document.
\end{enumerate}

For much, much more on R Markdown, read \href{https://bookdown.org/yihui/rmarkdown/}{this} and \href{https://bookdown.org/yihui/rmarkdown-cookbook/}{this}.

\hypertarget{exercises-10}{%
\subsection{Exercises}\label{exercises-10}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Save the basic R Markdown template we just discussed and knit it to see its contents.
\end{enumerate}

\hypertarget{rticles}{%
\section{rticles}\label{rticles}}

The rticles is an extension of R Markdown designed to make adhering to journal style requirements easier. Some journal types rticles accommodates are Elsevier, PLOS, Sage, Springer, and Taylor \& Francis, among \href{https://github.com/rstudio/rticles}{many more}. After installing rticles (\texttt{install.packages("rticles")}), you can access article templates by starting a new R Markdown document and selecting the template tab

\includegraphics[width=1\linewidth]{images/rmark2}

The rticles templates have complicated YAML headers, but they generally have pretty clear inline instructions for how to edit them. The YAML headers change between templates. The body of the document is just standard R Markdown (potentially with some LaTeX). This is so nice because the body of the document is the same across templates (potentially with minor LaTeX discrepancies that are generally explained in the template's inline instructions). Decide you want to switch from an Elsevier journal to a Taylor \& Francis journal? No problem, just change the template type! For this reason, rticles is one my favorite R packages.

\hypertarget{git-and-github}{%
\section{Git and GitHub}\label{git-and-github}}

I highly recommend you learn how to use Git and GitHub. Though intimidating, frustrating, and time-consuming at first, Git and GitHub are well worth the effort. \href{https://git-scm.com/}{Git} is a version control system. A version control system keeps track of all changes made to your code in a Git repository (which is a \texttt{.git/} folder somewhere in your code -- note the \texttt{.git/} folder is usually hidden). Git is useful on its own, but it benefits greatly from integration with GitHub. \href{https://github.com/}{GitHub} is a website that lets you easily share your code, collaborate with others, track changes to your code, and backup your code, among other features. Git and GitHub is by far the most popular version control system for R packages, and access to development versions of R packages is usually only available through GitHub.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{devtools}\OperatorTok{::}\KeywordTok{install_github}\NormalTok{(}\StringTok{"username/packagename"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Though we won't get into details of Git and GitHub here, luckily RStudio has many tools to enable R to communicate with Git and GitHub. For an intro to Git and GitHub through RStudio, visit \href{https://r-pkgs.org/git.html}{here}. For a thorough book about using Git and GitHub through RStudio, visit \href{https://happygitwithr.com/}{here}. For a video overview of using Git and GitHub through RStudio, watch (here){[}\url{https://www.rstudio.com/resources/rstudioconf-2017/happy-git-and-gihub-for-the-user-tutorial/}{]}.

\hypertarget{continuous-integration}{%
\section{Continuous Integration}\label{continuous-integration}}

Continuous integration (often abbreviated CI) is the process of performing automated checks on code anytime it is updated. This may seem cumbersome, but it is a really good idea so that if an error is inserted in a new version of code, continuous integration helps identify that error. One option for continuous integration in your R package's GitHub repository is \href{https://github.com/features/actions}{GitHub actions}. devtools has several tools to help you set up GitHub actions. I recommend using their ``standard'' GitHub actions template, which can be added to your R project by running

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{use_github_action}\NormalTok{(}\DataTypeTok{name =} \StringTok{"check-standard"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
√ Creating '.github/'
√ Adding '^\\.github$' to '.Rbuildignore'
√ Adding '*.html' to '.github/.gitignore'
√ Creating '.github/workflows/'
√ Writing '.github/workflows/check-standard.yaml'
* Learn more at <https://github.com/r-lib/actions/blob/master/examples/README.md>
\end{verbatim}

You will notice that this code created a new folder at the root of our package named \texttt{.github}. The .github folder may be hidden so you may need to enable the viewing of hidden files to look through its contents on your machine (in the files pane of R studio click more and check ``show hidden files''. Then every time you push to GitHub, GitHub actions will simulate \texttt{devtools::check()} on several operating systems and return the results. This setup can be viewed for the RPRW package \href{https://github.com/michaeldumelle/RPRW/actions}{here}. Another option for continuous integration is \href{https://travis-ci.org/}{Travis CI}.

\hypertarget{extra}{%
\section{Extra}\label{extra}}

\href{https://www.rstudio.com/resources/cheatsheets/}{RStudio Cheat Sheets}

\hypertarget{exercise-solutions}{%
\chapter{Exercise Solutions}\label{exercise-solutions}}

\textbf{Q} 1. What are some of your favorite R packages?

\textbf{A} 1. This is for you to answer! Though a few of my favorites include devtools, styler, rticles, rlang, and purrr.

\emph{Q} 1. Of those ew have talked about so far, what benefits of R packages are most appealing to you?

\emph{A} 1. This is also for you to answer. My answer is ``all of them!'', though if I had to pick one, it is saving time by enforcing a structure -- future me appreciates when past me does this.

\emph{Q} 1. How many functions does \texttt{river\_means()} call within the body of the function? What package are these functions in?

\emph{A} 1. There are five functions: \texttt{\textless{}-}, \texttt{grep()}, \texttt{names()}, \texttt{{[}}, and \texttt{rowMeans()}. They are all in the ``base'' package, which can been seen in each function's documentation

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{?}\StringTok{`}\DataTypeTok{<-}\StringTok{`}
\NormalTok{?grep}
\NormalTok{?names}
\NormalTok{?}\StringTok{`}\DataTypeTok{[}\StringTok{`}
\NormalTok{?rowMeans}
\end{Highlighting}
\end{Shaded}

\emph{Q} 1. Play around with using these functions for some new patterns -- do you notice anything strange?

\emph{A} 1. If zero matches or one match occur for a pattern, there is some unexpected behavior. If there are zero matches, you get \texttt{NaN} for an answer (which stands for not a number).

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{river_means}\NormalTok{(rivers, }\StringTok{"ZZZ"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  If there is one match, you get a mysterious error -- more on this later.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{river_means}\NormalTok{(rivers, }\StringTok{"Red"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\emph{Q} 1. Write a new function, \texttt{river\_stat()}, that takes a data frame, pattern, and a general function by which to summarize river length and discharge. This general function should not be an actual function but rather a placeholder so that a user may insert their own function as an argument.

\emph{A} 1.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#' Summary statistics of river lengths and discharges}
\CommentTok{#'}
\CommentTok{#' @param data A data frame with two rows. The first row indicates river length and}
\CommentTok{#'   second row indicates river discharge. The columns of data indicate river names.}
\CommentTok{#' @param pattern A pattern by which to include only particular rivers}
\CommentTok{#' @param FUN A function to summarize the rivers}
\CommentTok{#'}
\CommentTok{#' @return The summarized river length and mean river discharge for the desired rivers}
\CommentTok{#' @export}
\CommentTok{#'}
\CommentTok{#' @examples}
\CommentTok{#' data("rivers")}
\CommentTok{#' river_stat(rivers, "Mi", min)}
\NormalTok{river_stat <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern, FUN) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{apply}\NormalTok{(new_data, }\DecValTok{1}\NormalTok{, FUN)}
\NormalTok{\}}
\KeywordTok{river_stat}\NormalTok{(rivers, }\StringTok{"Mi"}\NormalTok{, min)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> Error in data[, desired_rivers]: incorrect number of dimensions
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{river_stat}\NormalTok{(rivers, }\StringTok{"Mi"}\NormalTok{, max)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> Error in data[, desired_rivers]: incorrect number of dimensions
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{river_stat}\NormalTok{(rivers, }\StringTok{"Mi"}\NormalTok{, mean)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> Error in data[, desired_rivers]: incorrect number of dimensions
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{river_stat}\NormalTok{(rivers, }\StringTok{"Mi"}\NormalTok{, stats}\OperatorTok{::}\NormalTok{median)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> Error in data[, desired_rivers]: incorrect number of dimensions
\end{verbatim}

\emph{Q} 1. Rewrite \texttt{river\_stat()} so that it also takes additional arguments to the summarizing function (hint: use \texttt{...} as an argument)

\emph{A} 1.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#' Summary statistics of river lengths and discharges}
\CommentTok{#'}
\CommentTok{#' @param data A data frame with two rows. The first row indicates river length and}
\CommentTok{#'   second row indicates river discharge. The columns of data indicate river names.}
\CommentTok{#' @param pattern A pattern by which to include only particular rivers}
\CommentTok{#' @param FUN A function to summarize the rivers}
\CommentTok{#' @param ... Additional arguments to pass to \textbackslash{}code\{FUN\}}
\CommentTok{#'}
\CommentTok{#' @return The summarized river length and mean river discharge for the desired rivers}
\CommentTok{#' @export}
\CommentTok{#'}
\CommentTok{#' @examples}
\CommentTok{#' data("rivers")}
\CommentTok{#' river_stat(rivers, "Mi|C", mean, trim = 0.5)}
\NormalTok{river_stat <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern, FUN, ...) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers]}
  \KeywordTok{apply}\NormalTok{(new_data, }\DecValTok{1}\NormalTok{, FUN, ...)}
\NormalTok{\}}
\KeywordTok{river_stat}\NormalTok{(rivers, }\StringTok{"Mi|C"}\NormalTok{, mean, }\DataTypeTok{trim =} \DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> Error in data[, desired_rivers]: incorrect number of dimensions
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{river_stat}\NormalTok{(rivers, }\StringTok{"Mi|C"}\NormalTok{, mean, }\DataTypeTok{trim =} \FloatTok{0.5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> Error in data[, desired_rivers]: incorrect number of dimensions
\end{verbatim}

\emph{Q} 1. Write similar tests for \texttt{river\_means()} (discharge), \texttt{river\_medians()} (length), and \texttt{river\_medians()} (length)

\emph{A} 1.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{test_that}\NormalTok{(}\StringTok{"the mean discharge is calculated correctly in a test case"}\NormalTok{, \{}
  
  \CommentTok{# calculate values required for the test for discharge}

  \CommentTok{## calculate the means from the function}
\NormalTok{  river_means_val <-}\StringTok{ }\KeywordTok{river_means}\NormalTok{(rivers, }\StringTok{"Missouri|Mississippi"}\NormalTok{)}
\NormalTok{  river_means_discharge <-}\StringTok{ }\NormalTok{river_means_val[[}\DecValTok{2}\NormalTok{]]}

  \CommentTok{## calculate the means "by hand"}
\NormalTok{  raw_vec_discharge <-}\StringTok{ }\KeywordTok{unlist}\NormalTok{(rivers[}\StringTok{"discharge"}\NormalTok{, }\KeywordTok{c}\NormalTok{(}\StringTok{"Missouri"}\NormalTok{, }\StringTok{"Mississippi"}\NormalTok{)])}
\NormalTok{  raw_means_discharge <-}\StringTok{ }\KeywordTok{mean}\NormalTok{(raw_vec_discharge)}
  
  \CommentTok{# perform the actual test for discharge}

  \CommentTok{## check that the function and "by hand" output matches}
  \KeywordTok{expect_equal}\NormalTok{(river_means_discharge, raw_means_discharge)}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> Error in test_that("the mean discharge is calculated correctly in a test case", : could not find function "test_that"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{test_that}\NormalTok{(}\StringTok{"the median length is calculated correctly in a test case"}\NormalTok{, \{}
  
  \CommentTok{# calculate values required for the test for length}

  \CommentTok{## calculate the medians from the function}
\NormalTok{  river_medians_val <-}\StringTok{ }\KeywordTok{river_medians}\NormalTok{(rivers, }\StringTok{"Missouri|Mississippi"}\NormalTok{)}
\NormalTok{  river_medians_length <-}\StringTok{ }\NormalTok{river_medians_val[[}\DecValTok{1}\NormalTok{]]}

  \CommentTok{## calculate the medians "by hand"}
\NormalTok{  raw_vec_length <-}\StringTok{ }\KeywordTok{unlist}\NormalTok{(rivers[}\StringTok{"length"}\NormalTok{, }\KeywordTok{c}\NormalTok{(}\StringTok{"Missouri"}\NormalTok{, }\StringTok{"Mississippi"}\NormalTok{)])}
\NormalTok{  raw_medians_length <-}\StringTok{ }\KeywordTok{median}\NormalTok{(raw_vec_length)}
  
  \CommentTok{# perform the actual test for length}

  \CommentTok{## check that the function and "by hand" output matches}
  \KeywordTok{expect_equal}\NormalTok{(river_medians_length, raw_medians_length)}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> Error in test_that("the median length is calculated correctly in a test case", : could not find function "test_that"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{test_that}\NormalTok{(}\StringTok{"the mean discharge is calculated correctly in a test case"}\NormalTok{, \{}
  
  \CommentTok{# calculate values required for the test for discharge}

  \CommentTok{## calculate the medians from the function}
\NormalTok{  river_medians_val <-}\StringTok{ }\KeywordTok{river_medians}\NormalTok{(rivers, }\StringTok{"Missouri|Mississippi"}\NormalTok{)}
\NormalTok{  river_medians_discharge <-}\StringTok{ }\NormalTok{river_medians_val[[}\DecValTok{2}\NormalTok{]]}

  \CommentTok{## calculate the medians "by hand"}
\NormalTok{  raw_vec_discharge <-}\StringTok{ }\KeywordTok{unlist}\NormalTok{(rivers[}\StringTok{"discharge"}\NormalTok{, }\KeywordTok{c}\NormalTok{(}\StringTok{"Missouri"}\NormalTok{, }\StringTok{"Mississippi"}\NormalTok{)])}
\NormalTok{  raw_medians_discharge <-}\StringTok{ }\KeywordTok{median}\NormalTok{(raw_vec_discharge)}
  
  \CommentTok{# perform the actual test for discharge}

  \CommentTok{## check that the function and "by hand" output matches}
  \KeywordTok{expect_equal}\NormalTok{(river_medians_discharge, raw_medians_discharge)}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> Error in test_that("the mean discharge is calculated correctly in a test case", : could not find function "test_that"
\end{verbatim}

\emph{Q} 1. Rewrite \texttt{river\_medians()} so that it stops when no patterns are matched and returns an informative error message.

\emph{A} 1.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{river_medians <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, pattern) \{}
\NormalTok{  desired_rivers <-}\StringTok{ }\KeywordTok{grep}\NormalTok{(pattern, }\KeywordTok{names}\NormalTok{(data))}
  \ControlFlowTok{if}\NormalTok{ (}\KeywordTok{length}\NormalTok{(desired_rivers) }\OperatorTok{==}\StringTok{ }\DecValTok{0}\NormalTok{) \{}
    \KeywordTok{stop}\NormalTok{(}\StringTok{"The pattern provided does not match any rivers in the data provided"}\NormalTok{)}
\NormalTok{  \}}
\NormalTok{  new_data <-}\StringTok{ }\NormalTok{data[, desired_rivers, drop =}\StringTok{ }\OtherTok{FALSE}\NormalTok{]}
  \KeywordTok{rowMeans}\NormalTok{(new_data)}
\NormalTok{\}}
\KeywordTok{river_medians}\NormalTok{(rivers, }\StringTok{"ZZZ"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#> Error in river_medians(rivers, "ZZZ"): The pattern provided does not match any rivers in the data provided
\end{verbatim}

The error messages in the \texttt{RPRW} package are more informative but more difficult to code.

\emph{Q} 2. Can you identify any benefits to a research compendium?

\emph{A} 2. Individual answer

\emph{Q} 2. Can you identify any benefits to a research compendium that are not already on this list?

\emph{A} 2. Individual answer

  \bibliography{book.bib,packages.bib}

\end{document}
